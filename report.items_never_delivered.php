<?phpinclude("include/common.php");include("include/class.report.php");if (!$login) js_redirect($LANG['YOU_HAVE_LOGGED_OUT'], "/index.php");class Items_Never_Delivered_Report extends Report{		function default_values()	{		global $smarty;		$smarty->assign("date_from", date('Y-m-d'));	}		function run()	{		global $con, $smarty, $config;				$con_multi= new mysql_multi();		if (!$con_multi) die("Error: Fail to connect report server");				$filter = array();		$filter[] = "d.branch_id = 1"; // only consider do create by HQ		$filter[] = "d.do_date >= ".ms($this->date);				if ($this->branch_id_list)		{			if (count($this->branch_id_list) > 1) $filter[] = 'd.do_branch_id in ('.join(',',$this->branch_id_list).')';			else $filter[] = 'd.do_branch_id = '.join('',$this->branch_id_list);		}				$filter_sql = join(' and ',$filter);				$sql = "			select			si.id, si.sku_item_code, si.artno, si.mcode, si.description, s.added			from sku_items si			left join sku s on si.sku_id = s.id			where s.added >= ".ms($this->date)."			and si.id not in (select distinct sku_item_id from do_items di left join do d on di.do_id = d.id and di.branch_id = d.branch_id where $filter_sql)			order by $this->sort_by		";		//print "<br />$sql<br /><br />";		$r1 = $con_multi->sql_query($sql) or die(mysql_error());		$table = $con_multi->sql_fetchrowset($r1);		$con_multi->sql_freeresult($r1);				if($table)		{			/*			print '<pre>';			print_r($table);			print '</pre>';			*/			$this->table = $table;		}		$con_multi->close_connection();	}		function generate_report()	{		global $con, $smarty;		$this->run();		$smarty->assign("date_from", $_REQUEST['date_from']);		$smarty->assign("table", $this->table);		$smarty->assign("branch_id", abs($_REQUEST['branch_id']));		$smarty->assign("single_branch", $this->single_branch);	}		function process_form()	{		global $con,$smarty,$sessioninfo;				parent::process_form();				$this->date = $_REQUEST['date_from'];				$branch_list = array();				if ($_REQUEST['branch_id'] < 0) //branch group		{			$branch_group = $this->load_branch_group();			foreach($branch_group['items'][abs($_REQUEST['branch_id'])] as $bid=>$r)			{				$branch_list[] = $bid;			}						$this->single_branch = false;		}		else //single branch		{			$branch_list[] = $_REQUEST['branch_id'];			$this->single_branch = true;		}				$this->branch_id_list = $branch_list;				$sort_by = array(			'sku_item_code'	=>	'si.sku_item_code',			'artno'			=>	'si.artno',			'mcode'			=>	'si.mcode',			'description'	=>	'si.description',			'added'			=>	's.added',		);		$this->sort_by = $sort_by[$_REQUEST['sort_by']];	}	}$report = new Items_Never_Delivered_Report('Items Never Delivered Report');?>