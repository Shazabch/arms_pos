{*12/23/2013 10:23 AM Fithri- new module 'Stucked Documents Approval'2/20/2014 5:18 PM Justin- Enhanced to take out the "Close" button.4/20/2015 11:22 AM Justin- Enhanced to have GST information.5/8/2015 10:51 AM Justin- Enhanced to show document date.5/19/2015 1:09 PM Justin- Bug fixed on total qty always show zero.1/28/2016 11:09 AM Qiu Ying- Show gst_selling_price and selling price4/21/2017 1:13 PM Khausalya - Enhanced changes from RM to use config setting. 5/2/2018 4:16 PM Justin- Enhanced to have foreign currency feature.9/4/2018 5:15 PM Justin- Bug fixed on showing empty selling price when GRA is not under GST status.5/20/2019 2:57 PM William- Enhance "GRA" word to use report_prefix.*}{literal}<style>.gst_sp{	color:blue;	font-size:xx-small;}</style>{/literal}<form name="f_a" method="post" style="display:none;" action="goods_return_advice.approval.php"><input type=hidden name="a" value="approve"><input type=hidden name="branch_id" value="{$form.branch_id}"><input type=hidden name="approval_history_id" value="{$form.approval_history_id}"><input type=hidden name="id" value="{$form.id}" ><input type=hidden name="comments" value="">{if $approval_on_behalf}<input type="hidden" name="on_behalf_of" value="{$approval_on_behalf.on_behalf_of}" /><input type="hidden" name="on_behalf_by" value="{$approval_on_behalf.on_behalf_by}" />{/if}</form><h1>GRA ({$form.report_prefix}{$form.id|string_format:"%05d"})</h1><h3>Status:{if $form.status == 0 && $form.approved == 1 && $form.returned == 1 && $form.type eq 'Return'}	Completed{elseif $form.status == 0 && $form.type eq 'Disposal'}	Disposed{elseif $form.returned == 0 && $form.status == 2 && $form.approved == 0}	Waiting for Approval{elseif $form.returned == 0 && $form.status == 0 && $form.approved == 1}	Approved{elseif $form.status == 1}	Cancelled/Terminated{/if}</h3><div class="stdframe" style="background:#fff"><h4>General Information</h4><table border=0 cellspacing=0 cellpadding=4 width=100%><tr>	<td><b>Branch</b></td>	<td>{$form.branch_code}</td></tr><tr>	<td width=100><b>Created By</b></td>	<td>{$form.u}</td>	<td width=100><b>Created On</b></td>	<td>{$form.added|date_format:"%d/%m/%Y %I:%M%p"}</td>	<td width=100><b>Amount</b></td>	<td>{$form.amount|number_format:2}</td></tr><tr>	<td><b>Vendor</b></td>	<td>{$form.vendor}</td>	<td><b>Department</b></td>	<td>{$form.dept_code}</td>	<td><b>Returned Date</b></td>	<td>	{if $form.returned}	{$form.return_timestamp|date_format:"%d/%m/%Y %I:%M%p"}	{else}-{/if}	</td>	</tr><tr>	<td><b>DN No.</b></td>	<td>{$form.misc_info.dn_no|default:"-"}</td>	<td><b>DN Date</b></td>	<td>	{if $form.misc_info.dn_date}	{$form.misc_info.dn_date|date_format:"%d/%m/%Y"}	{else}-	{/if}	</td>	<td><b>DN Amount</b></td>	<td>{$form.misc_info.dn_amount|default:"-"}</td></tr>	{if $form.currency_code}		<tr>			<td><b>Currency</b></td>			<td>{$form.currency_code}</td>			<td><b>Exchange Rate</b></td>			<td colspan="3">{$form.currency_rate}</td>		</tr>	{/if}</table></div><br>{if $form.items}<table border=0 cellspacing=1 cellpadding=4 width=100% style="border:1px solid #000"><tr bgcolor=#ffee99>	<th>&nbsp;</th>	<th>ARMS Code</th>	<th>Manufacturer Code</th>	<th>Article No</th>	{if $config.link_code_name}		<th>{$config.link_code_name}</th>	{/if}	<th width=50%>SKU</th>	<th>Return Type</th>	<th nowrap>Inv / DO<br />No.</th>	<th nowrap>Inv / DO<br />Date</th>	<th>Qty (pcs)</th>	<th>{if $form.sku_type eq 'CONSIGN'}Selling Price{else}Cost{/if}</th>	{if $form.is_under_gst}		<th>GST Code</th>	{/if}	<th>Amount ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{if $form.is_under_gst}		<th>GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>		<th>Amount<br /> Incl. GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{/if}	<th>Ret</th></tr><tbody>{assign var=gra_items value=$form.items}{assign var=qty value=0}{section name=i loop=$gra_items}{if $gra_items[i].grn_cost}	{assign var=cost value=grn_cost}{elseif $gra_items[i].po_cost}	{assign var=cost value=po_cost}{else}	{assign var=cost value=master_cost}{/if}{assign var=qty value=$qty+$gra_items[i].qty}{*assign var=row_amt value=$gra_items[i].qty*$gra_items[i].cost}{assign var=row_amt value=$row_amt|round:$dp}{assign var=amt value=$amt+$row_amt}{assign var=amt value=$amt|round:$dp*}<tr id="tbrow_{$gra_items[i].id}" bgcolor="{cycle values="#eeeeee,"}" {if $smarty.request.highlight_item_id eq $gra_items[i].sku_item_id}class=highlight_row{/if}>    <td width=20 align=right>    {$smarty.section.i.iteration}.    </td>	<td>{$gra_items[i].sku_item_code}</td>	<td>{$gra_items[i].mcode|default:"&nbsp;"}</td>	<td>{$gra_items[i].artno|default:"&nbsp;"}</td>	{if $config.link_code_name}	<td>{$gra_items[i].link_code|default:"&nbsp;"}</td>	{/if}	<td>{$gra_items[i].sku} {include file=details.uom.tpl uom=$gra_items[i].packing_uom_code}</td>	<td>{$gra_items[i].return_type|default:"-"}</td>	<td>{$gra_items[i].doc_no|default:"-"}</td>	<td>{$gra_items[i].doc_date|ifzero:"-"}</td>	<td align=right>{$gra_items[i].qty|qty_nf}</td>	<td align=right nowrap>		{if $form.sku_type eq 'CONSIGN'}			{if $form.is_under_gst}				{if $gra_items[i].inclusive_tax eq 'yes'}					{$gra_items[i].gst_selling_price|number_format:2}<br/>					<span class="gst_sp">(Excl: {$gra_items[i].sp|number_format:4})<span>				{else}					{$gra_items[i].sp|number_format:2}<br/>					<span class="gst_sp">(Incl: {$gra_items[i].gst_selling_price|number_format:2})<span>				{/if}			{else}				{$gra_items[i].sp|number_format:2}			{/if}		{else}			{$gra_items[i].cost|number_format:$dp}		{/if}	</td>	{if $form.is_under_gst}		{if $form.sku_type eq 'CONSIGN'}			{*{assign var=gst_amt value=$gra_items[i].selling_price*$gra_items[i].gst_rate/100}*}			{assign var=gst_amt value=$gra_items[i].sp*$gra_items[i].gst_rate/100}		{else}			{assign var=gst_amt value=$gra_items[i].cost*$gra_items[i].gst_rate/100}		{/if}		<td align=right nowrap>{$gra_items[i].gst_code} ({$gra_items[i].gst_rate|default:'0'}%)<br />{$gst_amt|number_format:$dp}</td>	{/if}	<td align=right>		{if $form.sku_type eq 'CONSIGN'}			{*{assign var=row_amt value=$gra_items[i].qty*$gra_items[i].selling_price}*}			{assign var=row_amt value=$gra_items[i].qty*$gra_items[i].sp}			{assign var=row_amt value=$row_amt|round:$dp}		{else}			{assign var=row_amt value=$gra_items[i].qty*$gra_items[i].cost}			{assign var=row_amt value=$row_amt|round:$dp}		{/if}		{$row_amt|number_format:2}		{assign var=amt value=$amt+$row_amt}	</td>	{if $form.is_under_gst}		{assign var=row_gst value=$gra_items[i].gst}		{assign var=ttl_gst value=$ttl_gst+$row_gst}		<td bgcolor="{$rowcolor2}" align="right">{$row_gst|number_format:2}</td>				{assign var=row_gst_amt value=$row_gst+$row_amt}		{assign var=ttl_gst_amt value=$ttl_gst_amt+$row_gst_amt}		<td bgcolor="{$rowcolor2}" align="right">{$row_gst_amt|number_format:2}</td>	{/if}	<td align=center>{if $gra_items[i].checkout}<img src=ui/approved.png>{else}<img src=ui/rejected.png><br>{$gra_items[i].reason}{/if}</td></tr>{/section}<tr bgcolor=#ffee99>	<td {if $config.link_code_name}colspan=9{else}colspan=8{/if} align=right><b>Total</b></td>	<td align=right>{$qty|qty_nf}</td>	<td>&nbsp;</td>	{if $form.is_under_gst}		<td>&nbsp;</td>	{/if}	<td align=right>{$amt|number_format:2}</td>	{if $form.is_under_gst}		<td align=right>{$ttl_gst|number_format:2}</td>		<td align=right>{$ttl_gst_amt|number_format:2}</td>	{/if}	<td>&nbsp;</td></table><br>{/if}{assign var=total1_amt value=0}{assign var=total1_qty value=0}{if $new}<h4>Items Not in ARMS SKU</h4><table border=0 cellspacing=0 cellpadding=4 width=100% class="tb"><tr bgcolor=#cccccc>	<th>&nbsp;</th>	<th>Item Code</th>	<th width=50%>Description</th>	<th nowrap>Return Type</th>	<th nowrap>Inv / DO<br />No.</th>	<th nowrap>Inv / DO<br />Date</th>	<th>Qty (pcs)</th>	<th>Cost</th>	{if $form.is_under_gst}		<th>GST Code</th>	{/if}	<th>Amount</th>	{if $form.is_under_gst}		<th>GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>		<th>Amount<br /> Incl. GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{/if}</tr>{section name=i loop=$new}{assign var=total1_qty value=$new[i].qty+$total1_qty}{assign var=row_amt value=$new[i].qty*$new[i].cost}{assign var=row_amt value=$row_amt|round:$dp}{assign var=total1_amt value=$row_amt+$total1_amt}{assign var=total1_amt value=$total1_amt|round:$dp}<tr id="tbrow_{$new[i].id}" bgcolor="{cycle values="#eeeeee,"}">    <td width=6 align=right>    {$n_c+$smarty.section.i.iteration}.    </td>	<td>{$new[i].code}</td>	<td>{$new[i].description}</td>	<td>{$new[i].reason|default:"-"}</td>	<td>{$new[i].doc_no|default:"-"}</td>	<td>{$new[i].doc_date|ifzero:"-"}</td>	<td align=right>{$new[i].qty|qty_nf}</td>	<td align=right>{$new[i].cost|number_format:$dp}</td>	{if $form.is_under_gst}		{assign var=gst_amt value=$new[i].cost*$new[i].gst_rate/100}		{assign var=gst_amt value=$gst_amt|round:$dp}		<td align=right nowrap>{$new[i].gst_code} ({$new[i].gst_rate|default:'0'}%)<br />{$gst_amt|number_format:$dp}</td>	{/if}	<td align=right>		{$row_amt|number_format:2}	</td>	{if $form.is_under_gst}		{assign var=row_gst value=$new[i].qty*$gst_amt}		{assign var=ttl_gst1 value=$ttl_gst1+$row_gst}		<td bgcolor="{$rowcolor2}" align="right">{$row_gst|number_format:2}</td>		{assign var=row_gst_amt value=$row_gst+$row_amt}		{assign var=ttl_gst_amt1 value=$ttl_gst_amt1+$row_gst_amt}		<td bgcolor="{$rowcolor2}" align="right">{$row_gst_amt|number_format:2}</td>	{/if}</tr>{/section}<tr>	<td colspan=6 align=right>Total</td>	<td align=right>{$total1_qty|qty_nf}</td>	<td>&nbsp;</td>	{if $form.is_under_gst}		<td>&nbsp;</td>	{/if}	<td align=right>		{$total1_amt|number_format:2}	</td>	{if $form.is_under_gst}		<td align=right>{$ttl_gst1|number_format:2}</td>		<td align=right>{$ttl_gst_amt1|number_format:2}</td>	{/if}</tr></table>{/if}<br><h4>Remark</h4><div style="border:1px solid #000;padding:5px;">{$form.remark2|default:"-"|nl2br}</div><p align="center"><input type="button" value="Approve" style="background-color:#f90; color:#fff;" onclick="do_approve()"><input type="button" value="Terminate" style="background-color:#d00; color:#fff;" onclick="do_terminate()"></p>