{*7/29/2013 4:49 PM Andy- Fix Batch Price Change after approve will become blank page.12/16/2013 11:59 AM Justin- Bug fixed once found future price got problem, system will die the page instead of return user to the page and show error msg.12/23/2013 10:23 AM Fithri- new module 'Stucked Documents Approval'5/20/2014 10:12 AM Fithri- able to select item(s) to reject & must provide reason for each rejected item*}{include file=header.tpl}{literal}<!-- main calendar program --><script type="text/javascript" src="js/jscalendar/calendar.js"></script><!-- language for the calendar --><script type="text/javascript" src="js/jscalendar/lang/calendar-en.js"></script><!-- the following script defines the Calendar.setup helper function, which makes   adding a calendar a matter of 1 or 2 lines of code. --><script type="text/javascript" src="js/jscalendar/calendar-setup.js"></script><link rel="stylesheet" type="text/css" media="all" href="js/jscalendar/calendar-blue.css" title="calendar-blue" />{/literal}<script type="text/javascript">var phpself = '{$smarty.server.PHP_SELF}';var sku_change_price_approval_allow_reject_by_items = '{$config.sku_change_price_approval_allow_reject_by_items}';{literal}function do_cancel(){	document.f_b.comment.value = '';	var p = prompt('Enter reason to terminate/Cancel:');	if (p.trim()=='' || p==null) return;	document.f_b.comment.value = p;	if (confirm('Press OK to Terminate/Cancel this Batch.')){		document.f_b.a.value = "cancel";		document.f_b.submit();	}}function do_approve(){	if (sku_change_price_approval_allow_reject_by_items) {			//make sure each of them has reason		rejected_item_cb = document.getElementsByClassName('rejected_item_cb');		for (var index = 0, len = rejected_item_cb.length; index < len; ++index) {			var item = rejected_item_cb[index];			if ($(item).checked) {				if ($(item).next('span').down().value.trim() == '') {					alert('Please provide reason for each rejected item');					$(item).next('span').down().focus();					return;				}			}		}				//make not not all items were rejected		item_count = document.getElementsByClassName('tr_item_row').length;		document.getElementsByClassName('rejected_item_cb').each(function(item) {			if ($(item).checked) item_count--;		});		if (item_count < 1) {			alert('Cannot reject all promotion items');			return;		}	}	//alert('ready to submit');return;    document.f_a.comment.value = 'Approve';	if (confirm('Press OK to Approve the Batch.')){	    document.f_a.a.value = "approve";	    document.f_a.submit();	    	    /*return;		var prm = $(document.f_a).serialize();		new Ajax.Request(phpself, {			parameters: prm,			method: 'post',			onSuccess:  function(msg){				var str = msg.responseText.trim();				if(str.trim()) $('errmsg').update(str);				else window.location = phpself+'?t='+(new Date()).getTime();			}		});*/	}}function do_reject(){	document.f_b.comment.value = '';	var p = prompt('Enter reason to reject:');	if (p.trim()=='' || p==null) return;	document.f_b.comment.value = p;	if (confirm('Press OK to Reject the Batch.')){	    document.f_b.a.value = "reject";	    document.f_b.submit();	}}function select_tab(obj){	if (obj == undefined){		var lst = $('tab').getElementsByTagName("LI");		if (lst.length==0){			alert('Congratulation! You have completed all approval jobs.\nTake a break ;)');			document.location = '/home.php';			return;		}		lst[0].className = "active";		load_approval(lst[0]);	}	else{		var lst = $('tab').getElementsByTagName("LI");		$A(lst).each( function(r,idx) {			if (r.className == "active")				r.className = '';		});		obj.className = "active";		load_approval(obj);	}}function load_approval(obj){    var line = obj.title.split(",");	id =line[0];	branch_id = line[1];	$('sel_name').innerHTML = obj.innerHTML;	$('udiv').innerHTML = '<img src=ui/clock.gif align=absmiddle> Loading...<br><img src=ui/pixel.gif height=500 width=1>';	try{        current_total_inv_amt = 0;	}catch(ex){	}		new Ajax.Updater('udiv', phpself, {		parameters: 'a=ajax_load_fp&id='+id+'&branch_id='+branch_id+'&'+Form.serialize(document.f_on_behalf),		evalScripts: true		});}function toggle_date(obj){	if(obj.checked == true){		document.f_a['hour'].disabled = true;		document.f_a['minute'].disabled = true;		document.f_a['date'].disabled = true;		$('ds1').hide();	}else{		document.f_a['hour'].disabled = false;		document.f_a['minute'].disabled = false;		document.f_a['date'].disabled = false;		$('ds1').show();	}	$$('.dt').each(function(td){		if(obj.checked == true){			td.show();		}else td.hide();		//if(chx.checked) sku_items_list.push(chx.value);	});	$$('.hr').each(function(td){		if(obj.checked == true) td.show();		else td.hide();		//if(chx.checked) sku_items_list.push(chx.value);	});	$$('.min').each(function(td){		if(obj.checked == true) td.show();		else td.hide();		//if(chx.checked) sku_items_list.push(chx.value);	});}function reject_cb_clicked(e) {	if (e.checked) $(e).next('span').show();	else $(e).next('span').hide();}</script><style>#tab_sel {	border:1px solid #ccc;	width:500px;	padding:4px;	background:#fff url('/ui/findcat_expand.png') right center no-repeat;}#tab_sel ul {	position:absolute;	visibility:hidden;	background:#fff;	border:1px solid #ccc;	border-top:none;	list-style:none;	margin:0;padding:0;	margin-left:-5px;	margin-top:5px;	width:508px;	height:300px;	overflow:auto;}#tab_sel ul li {	cursor:pointer;	display:block;	margin:0;padding:4px;}#tab_sel ul li:hover {	background:#ff9}#tab_sel:hover ul {	visibility:visible;}</style>{/literal}<h1>{$PAGE_TITLE}{if $approval_on_behalf} (on behalf of {$approval_on_behalf.on_behalf_of_u}){/if}</h1><div style="float:left;padding:4px;"><b>Select Future Change Price to approve</b></div><div style="float:left" id=tab_sel><span id=sel_name>-</span><ul id=tab>{section name=i loop=$future_price}{strip}<li onclick="select_tab(this)" id="tab{$future_price[i].id}" title="{$future_price[i].id},{$future_price[i].branch_id}"> &nbsp; {$future_price[i].prefix}{$future_price[i].id|string_format:"%05d"}  &nbsp; (Branch: {$future_price[i].branch_name}, Date: {$future_price[i].date|ifzero:'By Branch'}, Created By: {$future_price[i].user_name})</li>{/strip}{/section}</ul></span></div><br style="clear:both"><br><form name="f_on_behalf">	{if $approval_on_behalf}	<input type="hidden" name="on_behalf_of" value="{$approval_on_behalf.on_behalf_of}" />	<input type="hidden" name="on_behalf_by" value="{$approval_on_behalf.on_behalf_by}" />	{/if}</form>{if $errm.mst}<br /><div id=err><div class=errmsg><ul>{foreach from=$errm.mst item=e}<li> {$e}{/foreach}</ul></div></div>{/if}<div id=udiv><!-- data will be loaded here --></div><script>select_tab();</script>{include file=footer.tpl}