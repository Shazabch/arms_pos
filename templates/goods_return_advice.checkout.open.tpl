{*REVISION HISTORY++++++++++++++++9/21/2007 4:36:32 PM gary- add DN info.3/25/2008 3:45:01 PM gary- lorry to vehicle) 09.05.2008 14:37:04 Saw- GRA Checkout add extra field for key in total CTN QTY RETURN, this field must compulsory.11/2/2010 3:28:13 PM Alex- remove 0.0004/29/2011 4:21:11 PM Justin- Rounding is now base on config['gra_cost_decimal_points'], if not found means all round by 2 decimal points.5/23/2011 12:10:59 PM Justin- Modified the grand total amount to round by default 2 decimal points instead of follow config set.8/3/2011 4:22:31 PM Justin- Added the ability to change decimal points for rounding up of qty.- Amended the cost to base on config set while edit GRA item.8/8/2011 11:05:11 AM Justin- Modified the round up for cost to base on config.- Modified the Ctn and Pcs round up to base on config set.2/16/2012 4:11:19 PM Andy- Add checking and hide "Cance","Confirm" and "Reset" button if not single server mode and different branch.- Show branch code of GRA in notification title and viewing page.4/23/2012 3:00:35 PM Alex- add packing uom code9/24/2012 6:00 PM Justin- Added to show remark.7/4/2013 2:51 PM Justin- Enhanced to show approval flow history.07/19/2013 11:24 AM Justin- Enhanced to show different info while config "gra_no_approval_flow" is turned on.5/7/2014 12:03 PM Justin- Bug fixed on sum up of total amount.5/12/2014 2:27 PM Fithri- allow user to select Returned Date12/8/2014 5:02 PM Justin- Bug fixed on sometimes will show nothing while click edit on itemise.4/18/2015 4:19 PM Justin- Enhanced to show GST information.5/8/2015 10:51 AM Justin- Enhanced to show document date.- Bug fixed on price getting wrongly when gra is CONSIGN.1/27/2016 9:31 AM Qiu Ying- Show gst_selling_price and selling_price12/28/2016 2:15 PM Andy- Fixed edit popup failed to show if sku description contain double quotes.4/20/2017 3:22 PM Khausalya- Enhanced changes from RM to use config setting. 5/12/2017 1:36 PM Andy- Fixed edit gra items bug, some custoemr server still unable to show the popup if got special character.- Fixed to auto close the edit popup if users click on the curtain.5/2/2018 4:16 PM Justin- Enhanced to have foreign currency feature.9/4/2018 5:15 PM Justin- Bug fixed on showing empty selling price when GRA is not under GST status.12/6/2018 10:43 AM Justin- Enhanced to have Rounding Adjust.- Enhanced items return checkbox always checked when doing checkout.5/17/2019 10:41 AM William- Enhance "GRA" word to use report_prefix.*}{include file=header.tpl}{include file=check_privilege_override.tpl}<link rel="stylesheet" type="text/css" media="all" href="js/jscalendar/calendar-blue.css" title="calendar-blue" /><script type="text/javascript" src="js/jscalendar/calendar.js"></script><script type="text/javascript" src="js/jscalendar/lang/calendar-en.js"></script><script type="text/javascript" src="js/jscalendar/calendar-setup.js"></script><script>var lower_date_limit = int('{$config.lower_date_limit}');var phpself = '{$smarty.server.PHP_SELF}';var GRA_EDIT_CURRENCY_RATE = '{$sessioninfo.privilege.GRA_EDIT_CURRENCY_RATE}';var is_under_gst = int('{$form.is_under_gst}');//alert(lower_date_limit);</script>{literal}<script>var g_val=null;var g_user_id=null;function do_submit_cancel(){	Element.hide('cancel_popup');	curtain(false);	if($('cancel_comment').value){		document.f_a.comment.value=$('cancel_comment').value;		document.f_a.a.value='cancel';		document.f_a.submit();	}	else{		alert('Please provide any comment!!!');		return;	}}function do_submit_edit(){	Element.hide('edit_popup');	curtain(false);	var cost=$('edit_cost').value;	var qty=$('edit_qty').value;	var pass=$('edit_pass').value;	document.f_a.password.value=pass;	document.f_a.user_id.value=g_user_id;	document.f_a.qty.value=qty;	document.f_a.cost.value=cost;	document.f_a.gra_item_id.value=g_val;	document.f_a.a.value='ajax_edit_item';	document.f_a.submit();	//new Ajax.Request( 'goods_return_advice.checkout.php?cost='+cost+'&qty='+qty+'&pass='+pass+'&'+Form.serialize(document.f_a)+'&a=ajax_edit_item&gra_item_id='+g_val );	/*new Ajax.Updater('goods_return_advice.checkout.php',	{		parameters: 'cost='+cost+'&qty='+qty+'&pass='+pass+'&'+Form.serialize(document.f_a)+'&a=ajax_edit_item&gra_item_id='+g_val,		evalScripts: true	});*/}function do_edit(val,cost,qty,sku_code,user_id, qty_dp){    g_val=val;    g_user_id=user_id;    $('edit_sku').value = $('span_description-'+val).innerText;    $('edit_art_code').value = $('span_artno-'+val).innerText;	$('edit_link_code').value = $('span_link_code-'+val).innerText;   	$('edit_mcode').value = $('span_mcode-'+val).innerText;	$('edit_armscode').value=sku_code;	$('edit_cost').value=cost;	$('edit_qty').value=qty;	$('edit_qty').onchange = function onchange(event) { float(mf(this, qty_dp)) };	center_div('edit_popup');	curtain(true);	Element.show('edit_popup');}function do_confirm(btn){	/*if (empty(document.f_a.elements['misc_info[dn_no]'], 'Please enter DN No')) 				   return false;	if (empty(document.f_a.elements['misc_info[dn_date]'], 'Please enter DN Date')) 				   return false;	*/	if (empty(document.f_a.transport, 'Please enter Vehicle No')) 		return false;	if (empty(document.f_a.elements['misc_info[name]'], 'Please enter Driver Name')) 				return false;	if (empty(document.f_a.elements['misc_info[nric]'], 'Please enter Driver IC No')) 				return false;	if (empty(document.f_a.elements['misc_info[return_ctn]'], 'Please enter Return Ctn')) 				return false;		if (confirm('Confirm and Print GRA?'))	{		btn.disabled=true;		document.f_a.submit();	}}function do_cancel(){	center_div('cancel_popup');	curtain(true);	Element.show('cancel_popup');}function check_all(v){	var obj = $('tb').getElementsByTagName('input');	for(j=0;j<obj.length;j++)	{		if (obj[j].type=='checkbox'){   			n = obj[j].name;   			n = n.replace(/^checkout/,'reason');			obj_sel = document.f_a.elements[n];			obj[j].checked = v;			if (v){				obj_sel.hide();			}			else{			    obj_sel.show();			}   		}	}		recalc_total();}function do_close(gi_id,obj_1){	if (obj_1.checked){		document.f_a['reason['+gi_id+']'].hide();	}	else{		document.f_a['reason['+gi_id+']'].show();	}		recalc_total();}function cancel_popup(){    curtain(false);	Element.hide('edit_popup');	Element.hide('cancel_popup');}function do_reason(val,n){    $('untick_reason'+n).value = '';    if(val=='other')    {        $('untick_reason'+n).style.display = '';        //document.f_a.untick_reason.focus();	}	else	    $('untick_reason'+n).style.display = 'none';}function init_calendar(){	Calendar.setup({		inputField     :    "dn_date",     // id of the input field		ifFormat       :    "%Y-%m-%d",      // format of the input field		button         :    "b_dn_date",  // trigger for the calendar (button ID)		align          :    "Bl",           // alignment (defaults to "Bl")		singleClick    :    true		//,		//onUpdate       :    load_data	});   	Calendar.setup({		inputField     :    "inp_return_timestamp",		ifFormat       :    "%Y-%m-%d %H:%M:%S",		daFormat       :    "%Y-%m-%d %H:%M:%S",		showsTime      :    true,		electric       :    false,		button         :    "img_return_timestamp",		align          :    "Bl",		singleClick    :    true,		dateStatusFunc :    function (date) {								var val = false;								if (!lower_date_limit) return val;								allowed_min_return_timestamp = new Date();								allowed_min_return_timestamp.setTime(allowed_min_return_timestamp.getTime() - 3600000*24*lower_date_limit);								if((date.getTime() < allowed_min_return_timestamp.getTime())){									val = true;								}								return val;							}	});}function curtain_clicked(){	Element.hide('edit_popup');	Element.hide('cancel_popup');}function reload_currency_rate(){	var currency_code = document.f_a['currency_code'].value;	document.f_a['currency_code'].value = currency_code;	var date = document.f_a['return_timestamp'].value;		// always insert currency rate as 1 if found user choose base currency or it's empty	if(currency_code.trim() == ""){		document.f_a['currency_rate'].value = 1;		check_gst_status();		return;	}		if(date.trim() == ""){		alert("Please choose a returned date");		document.f_a['currency_rate'].value = '';		return;	}		$('span_currency_rate_loading').update(_loading_);		var params = {		'a': 'loadCurrencyRate',		date: date,		currency_code: currency_code	}	//q += '&'+$H(params).toQueryString();	var q = $H(params).toQueryString();		new Ajax.Request(phpself, {		parameters: q,		method: 'post',		onComplete: function(msg){			$('span_currency_rate_loading').update('');			var str = msg.responseText.trim();			var ret = {};			var err_msg = '';						try{				ret = JSON.parse(str); // try decode json object				if(ret['rate']){ // success					// got currency rate					document.f_a['currency_rate'].value = ret['rate'];					return;				}else{  // load currency rate failed					if(ret['err'])	err_msg = ret['err'];					else    err_msg = str;				}			}catch(ex){ // failed to decode json, it is plain text response				err_msg = str;			}			// prompt the error			alert(err_msg);		}	});}function change_currency_rate(){	PRIV_CHECK.check_privilege('GRA_CHANGE_CURRENCY_RATE', change_currency_rate_callback);}function change_currency_rate_callback(override_by_user_id){	var new_rate = float(prompt("Please key in new exchange rate."));	if(new_rate<=0){		alert('Exchange Rate must more than 0.');		return;	}		document.f_a['currency_rate'].value = new_rate;	document.f_a['currency_rate_override_by_user_id'].value = override_by_user_id;}function recalc_total(){	mf(document.f_a['rounding_adjust'], 2);		var ttl_amt = ttl_amt_after_ra = 0;	$$('#tb .chkbox_ret').each(function(ele, i){		//$(ele).update();		var item_id = $(ele).readAttribute('item_id');		var item_amt = float(document.f_a['item_gross_amt['+item_id+']'].value);		if(is_under_gst == 1) item_amt = float(document.f_a['item_amt['+item_id+']'].value);				if($(ele).checked == true){			ttl_amt += float(item_amt);		}	});		ttl_amt += float(document.f_a['extra_amount'].value);	ttl_amt_after_ra = round(float(ttl_amt) + float(document.f_a['rounding_adjust'].value), 2);		$('td_sub_ttl').update(ttl_amt.toFixed(2));	$('td_grand_ttl').update(ttl_amt_after_ra);		document.f_a['amount'].value = ttl_amt_after_ra;}</script><style>.gst_sp{	font-size:0.9em;	color:blue;}</style>{/literal}<h1>GRA ({$form.report_prefix}{$form.id|string_format:"%05d"})</h1><h3>Status: {if !$config.gra_no_approval_flow}Approved{else}Saved{/if} GRA (Check Out)</h3>{include file=approval_history.tpl}<div id=edit_popup style="display:none;position:absolute;z-index:10000;background:#fff;border:2px solid #000;padding:5px;width:300;height:300"><table><tr><th align=left>ARMSCode</td> <td>:</td> <td><input readonly id=edit_armscode></td></tr><tr><th align=left>SKU</td> <td>:</td> <td><input readonly id=edit_sku></td></tr><tr><th align=left>Manufacturer Code</td> <td>:</td> <td><input readonly id=edit_mcode></td></tr><tr><th align=left>Article No</td> <td>:</td> <td><input readonly id=edit_art_code></td></tr><tr><th align=left>{$config.link_code_name}</td> <td>:</td> <td><input readonly id=edit_link_code></td></tr><tr><td colspan=3 align=center>&nbsp;</td></tr><tr align=center><td colspan=3 align=center>Please Keyin Your New Changes</td></tr><tr><td colspan=3 align=center>&nbsp;</td></tr><tr><td align=left>Qty</td> <td>:</td> <td><input id=edit_qty onchange="mi(this);" size=20></td></tr><tr><td align=left>Cost</td> <td>:</td> <td><input id=edit_cost onchange="mf(this, {$dp});" size=20></td></tr><tr><th align=left>Password</th> <th>:</th> <td><input type=password id=edit_pass size=20 maxlength=30></td></tr><tr><td colspan=3></td></tr><tr align=center><td colspan=3><input type=button value="OK" onclick="do_submit_edit();">&nbsp;&nbsp;&nbsp;<input type=button value="Cancel" onclick="cancel_popup();"></td></tr></table></div><div id=cancel_popup style="display:none;position:absolute;z-index:10000;background:#fff;border:2px solid #000;padding:5px;width:280;height:120"><p align=center>Please Provide Cancel Comment<p align=left><table><tr><td>Comment</td> <td>:</td> <td><input id=cancel_comment size=30></td></tr><tr><td colspan=3></td></tr><tr align=center><td colspan=3><input type=button value="OK" onclick="do_submit_cancel();">&nbsp;&nbsp;&nbsp;<input type=button value="Cancel" onclick="cancel_popup();"></td></tr></table></div><div class="stdframe" style="background:#fff"><h4>General Information</h4><form name="f_a" method="post"><input type="hidden" name="a" value="confirm"><input type="hidden" name="user_id" value=""><input type="hidden" name="comment" value=""><input type="hidden" name="password" value=""><input type="hidden" name="qty" value=""><input type="hidden" name="cost" value=""><input type="hidden" name="gra_item_id" value=""><input type="hidden" name="id" value="{$form.id}"><input type="hidden" name="branch_id" value="{$form.branch_id}"><input type="hidden" name="sku_type" value="{$form.sku_type}"><table border=0 cellspacing=0 cellpadding=4><tr>	<td><b>Branch</b></td>	<td>{$form.branch_code}</td></tr><tr>	<td width=100><b>Created By</b></td>	<td>{$form.u}</td>	<td width=100><b>Created On</b></td>	<td>{$form.added|date_format:"`$config.dat_format` %I:%M%p"}</td>	<td width=100><b>Amount</b></td>	<td>{$form.currency_code|default:$config.arms_currency.symbol} {$form.amount|number_format:2}</td>	{if $form.currency_code}		<td valign="top" align="right" rowspan="2">			<table>				<tr>					<td><b>Currency</b></td>					<td>						<img src="/ui/pixel.gif" width="15" align="absmiddle">						{$form.currency_code}						<input type="hidden" name="currency_code" value="{$form.currency_code}" />					</td>				</tr>				<tr id="tr_currency_rate" {if !$form.currency_code}style="display:none;"{/if}>					<td><b>Exchange Rate</b></td>					<td>						<input type="hidden" name="currency_rate_override_by_user_id" value="{$form.currency_rate_override_by_user_id}" />						{if !$sessioninfo.privilege.GRA_CHANGE_CURRENCY_RATE}							<img src="/ui/ed.png" align="absmiddle" onclick="change_currency_rate();" title="Change Rate">						{/if}						<input type="text" name="currency_rate" size="7" value="{$form.currency_rate|default:1}" {if !$sessioninfo.privilege.GRA_CHANGE_CURRENCY_RATE}readonly{/if} />						{if $form.old_currency_rate}							<font color="blue">[{$form.old_currency_rate}] during draft GRA</font>							<br />						{/if}						<span id="span_currency_rate_loading"></span>					</td>				</tr>			</table>		</td>	{/if}	</tr><tr>	<td><b>Vendor</b></td>	<td>{$form.vendor}</td>	<td><b>Department</b></td>	<td>{$form.dept_code}</td>	<td><b>Returned Date</b></td>	<td>		{*$smarty.now|date_format:"`$config.dat_format` %I:%M%p"*}		<input name="return_timestamp" id="inp_return_timestamp" size="20" maxlength="10" value="{$form.return_timestamp}" {if $form.currency_code}onchange="reload_currency_rate();"{/if} readonly />		<img align="absmiddle" src="ui/calendar.gif" id="img_return_timestamp" style="cursor: pointer;" title="Select Date" />		<img src="ui/rq.gif" align="absbottom" title="Required Field">	</td></tr><tr>	<td><b>DN No.</b></td>	<td><input name=misc_info[dn_no] value="{$form.misc_info.dn_no}" size=15 onchange="uc(this);"></td>	<td><b>DN Date</b></td>	<td>	<input type="text" name="misc_info[dn_date]" id="dn_date" size=12 value="{$form.misc_info.dn_date|date_format:$config.dat_format}">   	<img align=absbottom src="ui/calendar.gif" id="b_dn_date" style="cursor: pointer;" title="Select Date">	</td>	<td><b>DN Amount ({$form.currency_code|default:$config.arms_currency.symbol})</b></td>	<td><input name="misc_info[dn_amount]" value="{$form.misc_info.dn_amount}" onchange="mf(this);" size=15 class="r" onclick="select(this);"></td></tr><tr>	<td><b>Vehicle No.</b></td>	<td nowrap><input name=transport value="{$form.transport}" size=15 onchange="uc(this);">	<img src="ui/rq.gif" align="absbottom" title="Required Field">	</td>	<td><b>Driver Name</b></td>	<td nowrap><input name="misc_info[name]" value="{$form.misc_info.name}" onchange="uc(this);" size=40>	<img src="ui/rq.gif" align="absbottom" title="Required Field">	</td>	<td><b>IC No.</b></td>	<td nowrap><input name="misc_info[nric]" value="{$form.misc_info.nric}" onchange="uc(this);" size=15>	<img src="ui/rq.gif" align="absbottom" title="Required Field">	</td></tr><tr>	<td><b>Return Ctn</b></td>	<td nowrap><input name="misc_info[return_ctn]" value="{$form.misc_info.return_ctn|default:'&nbsp;'}" onchange="this.value=float(round(this.value, {$config.global_qty_decimal_points}));" size=15>	<img src="ui/rq.gif" align="absbottom" title="Required Field">	</td>	<td colspan=4>&nbsp;</td></tr></table></div>{if $errm.sheet}<div id=err><div class=errmsg><ul>{foreach from=$errm.sheet item=e}<li> {$e}</li>{/foreach}</ul></div></div>{/if}{if $form.items}<p>- Tick on the items that will be returned and click Confirm and Print.</p> <table border=0 cellspacing=1 cellpadding=4 width=100% style="border:1px solid #000"><tr bgcolor=#ffee99>	<th><input type=checkbox onclick="check_all(this.checked);" checked> Return</th>	<th>ARMS Code</th><th>Manufacturer Code</th>	<th>Article No</th>	{if $config.link_code_name}		<th>{$config.link_code_name}</th>	{/if}	<th width=40%>SKU</th>	<th>Return Type</th>	<th nowrap>Inv / DO<br />No.</th>	<th nowrap>Inv / DO<br />Date</th>	<th>Qty (pcs)</th>	<th>{if $form.sku_type eq 'CONSIGN'}Selling Price{else}Cost{/if}</th>	{if $form.is_under_gst}		<th>GST Code</th>	{/if}	<th>Amount ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{if $form.is_under_gst}		<th>GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>		<th>Amount<br /> Incl. GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{/if}</tr><tbody id=tb>{assign var=gra_items value=$form.items}{section name=i loop=$gra_items}{*assign var=qty value=$qty+$gra_items[i].qty}{assign var=amt value=$amt+$gra_items[i].qty*$gra_items[i].cost}{assign var=amt value=$amt|round:$config.global_cost_decimal_points*}{if $gra_items[i].doc_allow_decimal}	{assign var=qty_dp value=$config.global_qty_decimal_points}{else}	{assign var=qty_dp value=0}{/if}<tr id="tbrow_{$gra_items[i].id}" bgcolor="{cycle values="#eeeeee,"}">    <td width=155 nowrap>		<img src="/ui/foc.png" title="Edit" onclick="do_edit('{$gra_items[i].id|escape:javascript|escape:html}','{$gra_items[i].cost|number_format:$config.global_cost_decimal_points}','{$gra_items[i].qty|qty_nf|escape:javascript|escape:html}','{$gra_items[i].sku_item_code|escape:javascript|escape:html}','{$gra_items[i].user_id|escape:javascript|escape:html}', '{$qty_dp}')">		<input type="checkbox" name="checkout[{$gra_items[i].id}]" onchange="do_close('{$gra_items[i].id}',this);" class="chkbox_ret" item_id="{$gra_items[i].id}" checked>		<select name="reason[{$gra_items[i].id}]" onchange="do_reason(this.value,'{$gra_items[i].id}');" style="font-size:9px; display:none;">			<option>Wrong Qty</option>			<option>Wrong Cost</option>			<option>Wrong Supplier</option>			<option>other</option>		</select>		<span id="untick_reason{$gra_items[i].id}" style="display:none;color:blue;font-size:8px;"> Please enter reason : <input size="20" maxlength="20" name="untick_reason[{$gra_items[i].id}]"></span>		<div style="display:none;">			<span id="span_mcode-{$gra_items[i].id}">{$gra_items[i].mcode}</span>			<span id="span_link_code-{$gra_items[i].id}">{$gra_items[i].link_code}</span>			<span id="span_artno-{$gra_items[i].id}">{$gra_items[i].artno}</span>			<span id="span_description-{$gra_items[i].id}">{$gra_items[i].sku}</span>		</div>		<input type="hidden" name="item_gross_amt[{$gra_items[i].id}]" value="{$gra_items[i].amount}" />		{if $form.is_under_gst}			<input type="hidden" name="item_gst_amt[{$gra_items[i].id}]" value="{$gra_items[i].gst}" />			<input type="hidden" name="item_amt[{$gra_items[i].id}]" value="{$gra_items[i].amount_gst}" />		{/if}    </td>	<td>{$gra_items[i].sku_item_code}</td>	<td>{$gra_items[i].mcode}</td>	<td>{$gra_items[i].artno}</td>	{if $config.link_code_name}	<td>{$gra_items[i].link_code|default:"&nbsp;"}</td>	{/if}	<td>{$gra_items[i].sku} {include file=details.uom.tpl uom=$gra_items[i].packing_uom_code}</td>	<td>{$gra_items[i].return_type|default:'-'}</td>	<td>{$gra_items[i].doc_no|default:'-'}</td>	<td>{$gra_items[i].doc_date|ifzero:'-'}</td>	<td align=right>{$gra_items[i].qty|qty_nf}</td>	<td align=right nowrap>		{if $form.sku_type eq 'CONSIGN'}			{if $form.is_under_gst}				{if $gra_items[i].inclusive_tax eq 'yes'}					{$gra_items[i].gst_selling_price|default:"&nbsp;"|number_format:2}<br/>					<span class="gst_sp">(Excl: {$gra_items[i].selling_price|default:"&nbsp;"|number_format:4})<span>				{else}					{$gra_items[i].selling_price|default:"&nbsp;"|number_format:2}<br/>					<span class="gst_sp">(Incl: {$gra_items[i].gst_selling_price|default:"&nbsp;"|number_format:2})<span>				{/if}			{else}				{$gra_items[i].selling_price|default:"&nbsp;"|number_format:2}			{/if}		{else}			{$gra_items[i].cost|number_format:$dp}		{/if}	</td>	{if $form.is_under_gst}		{if $form.sku_type eq 'CONSIGN'}			{assign var=gst_amt value=$gra_items[i].selling_price*$gra_items[i].gst_rate/100}		{else}			{assign var=gst_amt value=$gra_items[i].cost*$gra_items[i].gst_rate/100}		{/if}		<td align=right nowrap>{$gra_items[i].gst_code} ({$gra_items[i].gst_rate|default:'0'}%)<br />{$gst_amt|number_format:$dp}</td>	{/if}	<td align=right>		{if $form.sku_type eq 'CONSIGN'}			{assign var=row_amt value=$gra_items[i].qty*$gra_items[i].selling_price}			{assign var=row_amt value=$row_amt|round:$dp}			{*{$gra_items[i].qty*$gra_items[i].selling_price|number_format:2}*}			{$gra_items[i].amount|number_format:2}		{else}			{assign var=row_amt value=$gra_items[i].qty*$gra_items[i].cost}			{assign var=row_amt value=$row_amt|round:$dp}		{/if}		{$row_amt|number_format:$dp}		{assign var=amt value=$amt+$row_amt}	</td>	{if $form.is_under_gst}		{assign var=row_gst value=$gra_items[i].qty*$gst_amt}		{assign var=ttl_gst value=$ttl_gst+$row_gst}		{*<td bgcolor="{$rowcolor2}" align="right">{$row_gst|number_format:$dp}</td>*}		<td bgcolor="{$rowcolor2}" align="right">{$gra_items[i].gst|number_format:2}</td>		{assign var=row_gst_amt value=$row_gst+$row_amt}		{assign var=ttl_gst_amt value=$ttl_gst_amt+$row_gst_amt}		{*<td bgcolor="{$rowcolor2}" align="right">$row_gst_amt|number_format:$dp}</td>*}		<td bgcolor="{$rowcolor2}" align="right">{$gra_items[i].amount_gst|number_format:2}</td>	{/if}</tr>{/section}<tr bgcolor=#ffee99>	<td {if $config.link_code_name}colspan=9{else}colspan=8{/if} align=right><b>Total</b></td>	<td align=right>{$qty}</td>	<td>&nbsp;</td>	{if $form.is_under_gst}		<td>&nbsp;</td>	{/if}	<td align=right>{$amt|number_format:2}</td>	{if $form.is_under_gst}		<td align=right>{$ttl_gst|number_format:2}</td>		<td align=right>{$ttl_gst_amt|number_format:2}</td>	{/if}</tr></table><br>{/if}{if $new}<h4>Items Not in ARMS SKU</h4><table border=0 cellspacing=1 cellpadding=4 width=100% style="border:1px solid #000"><tr bgcolor=#ffee99>	<th>&nbsp;</th>	<th>Item Code</th>	<th width=70%>Description</th>	<th>Return Type</th>	<th nowrap>Inv / DO<br />No.</th>	<th nowrap>Inv / DO<br />Date</th>	<th>Qty (pcs)</th>	<th>Cost</th>	{if $form.is_under_gst}		<th>GST Code</th>	{/if}	<th>Amount ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{if $form.is_under_gst}		<th>GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>		<th>Amount<br /> Incl. GST ({$form.currency_code|default:$config.arms_currency.symbol})</th>	{/if}</tr>{section name=i loop=$new}<input type=hidden name=checkout[{$new_items[i].id}] value=''><input type=hidden name=reason[{$new_items[i].id}] value=''>{assign var=row_qty1 value=$new[i].qty|round:$config.global_qty_decimal_points}{assign var=qty1 value=$qty1+$row_qty1}{assign var=row_amt1 value=$row_qty1*$new[i].cost}{assign var=amt1 value=$amt1+$row_amt1|round:$dp}<tr id="tbrow_{$new[i].id}" bgcolor="{cycle values="#eeeeee,"}">    <td width=6 align=center>	{$smarty.section.i.iteration}.    </td>	<td>{$new[i].code}</td>	<td>{$new[i].description}</td>	<td>{$new[i].reason}</td>	<td>{$new[i].doc_no}</td>	<td>{$new[i].doc_date}</td>	<td align=right>{$row_qty1|qty_nf}</td>	<td align=right>{$new[i].cost|number_format:$dp}</td>	{if $form.is_under_gst}		{assign var=gst_amt value=$new[i].cost*$new[i].gst_rate/100}		<td align=right nowrap>{$new[i].gst_code} ({$new[i].gst_rate|default:'0'}%)<br />{$gst_amt|number_format:$dp}</td>	{/if}	<td align=right>{$row_amt1|number_format:2}</td>	{if $form.is_under_gst}		{assign var=row_gst value=$new[i].qty*$gst_amt}		{assign var=ttl_gst1 value=$ttl_gst1+$row_gst}		<td bgcolor="{$rowcolor2}" align="right">{$row_gst|number_format:2}</td>		{assign var=row_gst_amt value=$row_gst+$row_amt1}		{assign var=ttl_gst_amt1 value=$ttl_gst_amt1+$row_gst_amt}		<td bgcolor="{$rowcolor2}" align="right">{$row_gst_amt|number_format:2}</td>	{/if}</tr>{/section}<tr bgcolor=#ffee99>	<td colspan=6 align=right><b>Total</b></td>	<td align=right>{$qty1|qty_nf}</td>	<td>&nbsp;</td>	{if $form.is_under_gst}		<td>&nbsp;</td>	{/if}	<td align=right>{$amt1|number_format:2}</td>	{if $form.is_under_gst}		<td align=right>{$ttl_gst1|number_format:2}</td>		<td align=right>{$ttl_gst_amt1|number_format:2}</td>	{/if}</tr></table>{/if}<br /><h4>Total Summary</h4>{if $form.is_under_gst}	{assign var=amount_af_ra value=$ttl_gst_amt+$ttl_gst_amt1+$form.rounding_adjust}{else}	{assign var=amount_af_ra value=$form.amount}{/if}{assign var=amount_bf_ra value=$amount_af_ra-$form.rounding_adjust}<input type="hidden" name="amount" value="{$amount_af_ra|number_format:2:'.':''}"><!-- have to put it here since we need to sum up with GST amt --><input type="hidden" name="extra_amount" value="{$form.extra_amount+$ttl_gst1|number_format:2:'.':''}"><table border="0" cellspacing="1" cellpadding="4" width="50%" style="border:1px solid #000"><tr bgcolor="#ffee99">	<th>Sub Total ({$form.currency_code|default:$config.arms_currency.symbol})</th>	<th>Rounding Adjust ({$form.currency_code|default:$config.arms_currency.symbol})</th>	<th>Grand Total ({$form.currency_code|default:$config.arms_currency.symbol})</th></tr><tr>	<td class="r" id="td_sub_ttl">{$amount_bf_ra|number_format:2}</td>	<td align="center"><input name="rounding_adjust" value="{$form.rounding_adjust|number_format:2:'.':''}" onchange="recalc_total();" size="10" class="r"></td>	<td class="r" id="td_grand_ttl">{$amount_af_ra|number_format:2}</td></tr></table><br><h4>Remark</h4><textarea style="border:1px solid #000;width:100%;height:100px;" name=remark2 readonly>{$form.remark2|escape}</textarea><br><h4>Additional Remark</h4><textarea style="border:1px solid #000;width:100%;height:100px;" name=remark>{$form.remark|escape}</textarea><p align=center>	<input type=button value="Close" style="font:bold 20px Arial; background-color:#09f; color:#fff;" onclick="close_window('{$smarty.server.PHP_SELF}')">{if ($config.single_server_mode || (!$config.single_server_mode and $form.branch_id eq $sessioninfo.branch_id))}		<input type=button value="Confirm and Print" style="font:bold 20px Arial; background-color:#090; color:#fff;" onclick="do_confirm(this)">		<input type=button value="Cancel" style="font:bold 20px Arial; background-color:#900; color:#fff;" onclick="do_cancel(this)">	{/if}</p></form><script>init_calendar();</script>