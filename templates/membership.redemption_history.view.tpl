{*3/2/2010 9:59:18 AM Andy- Change to only allow user with privilege to cancel redemption8/18/2010 10:42:26 AM Justin- Added a config['membership_redemption_use_approval'] to disable/enable the verification feature.- Assigned a button called "Verify" to process those unverified redemption.8/25/2010 6:30:34 PM Justin- Added Cash column.- Added cancel button is visible for cancel when it is within limit of cancel days.9/17/2010 6:15:37 PM Justin- Modified the Cancel button to display based on between privilege and approval flow.10/28/2010 5:01:00 PM Justin- Changed all the config for enhanced Membership Redemption become membership_redemption_use_enhanced.11/8/2010 10:47:40 AM Justin- Added more spaces on between IC Scanned Image and redemption item table to prevent conflicts.2/17/2011 11:57:19 AM Justin- Added a label to indicate cancel days limit when found the redemption can do cancel proccess.4/20/2011 11:41:21 AM Justin- Fixed the bugs where cannot close the branch popup window.1/11/2013 11:54 AM Justin- Enhanced to show voucher value and codes when found item contains vouchers.12/23/2013 10:23 AM Fithri- new module 'Stucked Documents Approval'3/7/2014 5:34 PM Justin- Enhanced to have new feature that print prefix receipt no if found config set.11/14/2016 4:49 PM Andy- Enhanced to able to highlight row by item_id.06/29/2020 05:42 PM Sheila- Updated button css.*}{include file='header.tpl'}<script>{literal}function do_cancel(){    if(!confirm('Are you sure to cancel this redemption?')) return;    document.f_cancel.submit();}function do_verify(){    if(!confirm('Are you sure to verify this redemption?')) return;    document.f_verify.submit();}function print_slip(id,branch_id){	document.f_print.target = 'if_print';	//document.f_print['id'].value = id;	//document.f_print['branch_id'].value = branch_id;	//document.f_print.target = '_blank';	document.f_print.submit();}function toggle_img_div(id){		if (document.getElementById(id).style.display == 'none'){		curtain(true);		show_div(id);	}else{		curtain(false);		hide_div(id);	}	return (document.getElementById(id).style.display == 'none');}function show_div(id){	var div = document.getElementById(id);	if (div.style.display=='none') div.style.display='';	if (div.style.position == 'absolute')	    div.style.top = (parseInt(document.body.scrollTop)+50)+'px';	curtain(true);}function hide_div(id){		if (document.getElementById(id).style.display!='none'){	    document.getElementById(id).style.display='none';	    curtain(false);	}}function curtain_clicked(){    $('ic_org').hide();    curtain(false);}{/literal}</script><form name="f_verify" method="post">	<input type="hidden" name="a" value="verify" />	<input type="hidden" name="id" value="{$form.id}" />	<input type="hidden" name="branch_id" value="{$form.branch_id}" />	<input type="hidden" name="approval_history_id" value="{$form.approval_history_id}" />	<input type="hidden" name="approvals" value="{$form.approvals}" />	<input type="hidden" name="status" value="1" />	{if $approval_on_behalf}	<input type="hidden" name="on_behalf_of" value="{$approval_on_behalf.on_behalf_of}" />	<input type="hidden" name="on_behalf_by" value="{$approval_on_behalf.on_behalf_by}" />	{/if}</form><form name="f_cancel" method="post">	<input type="hidden" name="a" value="cancel" />	<input type="hidden" name="id" value="{$form.id}" />	<input type="hidden" name="branch_id" value="{$form.branch_id}" />	<input type="hidden" name="approval_history_id" value="{$form.approval_history_id}" />	<input type="hidden" name="approvals" value="{$form.approvals}" />	<input type="hidden" name="is_approval" value="{$form.is_approval}" />	<input type="hidden" name="status" value="5" />	{if $approval_on_behalf}	<input type="hidden" name="on_behalf_of" value="{$approval_on_behalf.on_behalf_of}" />	<input type="hidden" name="on_behalf_by" value="{$approval_on_behalf.on_behalf_by}" />	{/if}</form><iframe name="if_print" style="visibility:hidden;width:1px;height:1px;"></iframe><form name="f_print" style="display:none;" action="membership.redemption_history.php">	<input type="hidden" name="a" value="print_slip" />	<input type="hidden" name="id" value="{$form.id}" />	<input type="hidden" name="branch_id" value="{$form.branch_id}" /></form><div id="ic_org" style="display:none; padding:10px; background-color: #fff; border:4px solid #999; position:fixed; top:150px; left:150px;z-index:20000;">	<div class=small style="position:absolute; right:10px;">		<a href="javascript:void(default_curtain_clicked())"><img src=ui/closewin.png border=0 align=absmiddle></a>	</div>	<img src="{$ic_path}"><br /><br /></div><table align=right ><tr><td align=center><h4>Scanned IC Image</h4><img src="{$ic_path}" width=200 style="border:1px solid #999; padding:8px; background-color:#fff;cursor:pointer;z-index:100" onClick="toggle_img_div('ic_org');"><br>click to see full size</td></tr></table><h1>{$PAGE_TITLE} - {$form.redemption_no} {if !$form.verified and !$form.status}	(Waiting for Verification){elseif $form.verified and !$form.status}	(Completed){elseif $form.status}	(Cancelled){/if}{if $approval_on_behalf}<br />(on behalf of {$approval_on_behalf.on_behalf_of_u}){/if}</h1><table>	<tr valign="top">	    <td>	        <div class="stdframe">			<h4>Redemption Info</h4>			<table>			<tr><td width="100"><b>Total Qty</b></td><td>{$form.total_qty|number_format}</td></tr>			<tr><td><b>Point Use</b></td><td>{$form.total_pt_need|number_format}</td></tr>			<tr><td><b>Date</b></b></td><td>{$form.date}</td></tr>			<tr><td><b>Redemption No</b></b></td><td>{$form.redemption_no}</td></tr>			</table>			</div>		</td>		<td>		    <div class="stdframe">			<h4>Membership Info</h4>			<table>			<tr><td width="100"><b>Name</b></td><td>{$membership_info.designation} {$membership_info.name}</td></tr>			<tr><td><b>NRIC</b></td><td>{$membership_info.nric}</td></tr>			<tr><td><b>{$config.membership_cardname} Number</b></b></td><td>{$form.card_no}</td></tr>			</table>			</div>		</td>	</tr></table>{if $sessioninfo.privilege.MEMBERSHIP_CANCEL_RE and $form.status eq 0 and $form.can_cancel}<br /><b>* Redemption can only be cancel within {$days_limit} days.</b>{/if}<br /><br /><br /><br /><br /><br /><br /><br /><div>    <table width="100%" style="border:1px solid #999; padding:5px; background-color:#fe9" border=0 cellspacing=1 cellpadding=1>		<tr bgcolor="#ffffff">			<th width="20">&nbsp;</th>			<th nowrap>ARMS Code</th>			<th nowrap>Article No			<th nowrap>MCode</th>			<th>SKU Description</th>			<th>Pts</th>			<th>Cash</th>			<th nowrap width=80>Qty</th>			<th width="100">Total Pts</th>			<th width="100">Total Cash</th>			<th>Receipt Info</th>		</tr>		{foreach from=$items item=r name=f}		    {assign var=total_qty value=$total_qty+$r.qty}		    {assign var=row_pts value=$r.qty*$r.pt_need}		    {assign var=row_cash value=$r.qty*$r.cash_need}		    {assign var=total_pts value=$total_pts+$row_pts}		    {assign var=total_cash value=$total_cash+$row_cash}		    		    <tr onmouseover="this.bgColor='#ffffcc';" onmouseout="this.bgColor='';" class="{if $smarty.request.highlight_item_id eq $r.id}highlight_row{/if}">		        <td>{$smarty.foreach.f.iteration}.</td>		        <td>{$r.sku_item_code}</td>		        <td>{$r.artno}</td>		        <td>{$r.mcode}</td>		        <td>					{$r.description}					{if $r.is_voucher}						<font style="color:blue;">							<br />							Voucher Value: {$r.voucher_value|number_format:2}<br />							Voucher Codes: {$r.voucher_code}						</font>					{/if}				</td>		        <td class="r">{$r.pt_need|number_format}</td>		        <td class="r">{$r.cash_need|number_format:2|default:0}</td>		        <td class="r">{$r.qty|number_format}</td>		        <td class="r">{$row_pts|number_format}</td>		        <td class="r">{$row_cash|number_format:2}</td>		        <td nowrap>		            {if $r.receipt_no}		                Receipt No: {receipt_no_prefix_format branch_id=$r.branch_id counter_id=$r.counter_id receipt_no=$r.receipt_no}<br />						Receipt Date: {$r.receipt_date}<br />						Counter: {$r.counter_no}		            {/if}		        </td>		    </tr>		{/foreach}		<tr bgcolor="#ffffff">		    <th colspan="5" class="r">Total</th>		    <th class="r">-</th>		    <th class="r">-</th>		    <th class="r">{$total_qty|number_format}</th>		    <th class="r">{$total_pts|number_format}</th>		    <th class="r">{$total_cash|number_format:2}</th>		    <th>&nbsp;</th>		</tr>	</table></div><p align="center">	{assign var=days_added value=$form.date|date_format:'%d'}    {if $config.membership_redemption_use_enhanced and $form.approval_history_id ne '0' and $form.verified eq 0 and $form.is_approval and $smarty.request.do_verify}  		<input type=button value="Verify" style="font: bold 20px Arial; background-color: rgb(255, 153, 0); color: rgb(255, 255, 255);" onclick="do_verify();">  	{/if}    {if $sessioninfo.privilege.MEMBERSHIP_CANCEL_RE and $form.status eq 0 and $form.can_cancel}		<input type=button value="Cancel" style="font:bold 20px Arial; background-color:#900; color:#fff;" onclick="do_cancel();">  	{/if}    <input type=button class="btn btn-error" value="Close" onclick="document.location='/membership.redemption_history.php?t={$t}&branch_id={$form.branch_id}{if $smarty.request.do_verify}&do_verify={$smarty.request.do_verify}{/if}{if $search_str}&search_str={$search_str}{/if}'">    {if $form.status eq 0}        <input class="btn btn-primary" type=button value="Print" onclick="print_slip()">    {/if}</p><script>new Draggable('ic_org');</script>{include file='footer.tpl'}