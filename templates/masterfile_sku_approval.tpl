{*Revision History================4 Apr 2007 - yinsee- 	check for $config.sku_application_require_multics to enable/disable multics code columns1/7/2010 11:09:15 AM Andy- make approval list will auto select given sku if id is passed1/7/2010 4:47:22 PM Andy- Fix some javascript error8/13/2010 10:14:09 AM Andy- Add SKU without inventory. (control by category + sku and can be inherit)- Add Fresh Market Sku. (control by category + sku and can be inherit)(Need Config)8/19/2010 2:41:27 PM Andy- Add config control to no inventory sku.9/9/2010 5:04:56 PM Andy- Fix sku trade discount code cannot show in cosignment mode some module.3/10/2011 4:43:37 PM Andy- Add PO reorder qty min & max at edit/apply SKU.10/10/2011 10:52:45 AM Alex- add $config.global_cost_decimal_points & qty_nf control cost and qty decimal point4/23/2012 4:44:12 PM Justin- Added to show PO reorder qty by branch.5/7/2012 10:47:00 AM Andy- Add missed "Scale Type" in SKU Application Status.5/16/2012 11:12:32 AM Justin- Fixed bugs that system show the form in fancy after add show PO reorder qty by branch.7/26/2012 3:23 PM Andy- Add non-returnable feature.07/12/2013 04:21 PM Justin- Bug fixed on having wrong indication of have_sn, it should be 2=Yes instead of 1=Yes (pre-list).4/3/2014 2:28 PM Justin- Enhanced to have "Notify Person" drown-down list for PO Reorder Qty.- Enhanced to have PO Reorder by Child info.8/21/2014 1:49 PM Justin - Enhanced to show Input, Output & Inclusive Taxes.9/15/2014 5:57 PM Justin- Enhanced to have show/hide gst settings.3/19/2015 5:58 PM Andy- Change "Inclusive Tax" to "Selling Price Inclusive Tax".7/16/2015 10:42 AM Andy- Enhanced to show real inclusive tax/input tax/output tax when is inherit.- Add assign $items[i] to $item_r.6/20/2016 2:47 PM Andy- Remove SKU Approval KIV button.4/25/2017 1:20 PM Khausalya- Enhanced changes from RM to use config setting. 5/29/2019 9:00 AM William- Added new PO Reorder Qty "Moq".6/23/2020 03:30 PM Sheila- Updated button css*}{include file=header.tpl}{literal}<script type="text/javascript">var last_idx;function do_terminate(){	document.f_a.reason2.value = '';	var p = prompt('Enter reason to terminate:');	if (p.trim()=='' || p==null) return;	document.f_a.reason2.value = p;	if (confirm('Press OK to Terminate the SKU Application.'))	{		document.f_a.submit();	}}function do_kiv(){	if (confirm('Press OK to KIV the SKU Application.'))	{	    document.f_a.a.value = "kiv_approval";	    document.f_a.submit();	}}function f_check(){	// make sure all description is filled	/*var x = document.f_a.getElementsByTagName('input');	for (i=0; i<x.length; i++)	{		if (x[i].name.indexOf('description[')==0 && empty(x[i], 'You must enter Description'))		{			return false;		}		if (x[i].name.indexOf('receipt_description[')==0 && empty(x[i], 'You must enter Receipt Description'))		{			return false;		}	} //--reject no check .. 18702*/	if (document.f_a.elements['approval[general]'].value == '')	{		alert("Approve or Reject not selected for General Information");	    document.f_a.elements['approval[general]'].focus();    	return false;	}	var v;	for (id=0; id<last_idx; id++)	{	    v = document.f_a.elements['approval['+id+']'].value;		if (v =='')		{			alert("Approve or Reject not selected for item "+id);	    	document.f_a.elements['approval['+id+']'].focus();	    	return false;		}		else if (v == 'Approve' && empty($('description['+id+']'), 'You must enter Description'))		{		    return false;		}		else if (v == 'Approve' && empty($('receipt_description['+id+']'), 'You must enter Receipt Description'))		{		    return false;		}	}	if (confirm('Press OK to submit the Application Status for this SKU Application.'))	{		document.f_a.bsubmit.disabled = true;	    return true;	}	return false;}function sel_reason(id){	if (document.f_a.elements['approval['+id+']'].value == 'Reject')	{	    $('reject_box['+id+']').style.display = '';	    //document.f_a.elements['approval_other['+id+']'].select();	    //document.f_a.elements['approval_other['+id+']'].focus();	}	else	{	    $('reject_box['+id+']').style.display = 'none';	}}</script>{/literal}<h1>SKU Approval #{$form.id} (Status: {if $form.status == 1}Approved{elseif $form.status == 2}Rejected{elseif $form.status == 3}KIV{elseif $form.status == 4}Terminated{else}Newly added{/if})</h1><form name="f_a" action="masterfile_sku_application.php" method=post onsubmit="return f_check()"><input type=hidden name=a value="save_approval"><input type=hidden name=id value="{$form.id}"><input type=hidden name=reason2 value=""><input type=hidden name=approval_history_id value="{$form.approval_history_id}"><div class="stdframe"><!--- show approval log --->{if $form.approval_history_items}	<h4>Application Status</h4>	<div style="background-color:#fff; border:1px dashed #00f; padding:5px;">	{foreach from=$form.approval_history_items item=aitem}	<div>	<font class="small" color=##006600>{$aitem.timestamp} by {$aitem.u}</font><br>	{if $aitem.status == 1}	<img src=ui/checked.gif vspace=2 align=absmiddle> <b>{$aitem.log.general}</b>	{elseif $aitem.status == 2}	{foreach from=$aitem.log.general item=log key=log_k}	{if $log ne 'Others'}	<img src=ui/deact.png vspace=2 align=absmiddle> {$log}<br>	{/if}	{/foreach}	{else}	<img src=ui/del.png vspace=2 align=absmiddle> <b>{$aitem.log.general}</b>	{/if}	</div>	{/foreach}	</div>{/if}<h4>General Information</h4>{if $errm.top}	<div id=err><div class=errmsg><ul>	{foreach from=$errm.top item=e}	<li> {$e} </li>	{/foreach}	</ul></div></div>{/if}<table  border=0 cellpadding=4 cellspacing=1>	<tr>		<td><b>Apply By</b></td>		<td>{$form.username}</td>	</tr>	<tr>		<td><b>Apply Branch</b></td>		<td>{$form.apply_branch_code}</td>	</tr>	<tr>		<td nowrap><b>Application Time</b></td>		<td>{$form.added}</td>	</tr>	<tr>		<td><b>Category</b></td>		<td>{$form.category}</td>	</tr>	<tr>		<td><b>SKU Type</b></td>		<td>{$form.sku_type}</td>	</tr>	{if $config.enable_no_inventory_sku}		<!-- No Inventory -->		<tr>			<td><b>SKU Without Inventory</b></td>			<td>{$inherit_options[$form.no_inventory]}</td>		</tr>	{/if}	{if $config.enable_fresh_market_sku}		<!-- Fresh Market SKU -->		<tr>			<td><b>Is Fresh Market SKU</b></td>			<td>{$inherit_options[$form.is_fresh_market]}</td>		</tr>	{/if}	{if !$config.consignment_modules}		<!-- Scale Type -->		<tr>			<td><b>Scale Type</b></td>			<td>{$scale_type_list[$form.scale_type]|default:'--'}</td>		</tr>	{/if}	<tr>		<td><b>Vendor</b></td>		<td>{$form.vendor}</td>	</tr>	<tr>		<td><b>Brand</b></td>		<td>{$form.brand|default:'UN-BRANDED'}	</td>	</tr>	<tr>		<td><b>Trade Discount</b></td>		<td>		    {if $config.sku_always_show_trade_discount} <!-- consignment part -->		        {$form.default_trade_discount_code}		    {else}		        <!-- outright part -->				{if $form.trade_discount_type == 0}				no trade discount				{elseif $form.trade_discount_type == 1}				use Brand Table				{else}				use Vendor Table				{/if}		    {/if}		</td>	</tr>	{if $form.trade_discount_type > 0 and !$config.sku_always_show_trade_discount}		<tr>			<td><b>Trade Discount Table</b></td>			<td>			    <table  border=0 cellpadding=4 cellspacing=2>				<tr bgcolor=#ffffff>				{section name=c loop=$trade_discount_table}				<th>{if $form.default_trade_discount_code eq $trade_discount_table[c].code}<img src=ui/checked.gif align=absmiddle> {/if}{$trade_discount_table[c].code}</th>				{/section}				</tr>				<tr>				{section name=c loop=$trade_discount_table}				{assign var=ccode value=`$trade_discount_table[c].code`}				<td>{$form.trade_discount_table.$ccode}</td>				{/section}				</tr>			    </table>			</td>		</tr>	{/if}	<tr>		<td valign=top><b>Listing Fee</b></td>		<td>{$form.listing_fee_type}			<!-- fee -->		{if $form.listing_fee_type eq 'Listing Fee'}		<div><b>Listing Fee Amount</b>: {$config.arms_currency.symbol} {$form.listing_fee_remark.amount|number_format:2}		({$form.listing_fee_remark.when} {if $form.listing_fee_remark.dn}#{$form.listing_fee_remark.dn}{/if})</div>		{/if}			<!-- package -->		{if $form.listing_fee_type eq 'Package'}		<div>		<b>Package Amount</b>: {$config.arms_currency.symbol} {$form.listing_fee_remark.amount|number_format:2} ({$form.listing_fee_remark.when})<br>		<b>No. of SKU</b>:  {$form.listing_fee_remark.count}		{if $form.listing_fee_remark.first_sku_id>0}(SKU Package REF#: {$form.listing_fee_remark.first_sku_id} {if $form.listing_fee_remark.dn}#{$form.listing_fee_remark.dn}{/if}){/if}		</div>		{/if}			<!-- package -->		{if $form.listing_fee_type eq 'Package2'}		<div>		<b>Package Amount</b>: {$config.arms_currency.symbol} {$form.listing_fee_remark.amount|number_format:2} ({$form.listing_fee_remark.when} {if $form.listing_fee_remark.dn}#{$form.listing_fee_remark.dn}{/if})<br>		<b>No. of Variety</b>:  {$form.listing_fee_remark.count}		</div>		{/if}			<!-- inkind -->		{if $form.listing_fee_type eq 'In Kind'}		<table border=0 cellspacing=2 cellpadding=4 >		<tr bgcolor=#ffffff><th>Item</th><th>Qty</th><th>Unit Cost</th><th>Total Cost</th></tr>		{assign var=n value=0}		{foreach name=f from=$form.listing_fee_remark.item item=ft}		<tr>			<td>{$form.listing_fee_remark.item[$smarty.foreach.f.index]}</td>			<td>{$form.listing_fee_remark.qty[$smarty.foreach.f.index]|qty_nf}</td>			<td>{$form.listing_fee_remark.cost[$smarty.foreach.f.index]|number_format:$config.global_cost_decimal_points}</td>			<td>{$form.listing_fee_remark.total_cost[$smarty.foreach.f.index]}</td>		</tr>		<!-- {$n++} -->		{/foreach}		</table>		{/if}		</td>	</tr>	<tr>		<td><b>Note</b></td>		<td>{$form.note|nl2br|default:'<i>- no comment was added -</i>'}</td>	</tr>	{if $config.sku_application_require_multics}		<tr>			<td valign=top><b>{$config.link_code_name}</b></td>			<td>				<table class=body>				<tr>					<td><b>Department</b></td>					<td width=100>{$form.multics_dept|default:"-"}</td>					<td><b>Section</b></td>					<td width=100>{$form.multics_section|default:"-"}</td>					<td><b>Category</b></td>					<td width=100>{$form.multics_category|default:"-"}</td>				</tr>				<tr>					<td><b>Brand</b></td>					<td width=100>{$form.multics_brand|default:"-"}</td>					<td><b>Price Type</b></td>					<td width=100>{$form.multics_pricetype|default:"-"}</td>				</tr>				</table>			</td>		</tr>	{/if}	{if $config.enable_sn_bn}		<tr>			<td><b>Use Serial No</b></td>			<td>				{if $form.have_sn eq '0'}					No				{elseif $form.have_sn eq '1'}					Yes (Pre-list)				{elseif $form.have_sn eq '2'}					Yes				{/if}			</td>		</tr>	{/if}	<tr valign="top">		<td><b>PO Reorder Qty</b></td>		<td nowrap>			{if $form.po_reorder_by_child}				<img src="/ui/checked.gif" align="absmiddle" /> By Child			{else}				Min: {$form.po_reorder_qty_min|default:'-'}				&nbsp;&nbsp;&nbsp;				Max: {$form.po_reorder_qty_max|default:'-'}				&nbsp;&nbsp;&nbsp;				MOQ: {$form.po_reorder_moq|default:'-'}				&nbsp;&nbsp;&nbsp;				Notify Person: 				{if $form.po_reorder_notify_user_id}					{assign var=po_reorder_user_id value=$form.po_reorder_notify_user_id}					{$po_reorder_users.$po_reorder_user_id.u}				{/if}				{if !$config.consignment_modules}					&nbsp;&nbsp;&nbsp;					<span id="qty_setup">						{if $form.po_reorder_qty_by_branch.min || $form.po_reorder_qty_by_branch.max}							<img src="ui/checked.gif" align="absmiddle">						{else}							<img src="ui/unchecked.gif" align="absmiddle">						{/if} Overwrite PO Reorder qty by Branch					</span>										{if $form.po_reorder_qty_by_branch.min || $form.po_reorder_qty_by_branch.max}						<br />						<br />											<div style="border:1px solid grey; overflow:auto; padding: 2px; width:80%;">							<table width="100%">								{foreach from=$branch_list key=bid item=b}									<tr>										<td><b>{$b.code}</b></td>										<td>Min: {$form.po_reorder_qty_by_branch.min.$bid|default:'0'}</td>										<td>Max: {$form.po_reorder_qty_by_branch.max.$bid|default:'0'}</td>										<td>MOQ: {$form.po_reorder_qty_by_branch.moq.$bid|default:'0'}</td>										<td nowrap>											Notify Person: 											{if $form.po_reorder_qty_by_branch.notify_user_id.$bid}												{assign var=po_reorder_user_id value=$form.po_reorder_qty_by_branch.notify_user_id.$bid}												{$po_reorder_users.$po_reorder_user_id.u}											{else}												-											{/if}										</td>									</tr>								{/foreach}							</table>						</div>					{/if}				{/if}			{/if}		</td>	</tr>		{if $config.sku_non_returnable}		<tr valign="top">			<td nowrap><b>Non-returnable</b></td>			<td>				{if $form.group_non_returnable eq 0}No{else}Yes{/if}			</td>		</tr>	{/if}		{if $gst_settings}		<tr>			<td><b>Input Tax</b></td>			<td colspan="5">				{if $form.mst_input_tax eq -1}					Inherit (Follow Category) {$form.real_input_tax.code} {$form.real_input_tax.rate|number_format}%				{else}					{foreach from=$input_tax_list key=rid item=r}						{if $form.mst_input_tax eq $r.id}{$r.code} - {$r.description}{/if}					{/foreach}				{/if}			</td>		</tr>		<tr>			<td><b>Output Tax</b></td>			<td colspan="5">				{if $form.mst_output_tax eq -1}					Inherit (Follow Category) {$form.real_output_tax.code} {$form.real_output_tax.rate|number_format}%				{else}					{foreach from=$output_tax_list key=rid item=r}						{if $form.mst_output_tax eq $r.id}{$r.code} - {$r.description}{/if}					{/foreach}				{/if}			</td>		</tr>		<tr>			<td><b>Selling Price Inclusive Tax</b></td>			<td colspan="5">				{if $form.mst_inclusive_tax eq "inherit"}					Inherit (Follow Category) {$inherit_options[$form.real_inclusive_tax]}				{else}					{$form.mst_inclusive_tax|strtoupper}				{/if}			</td>		</tr>	{/if}</table></div>{if $smarty.request.a eq 'approval'}<br><div align=center><img src=ui/arrow_up.png align=absmiddle><select name=approval[general] onchange="sel_reason('general')"><option value="">-- Select Approve or Reason to Reject --</option><option value="Approve">Approve</option><option value="Reject">Reject</option></select><div id=reject_box[general] style="text-align:left; display:none; width:300px; white-space: nowrap"><h5>Reject Reason</h5><input type=checkbox name="reason[general][]" value="Spelling Mistake">Spelling Mistake<br><input type=checkbox name="reason[general][]" value="Wrong Category">Wrong Category<br><input type=checkbox name="reason[general][]" value="Wrong SKU Type">Wrong SKU Type<br><input type=checkbox name="reason[general][]" value="Wrong Vendor">Wrong Vendor<br><input type=checkbox name="reason[general][]" value="Wrong Brand">Wrong Brand<br><input type=checkbox name="reason[general][]" value="Wrong Trade Discount Table">Wrong Trade Discount Table<br><input type=checkbox name="reason[general][]" value="No Listing Fee">No Listing Fee<br><input type=checkbox name="reason[general][]" value="Listing fee too low">Listing Fee too low<br>{if $config.sku_application_require_multics}<input type=checkbox name="reason[general][]" value="Wrong Multics Department Code">Wrong Multics Department Code<br><input type=checkbox name="reason[general][]" value="Wrong Multics Section Code">Wrong Multics Section Code<br><input type=checkbox name="reason[general][]" value="Wrong Multics Brand Code">Wrong Multics Brand Code<br>{/if}<input type=checkbox name="reason[general][]" value="Others" onchange="f_a.elements['approval_other[general]'].disabled=(!this.checked)">Other reasons: <input name=approval_other[general] size=30 disabled><br></div></div>{/if}{section name=i loop=$items}	{assign var=item_r value=$items[i]}<br><div class="stdframe">	<!--- show approval log --->{if $form.approval_history_items}    {assign var="item_n" value=`$smarty.section.i.iteration-1`}	<h4>Application Status</h4>	<div style="background-color:#fff; border:1px dashed #00f; padding:5px;">	{foreach from=$form.approval_history_items item=aitem}	<div>	<font class="small" color=##006600>{$aitem.timestamp} by {$aitem.u}</font><br>	{if $aitem.status == 1}	<img src=ui/checked.gif vspace=2 align=absmiddle> <b>{$aitem.log[$item_n]}</b>	{elseif $aitem.status == 2}	{foreach from=$aitem.log[$item_n] item=log key=log_k}	{if $log ne 'Others'}	<img src=ui/deact.png vspace=2 align=absmiddle> {$log}<br>	{/if}	{/foreach}	{else}	<img src=ui/del.png vspace=2 align=absmiddle> <b>{$aitem.log[$item_n]}</b>	{/if}	</div>	{/foreach}	</div>{/if}{if $items[i].product_matrix}{include file=masterfile_sku_approval.atom_matrix.tpl}{else}{include file=masterfile_sku_approval.atom_variety.tpl}{/if}</div>{if $smarty.request.a eq 'approval'}<br><div align=center><img src=ui/arrow_up.png align=absmiddle><select name=approval[{$smarty.section.i.index}] onchange="sel_reason('{$smarty.section.i.index}')"><option value="">-- Select Approve or Reason to Reject --</option><option value="Approve">Approve</option><option value="Reject">Reject</option></select><div id=reject_box[{$smarty.section.i.index}] style="text-align:left; display:none; width:300px; white-space: nowrap"><h5>Reject Reason</h5><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Spelling Mistake">Spelling Mistake<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Wrong Article or Manufacturer Code">Wrong Article or Manufacturer Code<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Inproper Description">Inproper Description<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Selling Price too high">Selling Price too high<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Selling Price too low">Selling Price too low<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Profit Margin too low">Profit Margin too low<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Wrong Photo">Wrong Photo<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Photo not clear">Photo not clear<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Product not suitable">Product not suitable<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Not encouraged">Not encouraged<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Wrong Product Matrix table">Wrong Product Matrix table<br><input type=checkbox name="reason[{$smarty.section.i.index}][]" value="Others" onchange="f_a.elements['approval_other[{$smarty.section.i.index}]'].disabled=(!this.checked)">Other reasons: <input name=approval_other[{$smarty.section.i.index}] size=30 disabled><br></div></div>{/if}{/section}{if $smarty.request.a eq 'approval'}<script>last_idx = '{$smarty.section.i.index}';</script><p align=center><input name=bsubmit type=submit value="Submitf" style="font:bold 20px Arial; background-color:#f90; color:#fff;"><input type=button value="Terminate" style="font:bold 20px Arial; background-color:#900; color:#fff;" onclick="do_terminate()">{*<input type=button value="KIV (Pending)" style="font:bold 20px Arial; background-color:#09f; color:#fff;" onclick="do_kiv()">*}</p>{else}<p align=center><input type=button class="btn btn-error" onclick="close_window('/masterfile_sku.php')" value="Close"></p>{/if}</form>{include file=footer.tpl}{if $form.status == 4 && $smarty.request.a eq 'approval'}<script>window.scrollTo(0,document.body.scrollHeight);alert("Note:\nThis SKU Application has been marked for terminate by previous approval person.\nClick the TERMINATE button if you agree with the decision.\n");</script>{/if}