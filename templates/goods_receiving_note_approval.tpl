{*7/11/2011 11:54:42 AM Justin- Added to show GRN ID in the GRN selection list.12/23/2013 10:23 AM Fithri- new module 'Stucked Documents Approval'7/21/2015 9:32 AM joo Chia- Remove checking of do_validate when submit.8/9/2018 5:36 PM Justin- Enhanced to show images attached from GRR.6/4/2019 1:28 PM William- Enhanced ID to use report_prefix.*}{include file=header.tpl}{literal}<style>.pv{	color:#fff;	background:#0c0;	font-weight:bold;	font-size:1.1em;	padding:0 5px;	text-align: right;}.nv{	color:#fff;	background:#e00;	font-weight:bold;	font-size:1.1em;	padding:0 5px;	text-align: right;}div.imgrollover{	float:left;	height:105px;	overflow:hidden;	border:1px solid transparent;	padding:2px;}div.imgrollover:hover{	background:#fff;	height:130px;	border:1px solid #999;	padding:2px;}</style>{/literal}<script>var grn_have_tax = '{$config.grn_have_tax}';var phpself = '{$smarty.server.PHP_SELF}';{literal}function do_cancel(){	document.f_a.comment.value = '';	var p = prompt('Enter reason to terminate/Cancel:');	if (p.trim()=='' || p==null) return;	document.f_a.comment.value = p;	if (confirm('Press OK to Terminate this GRN.'))	{		document.f_a.a.value = "cancel";		document.f_a.submit();	}}function do_reject(){	var error = false;	if(document.f_a.elements['type'].value == "PO"){ // 4 options to reject		if(document.f_do_reject.elements['confirm_grn'].checked == false && document.f_do_reject.elements['div1'].checked == false && document.f_do_reject.elements['div2'].checked == false && document.f_do_reject.elements['div3'].checked == false && document.f_do_reject.elements['div4'].checked == false){			error = true;		}	}else{ // only 2 options to reject		if(document.f_do_reject.elements['confirm_grn'].checked == false && document.f_do_reject.elements['div2'].checked == false && document.f_do_reject.elements['div4'].checked == false){			error = true;		}	}	if(error){		alert("No reject type was tick, please tick before confirm again.");		return false;	}		if(!confirm('Are you sure to reject?'))  return false;	document.f_do_reject.submit();	return false;}function do_approve(){	//if(do_validate() == false) return;	if(!confirm('Are you sure to approve?'))  return;	document.f_a.a.value = "approve";	document.f_a.submit();}function select_tab(obj){	if (obj == undefined){		var lst = $('tab').getElementsByTagName("LI");		if (lst.length==0){			alert('Congratulation! You have completed all approval jobs.\nTake a break ;)');			document.location = '/home.php';			return;		}		lst[0].className = "active";		load_approval(lst[0]);	}	else{		var lst = $('tab').getElementsByTagName("LI");		$A(lst).each( function(r,idx) {			if (r.className == "active")				r.className = '';		});		obj.className = "active";		load_approval(obj);	}}function load_approval(obj){    var line = obj.title.split(",");	id =line[0];	branch_id = line[1];	$('sel_name').innerHTML = obj.innerHTML;	$('udiv').innerHTML = '<img src=ui/clock.gif align=absmiddle> Loading...<br><img src=ui/pixel.gif height=500 width=1>';	new Ajax.Updater('udiv', phpself, {		parameters: 'a=ajax_load_grn&id='+id+'&branch_id='+branch_id+'&'+Form.serialize(document.f_on_behalf),		evalScripts: true	});}function do_reset(){    document.f_do_reset['reason'].value = '';	var p = prompt('Enter reason to Reset :');	if (p==null || p.trim()=='' ) return false;	document.f_do_reset['reason'].value = p;	if(!confirm('Are you sure to reset?'))  return false;	document.f_do_reset.submit();	return false;}function do_reject_dialog(){	showdiv('reject_dialog');	//center_div('reject_dialog');	$('reject_dialog').style.zIndex = 10000;	curtain(true);}function reject_all(check_type){	var type = document.f_a.elements['type'].value;	if(check_type == undefined || check_type == ""){		if(document.f_do_reject.elements['confirm_grn'].checked == true){			if(type == "PO"){				document.f_do_reject.elements['div1'].disabled = true;				document.f_do_reject.elements['div1'].checked = true;				document.f_do_reject.elements['div3'].disabled = true;				document.f_do_reject.elements['div3'].checked = true;			}			document.f_do_reject.elements['div2'].disabled = true;			document.f_do_reject.elements['div2'].checked = true;			document.f_do_reject.elements['div4'].disabled = true;			document.f_do_reject.elements['div4'].checked = true;		}else{			if(type == "PO"){				document.f_do_reject.elements['div1'].disabled = false;				document.f_do_reject.elements['div1'].checked = false;				document.f_do_reject.elements['div3'].disabled = false;				document.f_do_reject.elements['div3'].checked = false;			}			document.f_do_reject.elements['div2'].disabled = false;			document.f_do_reject.elements['div2'].checked = false;			document.f_do_reject.elements['div4'].disabled = false;			document.f_do_reject.elements['div4'].checked = false;		}	}else if(check_type == "div1"){		if(document.f_do_reject.elements['div1'].checked == true){			document.f_do_reject.elements['div2'].checked = true;			document.f_do_reject.elements['div2'].disabled = true;			document.f_do_reject.elements['div4'].checked = true;			document.f_do_reject.elements['div4'].disabled = true;		}else{			document.f_do_reject.elements['div2'].checked = false;			document.f_do_reject.elements['div2'].disabled = false;			document.f_do_reject.elements['div4'].checked = false;			document.f_do_reject.elements['div4'].disabled = false;		}	}else if(check_type == "div2"){		if(document.f_do_reject.elements['div2'].checked == true){			document.f_do_reject.elements['div4'].checked = true;			document.f_do_reject.elements['div4'].disabled = true;		}else{			document.f_do_reject.elements['div4'].checked = false;			document.f_do_reject.elements['div4'].disabled = false;		}	}else if(check_type == "div4"){		if(document.f_do_reject.elements['div4'].checked == true){			if(type == "PO"){				document.f_do_reject.elements['div1'].checked = true;				document.f_do_reject.elements['div1'].disabled = true;			}			document.f_do_reject.elements['div2'].checked = true;			document.f_do_reject.elements['div2'].disabled = true;		}else{			if(type == "PO"){				document.f_do_reject.elements['div1'].checked = false;				document.f_do_reject.elements['div1'].disabled = false;			}			document.f_do_reject.elements['div2'].checked = false;			document.f_do_reject.elements['div2'].disabled = false;		}	}}function do_validate(){	var item_return = $('tbl_item_2').getElementsByClassName("2_item_return");	var total_rows = item_return.length;	var is_false;	if(total_rows > 0){		$A(item_return).each(			function (r,idx){				if (r.name.indexOf("2_item_return[")==0){					if(r.checked == false){						is_false = true;						return false;					}				}			}		);	}		if(is_false){		alert("All Invalid SKU Items must be tick!");		return false;	}}function check_return(doc_type, id){	if($(doc_type+'_item_return'+id).checked == true){		$(doc_type+'_item_return'+id).value = 1;	}else{		$(doc_type+'_item_return'+id).value = 0;	}}function check_all_return(doc_type){	var item_return = $('tbl_item_'+doc_type).getElementsByClassName(doc_type+"_item_return");	var total_rows = item_return.length;	if(total_rows > 0){		$A(item_return).each(			function (r,idx){				if($('check_return_'+doc_type).checked == true){					r.value = 1;					r.checked = true;				}else{					r.value = 0;					r.checked = false;				}			}		);	}}function reset_row(doc_type){	var e = $('grn_items_'+doc_type).getElementsByClassName(doc_type+'_no');	var total_row=e.length;	for(var i=0;i<e.length;i++)	{ 		var temp_1 =new RegExp('^'+doc_type+'_no_');	 	if (temp_1.test(e[i].id)){			td_1=(i+1)+'.';			e[i].innerHTML=td_1;			e[i].id=doc_type+'_no_'+(i+1);		}	}}/* No longer usefunction ajax_add_variance_item(sid, variance, parent_id, doc_type){	if(!confirm('Are you sure want to return this extra qty?')) return;	var param_str = Form.serialize(document.f_a) + '&a=ajax_add_variance_item';	new Ajax.Request(phpself, {		method:'post',		parameters: param_str+'&sid='+sid+'&variance='+variance+'&parent_id='+parent_id+'&doc_type='+doc_type,		evalScripts: true,		onFailure: function(m) {			alert(m.responseText);		},		onSuccess: function(m) {			eval("var json = "+m.responseText);			for(var tr_key in json){				new Insertion.Bottom($$('.multiple_add_container_'+doc_type).first(),json[tr_key]['html']);				$(doc_type+'_qty_var'+parent_id).innerHTML = "&nbsp;";				$(doc_type+'_qty'+parent_id).innerHTML = float(document.f_a.elements[doc_type+'_pcs['+parent_id+']'].value) - float(variance);				document.f_a.elements[doc_type+'_pcs['+parent_id+']'].value = float(document.f_a.elements[doc_type+'_pcs['+parent_id+']'].value) - float(variance);								// calculate the total amount after make variance return				var b = float(document.f_a.elements[doc_type+'_pcs['+parent_id+']'].value) / float(document.f_a.elements[doc_type+'_uom_fraction['+parent_id+']'].value);				document.f_a.elements[doc_type+'_amt['+parent_id+']'].value = round2(b*(float(document.f_a.elements[doc_type+'_cost['+parent_id+']'].value)));			}		},		onComplete: function(m) {			reset_row(doc_type);		}	});}*/function curtain_clicked(){	hidediv("reject_dialog");	curtain(false);}function download_image(obj,fp){	$('_download').src = "goods_receiving_record.php?a=download_photo&f="+fp;}</script><style>#tab_sel {	border:1px solid #ccc;	width:500px;	padding:4px;	background:#fff url('/ui/findcat_expand.png') right center no-repeat;}#tab_sel ul {	position:absolute;	visibility:hidden;	background:#fff;	border:1px solid #ccc;	border-top:none;	list-style:none;	margin:0;padding:0;	margin-left:-5px;	margin-top:5px;	width:508px;	height:300px;	overflow:auto;}#tab_sel ul li {	cursor:pointer;	display:block;	margin:0;padding:4px;}#tab_sel ul li:hover {	background:#ff9}#tab_sel:hover ul {	visibility:visible;}.sh{    background-color:#ff9;}.stdframe.active{ 	background-color:#fea;	border: 1px solid #f93;}.tbl_item  input, .tbl_item  select{	border:1px solid #999;	font-size: 10px;	padding:2px;}input[disabled],input[readonly],select[disabled], textarea[disabled]{	color:black;	background:#ddd;}</style>{/literal}<h1>{$PAGE_TITLE}{if $approval_on_behalf} (on behalf of {$approval_on_behalf.on_behalf_of_u}){/if}</h1><div style="float:left;padding:4px;"><b>Select GRN to approve</b></div><div style="float:left" id="tab_sel"><span id="sel_name">-</span><ul id="tab">{section name=i loop=$grn_list}	{strip}		<li onclick="select_tab(this)" id="tab{$grn_list[i].id}" title="{$grn_list[i].id},{$grn_list[i].branch_id}">		&nbsp;		{$grn_list[i].order_no} &nbsp;		({$grn_list[i].prefix}#{$grn_list[i].id|string_format:"%05d"}, Branch: {$grn_list[i].branch_name}, Date: {$grn_list[i].added|date_format}, Created: {$grn_list[i].user_name})</li>	{/strip}{/section}</ul></span></div><br style="clear:both"><br>{if $errm.top}<div id=err>	<div class=errmsg>		<ul>		{foreach from=$errm.top item=e}			<li> {$e}		{/foreach}		</ul>	</div></div>{/if}<form name="f_on_behalf">	{if $approval_on_behalf}	<input type="hidden" name="on_behalf_of" value="{$approval_on_behalf.on_behalf_of}" />	<input type="hidden" name="on_behalf_by" value="{$approval_on_behalf.on_behalf_by}" />	{/if}</form><div id=udiv><!-- data will be loaded here --></div><script>select_tab();</script>{include file=footer.tpl}