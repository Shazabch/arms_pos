{*1/6/2010 5:02:14 PM Andy- Add config 'ci_use_split_artno' to check whether split artno5/12/2011 4:35:38 PM Alex- add use hq cost12/2/2014 5:03 PM Justin- Add a legend to let user know the selling/cost price is before GST.07/01/2016 14:00 Edwin- Show 'HQ Cost' when branch is HQ and $config.sku_listing_show_hq_cost is enabled7/19/2017 17:16 Qiu Ying- Enhanced to use the artno and mcode in sku item table instead of artno_mcode in do_items and po_items8/2/2017 14:48 Qiu Ying- Bug fixed on cannot get the latest artno*}{include file=header.tpl}{if !$no_header_footer}{literal}<!-- calendar stylesheet --><link rel="stylesheet" type="text/css" media="all" href="js/jscalendar/calendar-blue.css" title="calendar-blue" /><!-- main calendar program --><script type="text/javascript" src="js/jscalendar/calendar.js"></script><!-- language for the calendar --><script type="text/javascript" src="js/jscalendar/lang/calendar-en.js"></script><!-- the following script defines the Calendar.setup helper function, which makes   adding a calendar a matter of 1 or 2 lines of code. --><script type="text/javascript" src="js/jscalendar/calendar-setup.js"></script>{/literal}<style>{literal}.sub_tr{    background-color:#ffc;}{/literal}</style><script>var sort_by = '{$smarty.request.sort_by}';var phpself = '{$smarty.server.PHP_SELF}';{literal}function change_sort_by(ele){	if(ele.value=='')   $('span_sort_order').hide();	else    $('span_sort_order').show();}function toggle_sub(sid,ele){	if($('branch_data_'+sid).style.display==''){        $('branch_data_'+sid).hide();        ele.src = 'ui/expand.gif';	} 	else{	    $('branch_data_'+sid).show();        ele.src = 'ui/collapse.gif';	}    }{/literal}</script>{/if}<h1>{$PAGE_TITLE}</h1>{if $err}The following error(s) has occured:<ul class=err>{foreach from=$err item=e}<li> {$e}</li>{/foreach}</ul>{/if}{if !$no_header_footer}<form method=post class=form name="f_a"><b>Date</b>&nbsp;<b>From</b> <input size=10 type=text name=date_from value="{$smarty.request.date_from}" id="date_from"><img align=absmiddle src="ui/calendar.gif" id="t_added1" style="cursor: pointer;" title="Select Date">&nbsp;&nbsp;&nbsp;&nbsp;<b>To</b> <input size=10 type=text name=date_to value="{$smarty.request.date_to}" id="date_to"><img align=absmiddle src="ui/calendar.gif" id="t_added2" style="cursor: pointer;" title="Select Date">&nbsp;&nbsp;&nbsp;&nbsp;<b>Group By</b><select name="group_by">	<option value="item" {if $smarty.request.group_by eq 'item'}selected {/if}>Items</option>	<option value="branch" {if $smarty.request.group_by eq 'branch'}selected {/if}>Branches</option></select>&nbsp;&nbsp;&nbsp;&nbsp;<b>Sort by</b><select name="sort_by" onChange="change_sort_by(this);">	<option value="">--</option>	<option value="sku_item_code" {if $smarty.request.sort_by eq 'sku_item_code'}selected {/if}>ARMS Code</option>    <option value="artno_mcode" {if $smarty.request.sort_by eq 'artno_mcode'}selected {/if}>Art No</option>    <option value="mcode" {if $smarty.request.sort_by eq 'mcode'}selected {/if}>MCode</option>    <!--option value="linkcode" {if $smarty.request.sort_by eq 'linkcode'}selected {/if}>CM Code</option-->    <option value="description" {if $smarty.request.sort_by eq 'description'}selected {/if}>Description</option>    <option value="branch" {if $smarty.request.sort_by eq 'branch'}selected {/if}>Branch Code</option></select><span id="span_sort_order" {if !$smarty.request.sort_by}style="display:none;"{/if}><select name="sort_order">	<option value="asc" {if $smarty.request.sort_order eq 'asc'}selected {/if}>Ascending</option>	<option value="desc" {if $smarty.request.sort_order eq 'desc'}selected {/if}>Descending</option></select></span><p><input type=hidden name=submit value=1><button name=show_report>{#SHOW_REPORT#}</button><button name=output_excel>{#OUTPUT_EXCEL#}</button>{if $sessioninfo.privilege.SHOW_COST && $config.sku_listing_show_hq_cost && $BRANCH_CODE eq 'HQ'}	<input type=checkbox id="hq_cost_id" name=hq_cost value=1 {if $smarty.request.hq_cost}checked {/if}><label for="hq_cost_id"><b>HQ Cost</b></label>{/if}{if $config.enable_gst}	* Selling price show in this report is GST exclusive.{/if}</p></form>{/if}{if !$table}{if $smarty.request.submit && !$err}-- No data --{/if}{else}<h2>Date From: {$smarty.request.date_from} To {$smarty.request.date_to}&nbsp;&nbsp;&nbsp;&nbsp;</h2><table width="100%" class="report_table">	<tr class="header">	    <th rowspan="2">&nbsp;</th>     	<th rowspan="2">ARMS Code</th>	    <th rowspan="2">MCode</th>	    <th {if $config.ci_use_split_artno}colspan="2"{else}rowspan="2"{/if}>Art.No</th>	    <th rowspan="2">Description</th>	    <th colspan="3">Total</th>	</tr> 	<tr class="header">        {if $config.ci_use_split_artno}		    <th>Code</th>		    <th>Size</th>	    {/if}	    <th>Qty</th>	    <th>Cost</th>	    <th>Selling Price</th>	</tr>	{if $smarty.request.group_by eq 'item'}		{foreach from=$sku_items_info item=r name=f}		    {assign var=sid value=$r.sku_item_id}		    <tr>		        <td>{$smarty.foreach.f.iteration}</td>	        	<td>{$r.sku_item_code}</td>		        <td>{$r.mcode}</td>		        {if $config.ci_use_split_artno}			        <td>{$r.artno_code}</td>			        <td>{$r.artno_size}</td>		        {else}		            <td>{$r.artno_mcode}</td>		        {/if}		        <td>{$r.description}		            {if !isset($smarty.request.output_excel)}					<img src="ui/expand.gif" align="absmiddle" onClick="toggle_sub('{$sid}',this);" class="clickable" />					{/if}				</td>		        <td class="r">{$table.$sid.qty|number_format}</td>		        <td class="r">{$table.$sid.cost|number_format:2}</td>		        <td class="r">{$table.$sid.selling|number_format:2}</td>		    </tr>		    <tbody id="branch_data_{$sid}" style="display:none;">		        {assign var=cols value=5}		        {if $config.ci_use_split_artno}		            {assign var=cols value=$cols+1}				{/if}						        {foreach from=$branches_info item=b}		            {assign var=bid value=$b.id}		            {if $branch_data.$sid.$bid}			            <tr class="sub_tr">			                <td colspan="{$cols}" class="r">{$b.code} - {$b.description}</td>			                <td class="r">{$branch_data.$sid.$bid.qty|number_format}</td>			                <td class="r">{$branch_data.$sid.$bid.cost|number_format:2}</td>			                <td class="r">{$branch_data.$sid.$bid.selling|number_format:2}</td>			            </tr>		            {/if}		        {/foreach}		    </tbody>		{/foreach}	{else}	    {foreach from=$branches_info item=b}	        {assign var=bid value=$b.id}	        {assign var=cols value=5}	        {if $config.ci_use_split_artno}	            {assign var=cols value=$cols+1}			{/if}	        <tr>                <td colspan="{$cols}">{$b.code} - {$b.description}                    {if !isset($smarty.request.output_excel)}					<img src="ui/expand.gif" align="absmiddle" onClick="toggle_sub('{$bid}',this);" class="clickable" />					{/if}				</td>                <td class="r">{$table.$bid.qty|number_format}</td>		        <td class="r">{$table.$bid.cost|number_format:2}</td>		        <td class="r">{$table.$bid.selling|number_format:2}</td>            </tr>            <tbody id="branch_data_{$bid}" style="display:none;">                {assign var=counter value=1}                {foreach from=$sku_items_info item=r}                    {assign var=sid value=$r.sku_item_id}                    {if $branch_data.$sid.$bid}	                    <tr class="sub_tr">				            <td>{$counter++}</td>				        	<td>{$r.sku_item_code}</td>					        <td>{$r.mcode}</td>					        {if $config.ci_use_split_artno}						        <td>{$r.artno_code}</td>						        <td>{$r.artno_size}</td>					        {else}					            <td>{$r.artno}</td>					        {/if}					        <td>{$r.description}</td>					        <td class="r">{$branch_data.$sid.$bid.qty|number_format}</td>			                <td class="r">{$branch_data.$sid.$bid.cost|number_format:2}</td>			                <td class="r">{$branch_data.$sid.$bid.selling|number_format:2}</td>				        </tr>                    {/if}                {/foreach}		    </tbody>	    {/foreach}	{/if}	<tr class="header">	    {assign var=cols value=5}        {if $config.ci_use_split_artno}            {assign var=cols value=$cols+1}		{/if}	    <th colspan="{$cols}" class="r">Total</th>	    <th class="r">{$total.qty|number_format}</th>	    <th class="r">{$total.cost|number_format:2}</th>	    <th class="r">{$total.selling|number_format:2}</th>	</tr></table>{/if}{if !$no_header_footer}{literal}<script type="text/javascript">    Calendar.setup({        inputField     :    "date_from",     // id of the input field        ifFormat       :    "%Y-%m-%d",      // format of the input field        button         :    "t_added1",  // trigger for the calendar (button ID)        align          :    "Bl",           // alignment (defaults to "Bl")        singleClick    :    true    });    Calendar.setup({        inputField     :    "date_to",     // id of the input field        ifFormat       :    "%Y-%m-%d",      // format of the input field        button         :    "t_added2",  // trigger for the calendar (button ID)        align          :    "Bl",           // alignment (defaults to "Bl")        singleClick    :    true    });</script>{/literal}{/if}{include file=footer.tpl}