{*Revision History================4/19/2007 yinsee- add return_type + cost column and total row- rearrange vendor, date etc order9/21/2007 10:41:59 AM yinsee- only show total in last page2/25/2008 5:12:55 PM gary- fix the row number of each row and the total value.3/25/2008 3:43:49 PM gary- lorry to vehicle4/7/2008 4:55:48 PM gary- add branch tel.4/24/2008 4:34:19 PM gary- reduce remark height to fix the printing issue.09.05.2008 14:37:04 Saw- GRA Checkout add extra field for key in total CTN QTY RETURN, this field must compulsory.3/2/2009 5:00:00 PM Jeff- add total & grand total6/18/2009 12:29:00 PM jeff- hide total row if $show_total is not set6/22/2009 5:00 PM Andy- Add No horizontal line setting8/21/2009 5:00:19 PM Andy- add total row num can be set by config, and only show remark & signature in last page12/10/2009 10:49:25 AM Andy- change date to use form.added (GRA Create Time)12/23/2009 11:05:53 AM Andy- Fix wrong grand total1/12/2010 3:51:36 PM Andy- Add config to manage item got line or not7/6/2010 4:13:36 PM Justin- Modified the report printing to include Selling Price column.- Added a set of conditions while printing a report from Completed GRA, the conditions as below:  -> If found the report's copy type is print for own copy, Selling Price column will be displayed.  -> Whereas if found the report's copy type is for vendor copy, Selling Price column will be hidden.- Fixed the error that found from DN Amount field while printing GRA Checkout or Completed GRA.11/2/2010 2:50:42 PM Alex- fix column bugs if no link_code_name config- fix outright figure error4/29/2011 4:21:11 PM Justin- Rounding is now base on config['gra_cost_decimal_points'], if not found means all round by 2 decimal points.5/23/2011 12:10:59 PM Justin- Modified the grand total amount to round by default 2 decimal points instead of follow config set.7/15/2011 1:47:30 PM Andy- Add include 'header.print.tpl' for all printing templates, added support charset utf8.7/29/2011 4:25:32 PM Justin- Removed the number format for qty.- Modified the decimal points of rounding up cost to base on config.- Enhanced the report for the redundency coding.11/14/2011 1:58:24 PM Andy- Fix wrong total qty.9/24/2012 6:03 PM Justin- Enhanced to show remark2 on Additional Remark field.10/5/2012 5:58 PM Andy- Fix gra checkout cannot print.8/19/2013 9:31 AM Fithri- assign document no as filename when print4/18/2015 5:14 PM Justin- Enhanced to have GST information.4/22/2015 2:42 PM Justin- Enhanced to take out rude word.5/8/2015 10:51 AM Justin- Enhanced to show document date.5/14/2015 4:36 PM Justin- Enhanced to show selling price includes gst without GST information while GRA is OUTRIGHT.11/30/2015 9:43 PM DingRen- direct load gst amount from gra item instead of recalculate12/24/2015 9:55 AM Qiu Ying- SKU Additional Description should show in document printing1/26/2016 4:14 PM Qiu Ying- Show gst_selling_price and selling price4/21/2017 1:53 PM Khausalya- Enhanced changes from RM to use config setting. 9/4/2018 5:15 PM Justin- Bug fixed on showing empty selling price when GRA is not under GST status.10/23/2018 3:41 PM Justin- Enhanced the report to compatible with new SKU Type.*}{if !$skip_header}{include file='header.print.tpl'}<style>{if $config.gra_printing_no_item_line}{literal}.no_border_bottom td{	border-bottom:none !important;}.total_row td, .total_row th{    border-top: 1px solid #000;}.td_btm_got_line td,.td_btm_got_line th{    border-bottom:1px solid black !important;}{/literal}{/if}</style><script type="text/javascript">var doc_no = 'GRA{$form.id|string_format:"%05d"}';{literal}function start_print(){	document.title = doc_no;	window.print();}{/literal}</script><body onload="start_print();">{/if}<!-- print sheet --><div class=printarea><table width=100% cellpadding=4 cellspacing=0 border=0><tr><td width=30% align=left nowrap><h4>{$branch.description}</td><td width=42% align=center nowrap><h4>GOOD RETURN ADVICE{*if $vendor_copy}<div class=small>(Vendor Copy)</div>{/if*}{if $copy_type ne 'own'}<div class=small>({$copy_type})</div>{/if}</td><td width=20% align=right><h4>GRA{$form.id|string_format:"%05d"}</h4>{if $page}<br>{$page}{/if}</td></tr></table><div class=small style="padding-bottom:10px">{$branch.address|nl2br}<br>Tel: {$branch.phone_1}{if $branch.phone_2} / {$branch.phone_2}{/if}</div><table width=100% border=0 cellspacing=0 cellpadding=4 class="tb"><tr>	<td><b>Vendor</b></td>	<td colspan=2>{$form.vendor|default:'&nbsp;'}</td>	<td><b>Date</b></td>	<td colspan=2>{$form.added|date_format:"`$config.dat_format` %I:%M%p"}</td></tr><tr>	<td><b>Department</b></td>	<td  colspan=2>{$form.dept_code|default:'&nbsp;'}</td>	<td><b>Printed By</b></td>	<td  colspan=2>{$sessioninfo.u|default:'&nbsp;'}</td></tr><tr>	<td><b>DN No.</b></td>	<td>{$form.misc_info.dn_no|default:'-'}</td>	<td><b>DN Date</b></td>	<td>{$form.misc_info.dn_date|default:'-'|date_format:$config.dat_format}</td>	<td nowrap><b>DN Amount({$config.arms_currency.symbol})</b></td>	<td>{if $form.misc_info.dn_amount}{$form.misc_info.dn_amount|number_format:2}{else}-{/if}</td></tr><tr>	<td><b>Driver Name</b></td>	<td>{$form.misc_info.name|default:'&nbsp;'}</td>	<td><b>IC No.</b></td>	<td>{$form.misc_info.nric|default:'&nbsp;'}</td>	<td><b>Vehicle No.</b></td>	<td>{$form.transport|default:'&nbsp;'}</td></tr><tr>	<td><b>Return Ctn</b></td>	<td>{$form.misc_info.return_ctn|default:'&nbsp;'}</td>	<td colspan=4>&nbsp;</td></tr></table><br>{if $items && !$new}<table border=0 cellspacing=0 cellpadding=4 width=100% class="tb xsmall"><tr  bgcolor=#cccccc>	<th>&nbsp;</th>	<th>ARMS Code/<br>MCode</th>	<!--th>Manufacturer Code</th-->	<th>Article No{if $config.link_code_name}/<br>{$config.link_code_name}{/if}</th>	{if $config.link_code_name}	<!--th>{$config.link_code_name}</th-->	{/if}	<th width=40%>SKU</th>	{if $form.sku_type eq 'CONSIGN'}	<th align=center>Price Type</th>	{/if}	{if $form.sku_type eq 'CONSIGN' || ($form.sku_type ne 'CONSIGN' && $copy_type ne 'vendor_copy')}	<th align=center>Selling Price</th>	{/if}	<th>Return Type</th>	<th nowrap>Inv / DO<br />No.</th>	<th nowrap>Inv / DO<br />Date</th>	{if $form.sku_type ne 'CONSIGN'}	<th>Cost</th>	{/if}	<th>Qty (pcs)</th>	<th>Amount</th>	{if $form.is_under_gst && $form.sku_type ne 'CONSIGN'}		<th>GST</th>		<th>Amount<br />Incl. GST</th>	{/if}</tr>{assign var=t_page value=0}{assign var=ttl_qty value=0}{assign var=ttl_amt value=0}{assign var=ttl_gst value=0}{assign var=ttl_gst_amt value=0}{assign var=gra_items value=$items}{section name=i loop=$gra_items}<!--{$t_page++}-->{if $gra_items[i].doc_allow_decimal}	{assign var=qty_dp value=$config.global_qty_decimal_points}{else}	{assign var=qty_dp value=0}{/if}<tr  id="tbrow_{$gra_items[i].id}" bgcolor="{cycle values="#eeeeee,"}" class="no_border_bottom {if $smarty.section.i.iteration eq $PAGE_SIZE and !$is_lastpage}td_btm_got_line{/if}">	{if !$page_item_info[i].not_item}		<td align=right>		<!--{$line_no++}-->		{$gra_items[i].item_no+1}.		</td>		<td>{$gra_items[i].sku_item_code}<br>{$gra_items[i].mcode}</td>		<!--td>{$gra_items[i].mcode|default:"&nbsp;"}</td-->				<td>{$gra_items[i].artno|default:"&nbsp;"}{if $config.link_code_name}<br>{$gra_items[i].link_code}{/if}</td>		{if $config.link_code_name}		<!--td>{$gra_items[i].link_code|default:"&nbsp;"}</td-->		{/if}	{else}		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>	{/if}		<td>{$gra_items[i].sku}</td>		{if !$page_item_info[i].not_item}		{if $form.sku_type eq 'CONSIGN'}		<td align=center>{$gra_items[i].price_type|default:"&nbsp;"}</td>		{/if}		{if $form.sku_type eq 'CONSIGN' || ($form.sku_type ne 'CONSIGN' && $copy_type ne 'vendor_copy')}			<td align=right nowrap>				{if $form.is_under_gst}					{if $gra_items[i].inclusive_tax eq 'yes'}						{$gra_items[i].gst_selling_price|default:"&nbsp;"|number_format:2}<br/>						<span class="gst_sp">(Excl: {$gra_items[i].selling_price|default:"&nbsp;"|number_format:4})<span>					{else}						{$gra_items[i].selling_price|default:"&nbsp;"|number_format:2}<br/>						<span class="gst_sp">(Incl: {$gra_items[i].gst_selling_price|default:"&nbsp;"|number_format:2})<span>					{/if}				{else}					{$gra_items[i].selling_price|default:"&nbsp;"|number_format:2}				{/if}			</td>		{/if}				{if $show_total and $smarty.request.a eq 'print'}			{assign var=row_amt value=$gra_items[i].amount}			{if $form.is_under_gst}			{assign var=row_gst_amt value=$gra_items[i].amount_gst}			{assign var=row_gst value=$gra_items[i].gst}			{/if}			{assign var=total_amt value=$total_amt+$row_amt}			{assign var=ttl_amt value=$ttl_amt+$row_amt}			{assign var=total1_amt value=$total1_amt+$row_amt}						{assign var=qty value=$gra_items[i].qty+$ttl_qty|round:$qty_dp}			{assign var=ttl_qty value=$gra_items[i].qty+$ttl_qty}			{assign var=total_qty value=$gra_items[i].qty+$total_qty}			{assign var=total1_qty value=$gra_items[i].qty+$total1_qty}		{/if}				<td>{$gra_items[i].return_type|default:"-"}</td>		<td>{$gra_items[i].doc_no|default:"-"}</td>		<td>{$gra_items[i].doc_date|ifzero:"&nbsp;"}</td>		{if $form.sku_type ne 'CONSIGN'}		<td align=right>{$gra_items[i].cost|number_format:$dp}</td>		{/if}		<td align=right>{$gra_items[i].qty|qty_nf}</td>		<td align=right>{$row_amt|number_format:2}</td>		{if $form.is_under_gst && $form.sku_type ne 'CONSIGN'}			<td align="right">{$row_gst|number_format:2}</td>			{if $show_total and $smarty.request.a eq 'print'}				{assign var=ttl_gst value=$ttl_gst+$row_gst}				{assign var=total_gst value=$total_gst+$row_gst}				{assign var=total1_gst value=$total1_gst+$row_gst}				{assign var=ttl_gst_amt value=$ttl_gst_amt+$row_gst_amt}				{assign var=total_gst_amt value=$total_gst_amt+$row_gst_amt}				{assign var=total1_gst_amt value=$total1_gst_amt+$row_gst_amt}			{/if}			<td align="right">{$row_gst_amt|number_format:2}</td>		{/if}	{else}		{if $form.sku_type eq 'CONSIGN'}		<td>&nbsp;</td>		{/if}		{if $form.sku_type eq 'CONSIGN' || ($form.sku_type ne 'CONSIGN' && $copy_type ne 'vendor_copy')}		<td>&nbsp;</td>		{/if}		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>		{if $form.sku_type ne 'CONSIGN'}		<td>&nbsp;</td>		{/if}		<td>&nbsp;</td>		<td>&nbsp;</td>		{if $form.is_under_gst}			<td>&nbsp;</td>			<td>&nbsp;</td>		{/if}	{/if}</tr>{/section}{repeat s=$t_page+1 e=$PAGE_SIZE name=rr}<tr height=30 class="no_border_bottom">	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td>	{if $form.sku_type eq 'CONSIGN'}	<td>&nbsp;</td>	{/if}	{if $form.sku_type eq 'CONSIGN' || ($form.sku_type ne 'CONSIGN' && $copy_type ne 'vendor_copy')}	<td>&nbsp;</td>	{/if}	<td>&nbsp;</td>	{if $form.sku_type ne 'CONSIGN'}	<td>&nbsp;</td>	{/if}	<td>&nbsp;</td>	<td>&nbsp;</td>	{if $form.is_under_gst && $form.sku_type ne 'CONSIGN'}		<td>&nbsp;</td>		<td>&nbsp;</td>	{/if}</tr>{/repeat}{assign var=cols value=8}{if $form.sku_type eq 'CONSIGN' || ($form.sku_type ne 'CONSIGN' && $copy_type ne 'vendor_copy')}	{assign var=cols value=$cols+1}{/if}{if $show_total and $smarty.request.a eq 'print'}	<tr class="total_row">		<th colspan={$cols} align=right class="total_row">Total</th>		<td align=right class="total_row">{$ttl_qty|qty_nf}</td>		<td align=right class="total_row">{$ttl_amt|number_format:2}</td>		{if $form.is_under_gst && $form.sku_type ne 'CONSIGN'}			<td align=right class="total_row">{$ttl_gst|number_format:2}</td>			<td align=right class="total_row">{$ttl_gst_amt|number_format:2}</td>		{/if}	</tr>	{if $is_lastpage}		<tr class="total_row">			<th colspan={$cols} align=right class="total_row">Grand Total</th>			<td align=right class="total_row">{$total_qty|qty_nf}</td>			<td align=right class="total_row">{$total_amt|number_format:2}</td>			{if $form.is_under_gst && $form.sku_type ne 'CONSIGN'}				<td align=right class="total_row">{$total_gst|number_format:2}</td>				<td align=right class="total_row">{$total_gst_amt|number_format:2}</td>			{/if}		</tr>	{/if}{else}    <tr class="total_row">		<td colspan="{$cols+2}">&nbsp;</td>	</tr>{/if}</table>{/if}{if $is_lastpage}{assign var=total_qty value=0}{assign var=total_amt value=0}{assign var=total_gst value=0}{assign var=total_gst_amt value=0}{/if}{if $new}	<h5>Items Not in ARMS SKU</h5>	<table border=0 cellspacing=0 cellpadding=4 width=100% class="tb  xsmall">	<tr  bgcolor=#cccccc>		<th>&nbsp;</th>		<th>Item Code</th>		<th width=50%>Description</th>		<th>Return Type</th>		<th nowrap>Inv / DO<br />No.</th>		<th nowrap>Inv / DO<br />Date</th>		<th>Cost</th>		<th>Qty (pcs)</th>		<th>Amount</th>		{if $form.is_under_gst}			<th>GST ({$config.arms_currency.symbol})</th>			<th>Amount<br />Incl. GST ({$config.arms_currency.symbol})</th>		{/if}	</tr>		{assign var=t1_page value=0}	{assign var=ttl1_qty value=0}	{assign var=ttl1_amt value=0}	{assign var=ttl1_gst value=0}	{assign var=ttl1_gst_amt value=0}		{section name=i loop=$new}		<!--{$t1_page++}-->		{assign var=row_amt1 value=$new[i].qty*$new[i].cost}        {if $form.is_under_gst}            {math equation="x*((100+y)/100)" x=$row_amt1 y=$new[i].gst_rate assign=row_gst_amt}            {assign var=row_gst_amt value=$row_gst_amt|round2}            {assign var=row_amt1 value=$row_amt1|round2}            {assign var=row_gst value=$row_gst_amt-$row_amt1}            {if $show_total and $smarty.request.a eq 'print'}                {assign var=ttl1_gst value=$ttl1_gst+$row_gst}                {assign var=total1_gst value=$total1_gst+$row_gst}                {assign var=ttl1_gst_amt value=$ttl1_gst_amt+$row_gst_amt}                {assign var=total1_gst_amt value=$total1_gst_amt+$row_gst_amt}            {/if}        {/if}		{if $show_total and $smarty.request.a eq 'print'}			{assign var=total1_qty value=$new[i].qty+$total1_qty|round:$config.global_qty_decimal_points}			{assign var=total1_amt value=$total1_amt+$row_amt1|round:$dp}			{assign var=ttl1_qty value=$new[i].qty+$ttl1_qty|round:$config.global_qty_decimal_points}			{assign var=ttl1_amt value=$ttl1_amt+$row_amt1|round:$dp}		{/if}		<tr  id="tbrow_{$new[i].id}" bgcolor="{cycle values="#eeeeee,"}" height=30 class="no_border_bottom">		    <td width=6 align=right>{$start_counter+$smarty.section.i.iteration}.</td>			<td>{$new[i].code}</td>			<td>{$new[i].description}</td>			<td>{$new[i].reason|default:"-"}</td>			<td>{$new[i].doc_no|default:"-"}</td>			<td>{$new[i].doc_date|default:"&nbsp;"}</td>			<td align=right>{$new[i].cost|number_format:$dp}</td>			<td align=right>{$new[i].qty|qty_nf}</td>			<td align=right>{$row_amt1|number_format:2}</td>			{if $form.is_under_gst}				<td align="right">{$row_gst|number_format:2}</td>				<td align="right">{$row_gst_amt|number_format:2}</td>			{/if}		</tr>	{/section}			{repeat s=$t1_page+1 e=$PAGE_SIZE}		<tr height=30 class="no_border_bottom">			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			<td>&nbsp;</td>			{if $form.is_under_gst}				<td>&nbsp;</td>				<td>&nbsp;</td>			{/if}		</tr>		{/repeat}			{if $show_total and $smarty.request.a eq 'print'}			<tr class="total_row">				<th colspan=7 align=right class="total_row">Total</th>				<td align=right class="total_row">{$ttl1_qty|qty_nf}</td>				<td align=right class="total_row">{$ttl1_amt|number_format:2}</td>				{if $form.is_under_gst}					<td align=right class="total_row">{$ttl1_gst|number_format:2}</td>					<td align=right class="total_row">{$ttl1_gst_amt|number_format:2}</td>				{/if}			</tr>			{if $is_lastpage}				<tr class="total_row">					<th colspan=7 align=right class="total_row">Grand Total</th>					<td align=right class="total_row">{$total1_qty|qty_nf}</td>					<td align=right class="total_row">{$total1_amt|number_format:2}</td>					{if $form.is_under_gst}						<td align=right class="total_row">{$total1_gst|number_format:2}</td>						<td align=right class="total_row">{$total1_gst_amt|number_format:2}</td>					{/if}				</tr>			{/if}		{/if}	</table>{/if}{if $is_lastpage}<br><b>Additional Remark</b><div style="border:1px solid #000;padding:5px;height:{if $form.remark2}40px;{else}20px;{/if}">{if $form.remark2}{$form.remark2}<br />{/if}{$form.remark}{if !$form.remark && !$form.remark2}-{/if}</div><br /><table class="tbd small" cellpadding=4 cellspacing=0 border=0 width=100%><tr bgcolor=#cccccc>	<th width=80>&nbsp;</th>	<th>Name</th>	<th>Signature</th>	<th>Date</th>	<th>Time</th></tr><tr height=25>	<td><b>Issued By</b></td>	<td align=center>{$sessioninfo.fullname}</td>	<td>&nbsp;</td>	<td align=center>{$smarty.now|date_format:$config.dat_format}</td>	<td align=center>{$smarty.now|date_format:"%H:%M:%S"}</td></tr><tr height=25>	<td><b>Checking By</b></td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td></tr><tr height=25>	<td><b>Received By</b></td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td>	<td>&nbsp;</td></tr></table>{/if}</div>