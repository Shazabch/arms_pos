{*Revision History================4 Apr 2007 - yinsee- 	check for $config.sku_application_require_multics to enable/disable multics code columns6/1/2007 10:22:39 AM - yinsee- allow same article number under the same SKU (commented out javascript check)6/13/2007 5:51:59 PM - gary- added  block list function for each SKU.8/21/2007 5:43:35 PM - yinsee- added sku photo upload/remove9/19/2007 3:32:03 PM -gary- alter checking artno and mcode.1/11/2008 3:30:01 PM yinsee- remove block_list from sku 2/2/2009 10:00:00 AM Andy- check $config['sku_always_show_trade_discount'] to show trade discount11/16/2009 3:13:30 PM yinsee- set item as parent6/2/2010 10:19:19 AM Alex- add atom_update_fulldesc function7/26/2010 9:25:44 AM Alex- add 'softline','outright' keywords checking to allow add matrix link8/13/2010 10:11:49 AM Andy- Add SKU without inventory. (control by category + sku and can be inherit)- Add Fresh Market Sku. (control by category + sku and can be inherit)(Need Config)8/19/2010 2:45:54 PM Andy- Add config control to no inventory sku.11/2/2010 3:10:28 PM Justin- When changed to outright, hidden the Trade Discount and Trade Discount Table.11/4/2010 12:34:47 PM Justin- Added the missing feature to hide Trade Discount Code when found config.12/7/2010 6:38:56 PM Justin- Removed the No Trade Discount radio button.- Required user to select trade discount code whenever it is consignment type.- Fixed the error generated every time load the page.12/9/2010 3:24:22 PM Justin- Removed the auto assign for default trade discount code that causing calculation errors.- Fixed the calculation cost price bugs for matrix table.- Added auto remove for all the price type percentages when sku type being changed into outright.- Disabled the double calculation for recalculate cost price on both sku and matrix tables.- Added the checking to disable/enable the cost price's field for both sku and matrix tables whenever sku type has been changed.12/9/2010 3:52:15 PM Andy- Add allow delete sku apply photo at sku edit.12/15/2010 5:12:56 PM Justin- Fixed the bugs where keep alert required user to select trade discount code when sku type is outright.12/23/2010 12:55:45 PM Justin- Fixed the bug not to replace cost price with selling price and disable cost price field when config_consignment_modules is on.3/10/2011 11:13:13 AM Justin- Added S/N enhancements.3/10/2011 3:24:23 PM Andy- Add PO reorder qty min & max at edit/apply SKU.4/26/2011 12:24:23 PM Justin- Added scale type.- Added new JS function to check fresh market that is "inherit" to category while display scale type for user to select.- Amended the new JS function to always show scale type while it is "Yes" for fresh market.5/11/2011 3:52:39 PM Alex- add function check_all_branch() to tick all branches5/19/2011 5:00:39 AM Justin- Added Use Serial No column.5/27/2011 3:00:39 PM Alex- rounding gross profit to 4 digit => check_artmcode()- change checking on artno and mcode param => check_artmcode()6/3/2011 9:56:12 AM Justin- Disabled the Scale Type field when no config set for enable fresh market.- Modified certain function not to call out the checking for fresh market type when no config found.6/20/2011 1:51:30 PM Andy- Change scale type to become default SKU property and not depends to fresh market, but disable for consignment mode.9/6/2011 4:04:50 PM Justin- Added to show different modules between variety and matrix.9/7/2011 11:57:43 AM Justin- Fixed the active/inactive for SKU item that not coding properly.9/12/2011 7:36:21 PM Alex- add checking name artsize to avoid error=> check_artmcode()9/15/2011 11:01:53 AM Justin- Fixed the trade discount table is not update automatically when Category has been changed.10/17/2011 11:56:49 AM Alex- Modified the round up for cost to base on config.10/24/2011 4:06:48 PM Andy- Fix "	Mark On" show "infinity" if selling price set as zero.- Add "Allow FOC" and "FOC" checkbox for SKU Selling Price.4/10/2012 5:29:40 PM Alex- enhance delete sku apply photo to be able to delete for multi branch or local => del_sku_apply_image()4/23/2012 4:44:12 PM Justin- Added new feature to maintain PO reorder qty by branch.5/16/2012 11:12:32 AM Justin- Fixed bugs that system show the form in fancy after add show PO reorder qty by branch.6/25/2012 2:48 PM Andy- Add feature to allow customize SKU information.6/29/2012 3:18:23 PM Justin- Added trim() into JS for user that attempts key in spacing inactive reason.7/3/2012 10:09:12 AM Justin- Changed the field name of scale type.7/26/2012 3:23 PM Andy- Add non-returnable feature.10/12/2012 4:56 PM Justin- Enhanced to have date validation.5/20/2013 12:00 PM Fithri- bugfix : receipt desc should be 40 chars max- bugfix : in Edit SKU, when receipt desc automatically copy from product desc, it can be over 40 chars07/12/2013 04:16 PM Justin- Bug fixed on having wrong indication of have_sn, it should be 2=Yes instead of 1=Yes (pre-list).8/29/2013 5:17 PM Fithri- automatically strips out character that is not 0-9,a-Z,-_/ and space in artno field12/19/2013 11:10 AM Andy- Fix sku photo path if got special character will not able to show in popup.4/3/2014 2:28 PM Justin- Enhanced to have "Notify Person" drown-down list for PO Reorder Qty.- Enhanced to have PO Reorder by Child option.4/18/2014 5:53 PM Justin- Enhanced to have Block item in GRN.6/3/2014 11:32 AM Justin- Enhanced to have new ability that can upload images by PDF file.6/9/2014 11:10 AM Justin- Enhanced to allow user to upload "JPEG" image file.8/20/2014 5:55 PM DingRen- add Input Tax, Output Tax, Inclusive Tax- add GST calculation function9/15/2014 5:57 PM Justin- Enhanced to have show/hide gst settings.9/25/2014 11:59 AM Justin- Enhanced to show GST description from drop down list in full.1/2/2015 4:43 PM Justin- Enhanced to show GST inherit information.1/23/2015 10:44 AM Andy- Group Open Price and Allow Selling FOC into grouping named as Selling Price Settings.- Enhance Open Price/Allow Selling FOC checking.- Change the selling price must always >0 except is open price.3/19/2015 5:58 PM Andy- Fix wrong gp calculation.- Change "Inclusive Tax" to "Selling Price Inclusive Tax".3/26/2015 4:54 PM Andy- Fix sku item edit cost by percentage bug.4/10/2015 10:47 AM Andy- Enhance to load category gst when edit masterfile sku.- Fix sometime system show wrong cost on first load.12/4/2015 9:21AM DingRen- add check login for form submit and ajax call12/17/2015 1:01 PM DingRen- add Allow Parent and Child duplicate MCode1/9/2017 3:19 PM Andy- Enhanced to only allow new customer to choose selling price inclusive tax = yes.- Enhanced to not allow to edit selling price inclusive tax if it is already using 'inherit' or 'yes'.4/18/2017 3:14 PM Justin- Enhanced to have note for brand on how to choose empty brand.- Removed the Compulsory marking for brand.5/10/2017 11:04 AM Qiu Ying- Bug fixed on SKU receipt description corrupted if too long6/29/2017 10:21 Am Qiu Ying- Enhanced to enable or disable the editing on cost price by setting config9/11/2017 1:41 PM Justin- Enhanced to have new feature "Use Matrix".- Enhanced to allow user check/uncheck min qty by size from matrix.11/30/2017 10:41 AM Justin- Enhanced to hide "Add Matrix" feature while config is turned on.2/1/2018 2:50 PM Justin- Added new settings "Weight in KG".10/23/2018 3:08 PM Justin- Enhanced the module to compatible with new SKU Type.- Enhanced to load SKU Type list from database instead of hardcoded it.1/8/2019 3:09 PM Andy- Enhanced to disable users to change sku_type if sku got used in documents or sales.5/30/2019 9:48 AM William- Added new PO Reorder Qty "Moq".6/28/2019 9:04 AM William- Added new "add promotion image".9/27/2019 1:31 PM Andy- Enhanced to capture log when remove any sku image.- Enhanced to update sku_items.lastupdate when upload POS Image or remove any sku image.2/28/2020 2:17 PM William- Enhanced to added remark to sku photo attachment and POS image.3/10/2020 9:09 AM William- Remove SKU application photo can upload pdf word.07/08/2020 05:15 PM Sheila- Updated button css11/13/2020 2:42 PM Andy- Added "Recommended Selling Price" (RSP) feature.12/10/2020 12:34 PM Andy- Fixed auto calculate RSP Discount bug.*}{include file=header.tpl}{literal}<style>.sh{    background-color:#ff9;}.stdframe.active{ 	background-color:#fea;	border: 1px solid #f93;}div.imgrollover{	float:left;	height:105px;	overflow:hidden;	border:1px solid transparent;}div.imgrollover:hover{	background:#fff;	height:130px;	border:1px solid #999;}#upload_popup {	border:2px solid #000;	background:#fff;	width:350px;	height:165px;	padding:10px;	position:absolute;	text-align:center;	z-index:10000;}#upload_promotion_popup {	border:2px solid #000;	background:#fff;	width:300px;	height:140px;	padding:10px;	position:absolute;	text-align:center;	z-index:10000;}/* new added table cell */.input_matrix {	font: bold 10px Arial;}.input_matrix td input {	width:60px;	font-size:10px;	padding: 2px;	border:1px solid #000;}.input_matrix td input.ntp { /* price */	background-color:#ff9;}.input_matrix td input[alt="header"] { /* header */    background-color:#9f9;	font-weight:bold;}.input_matrix td input.nte {    /* entry */	background-color:#fff;	color:#000;	font-weight:bold;	border:1px solid black;}.input_matrix td input.ntd { /* disabled */	background-color:#eee;	color:#eee;	border:none;}.div_multi_select{	border:1px solid grey;	overflow:auto;	padding: 2px;	width:80%;}.input_cost_price[readonly]{	background:#F0F0F0;	border:1px solid #CCCCCC;}</style>{/literal}<script type="text/javascript">var searched_id = 'findcat';var total_item = -1;var is_select = false;var searching = false;var search_ajax;var new_open = true;var config_sku_always_show_trade_discount = {if $config.sku_always_show_trade_discount}1{else}0{/if};var config_consignment_modules = {if $config.consignment_modules}1{else}0{/if};var config_enable_fresh_market_sku  = {if $config.enable_fresh_market_sku}1{else}0{/if};var global_cost_decimal_points = '{$config.global_cost_decimal_points}';var masterfile_not_allow_edit_cost = '{$config.masterfile_not_allow_edit_cost}';var phpself = '{$smarty.server.PHP_SELF}';var category_gst=[];var global_weight_decimal_points = '{$config.global_weight_decimal_points}';{if $gst_settings}var is_gst_active = true;{else}var is_gst_active = false;{/if}{if $category_gst}	category_gst["input_tax"] = '{$category_gst.input_tax}';	category_gst["input_tax_code"] = '{$category_gst.input_tax_code}';	category_gst["input_tax_rate"] = '{$category_gst.input_tax_rate}';	category_gst["output_tax"] = '{$category_gst.output_tax}';	category_gst["output_tax_code"] = '{$category_gst.output_tax_code}';	category_gst["output_tax_rate"] = '{$category_gst.output_tax_rate}';	category_gst["inclusive_tax"] = '{$category_gst.inclusive_tax}';{/if}var gst_rate_list = [];var gst_code_list = [];{foreach from=$input_tax_list item=r}    gst_rate_list['{$r.id}'] = '{$r.rate}'    gst_code_list['{$r.id}'] = '{$r.code}'{/foreach}{foreach from=$output_tax_list item=r}    gst_rate_list['{$r.id}'] = '{$r.rate}'    gst_code_list['{$r.id}'] = '{$r.code}'{/foreach}{literal}function sel_category(obj,have_child){	var str = new String(obj.value);	str.replace("<span class=sh>", "");	str.replace("</span>", "");	// must select bottom-most category except softline	if (str.indexOf('SOFTLINE')<0 && have_child!=0)	{		oid = document.f_a.category_id.value;		document.f_a.category_id.value = '';		$('str_findcat').innerHTML = 'You need to select a sub-category';		obj.value = str.substr(str.lastIndexOf(">")+2, str.length);		show_child(oid);		return;	}	$('str_findcat').innerHTML = str;	obj.value = str.substr(str.lastIndexOf(">")+2, str.length);	check_allow_matrix();}function hide_list(){	$(searched_id).style.display = 'none';}function show_child(id){	// reactivate the auto-completer with child of the category	setTimeout('category_autocompleter.options.defaultParams = "child='+id+'";category_autocompleter.activate()',250);}function copy_value(fieldname){    document.f_a.elements[fieldname+"["+total_item+"]"].value = document.f_a.elements[fieldname+"["+(total_item-1)+"]"].value;}function cancel_item(item_id){    if (!confirm('Are you sure?')) return;    if (item_id != undefined && item_id > 0)    {		new Effect.DropOut('item['+item_id+']', {duration:0.5, afterFinish: function() { Element.remove('item['+item_id+']') } });	}}function percent_to_amount(selling,percent){	if (percent.value.indexOf("%")>=0)		percent.value = selling.value - (selling.value * float(percent.value) / 100);	percent.value=round(percent.value,global_cost_decimal_points);}function atom_update_gross(n){	var sp = float(document.f_a.elements["selling_price["+n+"]"].value);	if(is_gst_active){		if($('span_gst_indicator_'+n).innerHTML=='Before'){			sp = float(document.f_a.elements["selling_price_gst["+n+"]"].value);		}	}	// gross profit amt    document.f_a.elements["gross["+n+"]"].value = round(sp - document.f_a.elements["cost_price["+n+"]"].value, 4);    // gross profit percent    var grossp = 0    if(sp!=0){		grossp = float(document.f_a.elements["gross["+n+"]"].value/sp)*100;	}	document.f_a.elements["grossp["+n+"]"].value = round(grossp,4);		//calc_gst(n);}function check_a(){	if (check_login()) {        var el = $$('table.reason_box td');        for(i=0;i<el.length;i++)        {            if (/^reason_box/.test(el[i].className))            {                id = el[i].className.replace(/^reason_box_/,'');                if (el[i].style.display == '' && document.f_a.elements['reason['+id+']'].value.trim() == '')                {                    alert('Please insert reason for '+$('desc_'+id).innerHTML);                    return false;                }            }        }        if(config_sku_always_show_trade_discount==1){            if(document.f_a.sku_type.value == "CONSIGN" && document.f_a.default_trade_discount_code.value==''){                document.f_a.default_trade_discount_code.focus();                alert('Please Select Discount Code');                return false;            }        }        if (!check_allow_matrix()) return false;				var item = $$('input.receipt_desc');		for(i=0;i<item.length;i++){			var item_id = item[i].value;			if(!check_receipt_desc_length(item_id))	return false;		}        document.f_a.bsubmit.value = "Submitting ...";        document.f_a.bsubmit.disabled = true;        return true;    }    return false;}{/literal}var td_selected = "{$form.default_trade_discount_code}";{literal}function update_td_selected(v,obj){	if(v=='')   return false;	td_selected=v;	value=document.f_a.elements['trade_discount_table['+td_selected+']'].value;	if(config_sku_always_show_trade_discount!=1){		//for checking the discount value in php.		if(td_selected == 'PWP' || value>0){			recalculate_all_cost();		}		else{			alert('Discount rate is 0, please select other discount type.');			obj.checked=false;			return;		}	}}function enable_all_cost(){	var x = document.getElementsByTagName('INPUT');	$A(x).each( function (obj, idx) {			if (obj.name.indexOf('cost_price[')==0)			{				var n = parseInt(obj.name.substr(11));				var r;				if (document.f_a.elements["cost_price["+n+"]"])					document.f_a.elements["cost_price["+n+"]"].readOnly = false;				else if (document.f_a.elements["tbcost["+n+"][1]"])				{					r = 1;					while (document.f_a.elements["tbcost["+n+"]["+r+"]"] != undefined)					{						document.f_a.elements["tbcost["+n+"]["+r+"]"].readOnly = false;						r++;					}				}			}		});}function recalculate_all_cost(n){	var margin = 0;	if(td_selected) margin = document.f_a.elements['trade_discount_table['+td_selected+']'].value;	if (n != undefined){	    if (document.f_a.elements["cost_price["+n+"]"]){	    	if(!config_consignment_modules){		        document.f_a.elements["cost_price["+n+"]"].readOnly = true;				document.f_a.elements["cost_price["+n+"]"].value = margin + '%';			}						var inp_sp = document.f_a.elements['selling_price['+n+']'];			if(is_gst_active){				if($('span_gst_indicator_'+n).innerHTML=='Before'){					inp_sp = document.f_a.elements['selling_price_gst['+n+']'];				}			}						percent_to_amount(inp_sp,document.f_a.elements["cost_price["+n+"]"]);						atom_update_gross(n);		}else if (document.f_a.elements["tbcost["+n+"][1]"]){		    r = 1;			var use_sp_gst = false;			if(is_gst_active){				if($('span_gst_indicator_'+n).innerHTML=='Before')	use_sp_gst = true;			}		    while (document.f_a.elements["tbcost["+n+"]["+r+"]"] != undefined){		    	if(!config_consignment_modules){			        document.f_a.elements["tbcost["+n+"]["+r+"]"].readOnly = true;					document.f_a.elements["tbcost["+n+"]["+r+"]"].value = margin + '%';				}				var inp_sp = use_sp_gst ? document.f_a.elements["tbprice_gst["+n+"]["+r+"]"] : document.f_a.elements["tbprice["+n+"]["+r+"]"];								percent_to_amount(inp_sp,document.f_a.elements["tbcost["+n+"]["+r+"]"]);				r++;			}		}		return;	}	//	alert('calc cost based on ' + td_selected);	var x = document.getElementsByTagName('INPUT');	$A(x).each( function (obj, idx) {		if (obj.name.indexOf('cost_price[')==0){			var n = parseInt(obj.name.substr(11));			if (document.f_a.elements["cost_price["+n+"]"]){				if(!config_consignment_modules){					document.f_a.elements["cost_price["+n+"]"].readOnly = true;					document.f_a.elements["cost_price["+n+"]"].value = margin + '%';				}								var inp_sp = document.f_a.elements['selling_price['+n+']'];				if(is_gst_active){					if($('span_gst_indicator_'+n).innerHTML=='Before'){						inp_sp = document.f_a.elements['selling_price_gst['+n+']'];					}				}							percent_to_amount(inp_sp,document.f_a.elements["cost_price["+n+"]"]);				atom_update_gross(n);			}		}else if (obj.name.indexOf('tbcost[')==0){			var n = parseInt(obj.name.substr(7));			if (document.f_a.elements["tbcost["+n+"][1]"]){				var r = 1;				var use_sp_gst = false;				if(is_gst_active){					if($('span_gst_indicator_'+n).innerHTML=='Before')	use_sp_gst = true;				}				while (document.f_a.elements["tbcost["+n+"]["+r+"]"] != undefined)				{					if(!config_consignment_modules){						document.f_a.elements["tbcost["+n+"]["+r+"]"].readOnly = true;						document.f_a.elements["tbcost["+n+"]["+r+"]"].value = margin + '%';					}					var inp_sp = use_sp_gst ? document.f_a.elements["tbprice_gst["+n+"]["+r+"]"] : document.f_a.elements["tbprice["+n+"]["+r+"]"];										percent_to_amount(inp_sp,document.f_a.elements["tbcost["+n+"]["+r+"]"]);					r++;				}			}		}	});	}function td_sel(v){	if (v==1)	{	    $("trade_discount_table").style.display = '';	    update_discount_table('brand', document.f_a.brand_id.value);	    recalculate_all_cost();	}	else if (v==2)	{	    $("trade_discount_table").style.display = '';	    update_discount_table('vendor', document.f_a.vendor_id.value);	    recalculate_all_cost();	}	for(var i=0; i<document.f_a.default_trade_discount_code.length; i++){		if(document.f_a.default_trade_discount_code[i].checked == true && document.f_a.elements['trade_discount_table['+document.f_a.default_trade_discount_code[i].value+']'].value == 0) document.f_a.default_trade_discount_code[i].checked = false;	}}function update_discount_table(type, id){	// clear TRADE_DISCOUNT table{/literal}{section name=c loop=$trade_discount_table}	document.f_a.elements['trade_discount_table[{$trade_discount_table[c].code}]'].value = '';{/section}{literal}	if (id == 0) return;    // retrieve    ajax_request(	'masterfile_sku.php',	{	    parameters: 'a=ajax_get_trade_discount_table&category_id='+document.f_a.category_id.value+'&branch_id='+document.f_a.apply_branch_id.value+'&'+type+'_id='+id,	    evalScripts: true,		onComplete: function(req, obj)	    {	        var formobj = document.f_a;	        eval(req.responseText);            recalculate_all_cost();		}	});}function sel_department(){	if(!document.f_a.category_id.value || document.f_a.sku_type.value != "CONSIGN" || !document.f_a.sku_type.value) return;	else{		var v = 0;		for(var i=0; i<document.f_a.trade_discount_type.length; i++){			if(document.f_a.trade_discount_type[i].checked == true) v = document.f_a.trade_discount_type[i].value;		}		if(v == 1){ // is brand			if(!document.f_a.brand_id.value) return;		}else if(v == 2){ // is vendor			if(!document.f_a.vendor_id.value) return;		}else return;		td_sel(v);	}}function sel_vendor(){    // update TRADE_DISCOUNT table    var obj = document.f_a.vendor_id;	if (document.f_a.trade_discount_type!=undefined && document.f_a.trade_discount_type[1].checked)	{	    update_discount_table('vendor', obj.value);	}}function sel_brand(){	var obj = document.f_a.brand_id;	if (obj.value == 0)		document.f_a.brand_name.value = '';	else	    document.f_a.brand_name.value = document.f_a.brand.value;	// update TRADE_DISCOUNT table	if (document.f_a.trade_discount_type!=undefined && document.f_a.trade_discount_type[0].checked)	{		update_discount_table('brand', obj.value);	}}// toggle the matrix table readonly stages when share/single mcode state changedfunction matrix_article_toggle(n, v){	if (v)	{		$('item_article['+n+']').style.display='none';		for (i=1;i<100;i++)		{			var tb = document.getElementsByName('tb['+n+']['+i+'][]');			for (j=1; j<tb.length; j++)			{				//tb[j].style.display='';				tb[j].style.backgroundColor='';				tb[j].style.color='';				tb[j].style.borderWidth='1px';				tb[j].disabled=false;			}			var tb = document.getElementsByName('tbm['+n+']['+i+'][]');			for (j=1; j<tb.length; j++)			{				//tb[j].style.display='';				tb[j].style.backgroundColor='';				tb[j].style.color='';				tb[j].style.borderWidth='1px';				tb[j].disabled=false;			}		}	}	else	{		$('item_article['+n+']').style.display='';		for (i=1;i<100;i++)		{			var tb = document.getElementsByName('tb['+n+']['+i+'][]');			for (j=1; j<tb.length; j++)			{				//tb[j].style.display='';				tb[j].style.backgroundColor='#fff';				tb[j].style.color='#fff';				tb[j].style.borderWidth='0';				tb[j].disabled=true;			}			var tb = document.getElementsByName('tbm['+n+']['+i+'][]');			for (j=1; j<tb.length; j++)			{				//tb[j].style.display='';				tb[j].style.backgroundColor='#fff';				tb[j].style.color='#fff';				tb[j].style.borderWidth='0';				tb[j].disabled=true;			}		}    }}// add new inkind fieldfunction add_inkind(obj,n){	if (obj.alt != '') return;    var s = obj.value;	if (s=='') return;	obj.alt='used';	new Insertion.Bottom('in_kind', '<li> Item <input name="listing_fee_inkind[item]['+n+']" size=30 onblur="add_inkind(this,'+(n+1)+')">\nQty <input name="listing_fee_inkind[qty]['+n+']" size=5>\nUnit Cost <input name="listing_fee_inkind[cost]['+n+']" size=6 onchange="ctotal('+n+')">\nTotal Cost <input name="listing_fee_inkind[total_cost]['+n+']" size=6 onchange="cunit('+n+')"></li>\n');}function cunit(n){	document.f_a.elements['listing_fee_inkind[cost]['+n+']'].value = round2(		document.f_a.elements['listing_fee_inkind[total_cost]['+n+']'].value /		document.f_a.elements['listing_fee_inkind[qty]['+n+']'].value);}function ctotal(n){	document.f_a.elements['listing_fee_inkind[total_cost]['+n+']'].value = round2(		document.f_a.elements['listing_fee_inkind[cost]['+n+']'].value *		document.f_a.elements['listing_fee_inkind[qty]['+n+']'].value);}function check_artmcode(obj, type, item_id){{/literal}	{if $config.sku_artno_allow_specialchars}	obj.value = new String(obj.value).trim().toUpperCase();	{else}	obj.value = new String(obj.value).uczap();	{/if}{literal}	if (obj.value == '') return;	// check all mcode in page for same article/mcode, reject if found	/*  --- do not remove!!! ---	var x = document.f_a.getElementsByTagName('input');	for (var i=0;i<x.length;i++)	{	    if (x[i] == obj || x[i].alt == 'header') continue; // skip self	    if (x[i].type == 'text')		{			if ((type == 'artno' && (x[i].name.indexOf('artno') >= 0 || x[i].name.indexOf('tb[') >= 0)) || (type == 'mcode' && (x[i].name.indexOf('mcode') >= 0 || x[i].name.indexOf('tbm[') >= 0)))			{			    if (x[i].value == obj.value)			    {					alert('The Article No / Manufacturer\'s Code is already used in the current SKU.');		           	obj.value = '';					obj.focus();					return;				}			}		}	}*/	// check database	if (type == "artno"){		if (/^artsize/.test(obj.name))			var artno_mcode=(document.f_a['artno['+item_id+']'].value+" "+obj.value).trim();		else			var artno_mcode=obj.value.trim();	}else		var artno_mcode=(obj.value).trim();            var parent_child_duplicate_mcode=document.f_a['parent_child_duplicate_mcode'].value;		s = Form.serialize(document.f_a)+'&a=ajax_check_artmcode&'+type+'s='+artno_mcode+'&parent_child_duplicate_mcode='+parent_child_duplicate_mcode;	ajax_request( 		"masterfile_sku.php", 		{			method:'post',			onComplete: function (m) {				if (m.responseText != 'OK')				{					alert(m.responseText);					obj.focus();				}			},		    parameters: s		}	);}function mcode_check(){	var vendor_id = document.f_a.vendor_id.value;	if (vendor_id == '')	{	    alert("No vendor is selected.");	    return;	}	if (empty(document.f_a.category_id, "You must enter Category.")){		return false;	}	if (empty(document.f_a.brand_id, "You must enter Brand.")){		return false;	}			popwin = window.open('masterfile_sku_application.php?a=mcode_check&vendor_id='+vendor_id+'&category_id='+document.f_a.category_id.value+'&brand_id='+ document.f_a.brand_id.value, null, "width=400,height=500,status=no,scrollbars=yes,resizable=yes");}function copy_block_po_list(id){	if ($('block_po_list')){		var el = $('block_po_list').getElementsByTagName('input');	    // copy new item's blocklist[bid]		for(var i=0;i<el.length;i++)		{		    if (el[i].type!='checkbox') continue;		    var newlist = el[i].name.replace(/\[sku\]/,'['+id+']');		    document.f_a.elements[newlist].checked = el[i].checked;		}	}}/*function sel_block_list(bid, obj){	var el = document.getElementsByTagName('input');	if (obj!=undefined) // top checkbox changed	{	    // select all item's blocklist[bid]		for(var i=0;i<el.length;i++)		{		    if (el[i].type!='checkbox' || el[i]==obj) continue;		    var r = new RegExp('block_list\\[\\d+\\]\\['+bid+'\\]');		    if (r.test(el[i].name))		    {		        el[i].checked = obj.checked;			}		}	}	else	{	    // if all item's blocklist[bid] is checked, check block_list[sku][bid		var ck = true;		for(var i=0;i<el.length;i++)		{		    if (el[i].type!='checkbox') continue;		    var r = new RegExp('block_list\\[\\d+\\]\\['+bid+'\\]');		    if (r.test(el[i].name))		    {		        if (!el[i].checked)		        {				    ck = false;		            break;				}			}		}		document.f_a.elements['block_list[sku]['+bid+']'].checked = ck;	}}*/function del_image(obj,fp,photo_type){	var sid = get_sid_from_obj(obj);		ajax_request('masterfile_sku.php',		{			method: 'get',			parameters: 'a=ajax_remove_photo&f='+fp+'&sku_item_id='+sid+'&photo_type='+photo_type,			onComplete: function(m) {				if (m.responseText == 'OK')				{					obj.remove();				}				else					alert(m.responseText);			}		}	);}function add_image(id){	document.upl.id.value= id;		$('upload_popup').show();	center_div('upload_popup');	curtain(true);}function curtain_clicked(){	$('upload_popup').hide();	curtain(false);		$('upload_promotion_popup').hide();	curtain(false);}function upload_check(){	if (!/\.jpg|\.jpeg|\.pdf/i.test(document.upl.fnew.value))	{		alert("Selected file must be a valid JPEG image or PDF file");		return false;	}		return true;}function upload_callback(id, content){	new Insertion.Bottom($('item_photos['+id+']'), content.innerHTML);	document.upl.fnew.value = '';	curtain_clicked();}//add promotion imagefunction add_promotion_image(id){	var obj = $('current_promotion_img['+id+']');	if(obj != null){		alert("Please delete the old promotion image first.");		return false;	}	document.upl2.id.value= id;		$('upload_promotion_popup').show();	center_div('upload_promotion_popup');	curtain(true);}function upload_check2(){	if (!/\.jpg|\.jpeg/i.test(document.upl2.fnew2.value))	{		alert("Selected file must be a valid JPEG image or JPG file");		return false;	}	return true;}function upload_callback2(id, content){	new Insertion.Bottom($('promotion_photo['+id+']'), content.innerHTML);	document.upl2.fnew2.value = '';	curtain_clicked();}function remove_current_promotion_img(id){	var obj = $('current_promotion_img['+id+']');	if(obj){		obj.remove();	}}function toggle_active(id, obj){	var el = document.getElementsByClassName('reason_box_'+id);	var display = '';	if (obj.checked) display = 'none';	for(i=0;i<el.length;i++) el[i].style.display = display;}function set_as_parent(id){	var old_weight_kg = document.f_a['old_weight_kg'].value;	if (!confirm("- This will change item's Packing UOM to EACH and set as SKU Parent.\n- Weight in KG will be divided and change to "+old_weight_kg+".")) return false;	document.location="/masterfile_sku.php?a=change_parent&sku_item_id="+id;	return false;}function atom_update_fulldesc(n){	if (new_open) return;    // brand	var newvalue = document.f_a.brand_name.value;	// flavor	if (document.f_a.elements["description4["+n+"]"].value != '')	    newvalue += ' ' + document.f_a.elements["description4["+n+"]"].value;	// category	newvalue += ' ' + $('autocomplete_category').value;	// size, weight, etc	//var sz = '';	if (document.f_a.elements["description1["+n+"]"].value != '')	    newvalue += ' ' + document.f_a.elements["description1["+n+"]"].value;	if (document.f_a.elements["description2["+n+"]"].value != '')	    newvalue += ' ' + document.f_a.elements["description2["+n+"]"].value;	if (document.f_a.elements["description3["+n+"]"].value != '')	    newvalue += ' ' + document.f_a.elements["description3["+n+"]"].value;	//sz = new String(sz).trim();	//if (sz != '') newvalue += ' (' + sz + ')';	if (document.f_a.elements["description5["+n+"]"].value != '')	    newvalue += ' ' + document.f_a.elements["description5["+n+"]"].value;    document.f_a.elements["description["+n+"]"].value=newvalue;}var color_size_autocomplete = undefined;var autocomplete_list = {};function autocomplete_color_size_variety(type,table){	var key = "_"+table;	var check = type+table;	 if(!autocomplete_list[check]){	    autocomplete_list[check] = new Ajax.Autocompleter("autocomplete_"+type+key, "div_autocomplete_"+type+"_choices"+key,"ajax_autocomplete.php?a=ajax_search_color_size",		{			paramName: type		});	}}function autocomplete_color_size(type,table,row,col,obj){	var key = "_"+table+"_"+row+"_"+col;	 if(!autocomplete_list[key]){	    autocomplete_list[key] = new Ajax.Autocompleter("autocomplete_"+type+key, "div_autocomplete_"+type+"_choices"+key,"ajax_autocomplete.php?a=ajax_search_color_size",		{			paramName: type		});	}}// expand the matrix tablefunction tb_expand(tbid,r,c){	s = Form.serialize(document.f_a);	s = s+'&a=ajax_grow_table&table='+tbid+'&add_row='+r+'&add_col='+c;	new Ajax.Updater( 		"matrix["+tbid+"]", 		"masterfile_sku_application.php", 		{			method:'post',			onComplete: function () {              matrix_article_toggle(tbid, document.f_a.elements['own_article['+tbid+']'].checked)              calc_all_gst();			  toggle_gst_settings();            },		    parameters: s		}	);}// delete a col from the matrix tablefunction del_col(tbid,c){	s = Form.serialize(document.f_a);	s = s+'&a=ajax_grow_table&table='+tbid+'&del_col='+c;	new Ajax.Updater( 		"matrix["+tbid+"]", 		"masterfile_sku_application.php", 		{			method:'post',			onComplete: function () { matrix_article_toggle(tbid, document.f_a.elements['own_article['+tbid+']'].checked) },		    parameters: s		}	);}// delete a row from the matrix tablefunction del_row(tbid,r){	s = Form.serialize(document.f_a);	s = s+'&a=ajax_grow_table&table='+tbid+'&del_row='+r;	new Ajax.Updater( 		"matrix["+tbid+"]", 		"masterfile_sku_application.php", 		{			method:'post',			onComplete: function () { matrix_article_toggle(tbid, document.f_a.elements['own_article['+tbid+']'].checked) },		    parameters: s		}	);}// toggle the matrix table readonly stages when share/single mcode state changedfunction matrix_article_toggle(n, v){	if (v)		$('item_article['+n+']').hide();	else	    $('item_article['+n+']').show();	var cells = $('matrix['+n+']').getElementsByTagName('input');	for (i=0;i<cells.length;i++)	{	    if (/^tbm*\[\d+\]/.test(cells[i].name) &&			(!/^tbm*\[\d+\]\[\d+\]\[0\]$/.test(cells[i].name)			&& !/^tbm*\[\d+\]\[0\]\[\d+\]$/.test(cells[i].name)))		{		    if(v)			{			    cells[i].className = 'nte';				//cells[i].style.backgroundColor='';				//cells[i].style.color='';				//cells[i].style.borderWidth='1px';				cells[i].disabled=false;			}			else			{				cells[i].className = 'ntd';				/*cells[i].style.backgroundColor='#fff';				cells[i].style.color='#fff';				cells[i].style.borderWidth='0';*/				cells[i].disabled=true;			}		}	}		calc_matrix_gst(n);}function add_item(){	$('add_item_notify').innerHTML = '<img src=ui/clock.gif align=absmiddle> Loading...';    hidediv('add_item');	var cat_id = document.f_a['category_id'].value;	var sku_type = document.f_a['sku_type'].value;	new Ajax.Updater(		"new_items", "masterfile_sku.php",	 	{			method:'get',	 	    parameters: 'a=ajax_add_item',	 	    onComplete: function() {			 	$('add_item_notify').innerHTML = '';			    showdiv('add_item');			    check_allow_matrix();				toggle_po_reorder_by_child();				mst_gst_info_changed();			 },	 	    evalScripts: true,	 	    insertion: Insertion.Bottom		}	);}function add_matrix(){    total_item++;    $('add_item_notify').innerHTML = '<img src=ui/clock.gif align=absmiddle> Loading...';    hidediv('add_item');	var cat_id = document.f_a['category_id'].value;	var sku_type = document.f_a['sku_type'].value;	new Ajax.Updater(		"new_items", "masterfile_sku.php",	 	{			method:'get',	 	    parameters: 'a=ajax_add_matrix',	 	    insertion: Insertion.Bottom,	 	    onComplete: function() {                document.f_a['parent_child_duplicate_mcode'].value=1;			 	$('add_item_notify').innerHTML = '';			    showdiv('add_item');			 },	 	    evalScripts: true		}	);}function check_allow_matrix(){{/literal}{if $config.sku_application_softline_outright_matrix_only && !$config.sku_disable_add_matrix}{literal}    var v = document.f_a.sku_type.value;	var ret = true;	var have_matrix = false;	var have_variety =false;	// make sure there's no matrix table yet	$$('.new').each(function(ele,index){	    if (document.f_a.elements['item_type['+ele.value+']'])	    {	        if (document.f_a.elements['item_type['+ele.value+']'].value=='matrix')	            have_matrix = true;			else			    have_variety = true;		}			});	if ((v!='CONSIGN') && /^SOFTLINE/.test($('str_findcat').innerHTML))	{	    if ($('add_matrix')) showdiv('add_matrix');	    if ($('add_variety')) hidediv('add_variety');	    if (have_variety)	    {			alert('Please remove Variety items before submit.');			return false;		}	}	else	{	    if ($('add_matrix')) hidediv('add_matrix');		if ($('add_variety')) showdiv('add_variety');		if (have_matrix)	    {			alert('Please remove Matrix table items before submit.');			return false;		}	}{/literal}{/if}{literal}//    check_is_last_approval();	var x = document.getElementsByTagName('INPUT');	if(document.f_a.sku_type.value != "CONSIGN" || !document.f_a.sku_type.value){		$('trade_discount_table').style.display = "none";		if(!config_sku_always_show_trade_discount){			$('trade_discount_type_table').style.display = "none";			// set both of the radio buttons checked become false for trade discount and table			document.f_a.trade_discount_type[0].checked = false;			document.f_a.trade_discount_type[1].checked = false;			if(document.f_a.default_trade_discount_code){				for(var i=0; i<document.f_a.default_trade_discount_code.length; i++){					document.f_a.default_trade_discount_code[i].checked = false;					document.f_a.elements['trade_discount_table['+document.f_a.default_trade_discount_code[i].value+']'].value = '';				}			}			$A(x).each( function (obj, idx) {				if (obj.name.indexOf('cost_price[')==0){ // unlock cost price for all SKU					var n = parseInt(obj.name.substr(11));					if (document.f_a.elements["cost_price["+n+"]"] != undefined && !masterfile_not_allow_edit_cost) document.f_a.elements["cost_price["+n+"]"].readOnly = false;				}else if (obj.name.indexOf('tbcost[')==0){					var n = parseInt(obj.name.substr(7));					if(document.f_a.elements["tbcost["+n+"][1]"]){ // unlock cost price for all Matrix						var r = 1;					    while (document.f_a.elements["tbcost["+n+"]["+r+"]"] != undefined){					        document.f_a.elements["tbcost["+n+"]["+r+"]"].readOnly = false;							r++;						}					}				}			});		}	}else{		if(!config_sku_always_show_trade_discount){			$('trade_discount_type_table').style.display = "";			if (document.f_a.trade_discount_type!=undefined){			    $('trade_discount_table').style.display = "";			}			$A(x).each( function (obj, idx) {				if (obj.name.indexOf('cost_price[')==0){ // lock cost price for all SKU					var n = parseInt(obj.name.substr(11));					if (document.f_a.elements["cost_price["+n+"]"] != undefined) document.f_a.elements["cost_price["+n+"]"].readOnly = true;				}else if (obj.name.indexOf('tbcost[')==0){ // lock cost price for all Matrix					var n = parseInt(obj.name.substr(7));					if(document.f_a.elements["tbcost["+n+"][1]"]){						var r = 1;					    while (document.f_a.elements["tbcost["+n+"]["+r+"]"] != undefined){					        document.f_a.elements["tbcost["+n+"]["+r+"]"].readOnly = true;							r++;						}					}				}			});		}else{			$('trade_discount_table').style.display = "";		}	}	return true;}// new itemfunction show_add_item(){    {/literal}	{if !$config.sku_application_enable_variety}	// if variety is disabled, count the actual total items, if zero, show add_item box	var n=0;	for(var i=0;i<=total_item;i++)	    if (document.f_a.elements['item_type['+i+']']) n++;	//alert('total item: '+n);	if (n==0) showdiv('add_item');	{else}	// if variety is enabled, always display add_item box	showdiv('add_item');	{/if}	{literal}}function add_to_receipt(id){	var description = document.f_a.elements['description['+id+']'].value.trim();	document.f_a.elements['receipt_description['+id+']'].value=description.toUpperCase().substring(0,40);//	$$('receipt_description'+id).value=$$('description['+id+']').value;}function toggle_replacement_group(chx, item_n){	var c = chx.checked;	$('inp_ri_id_'+item_n).disabled = !c;	$('inp_ri_group_name_'+item_n).disabled = !c;}function init_ri_autocomplete(item_n){    new Ajax.Autocompleter("inp_ri_group_name_"+item_n, "autocomplete_replacement_group_choices_"+item_n, "ajax_autocomplete.php?a=ajax_search_replacement_item_group", {        paramName: 'str',        indicator: 'span_ri_loading_'+item_n,		afterUpdateElement: function (obj, li) {			$('inp_ri_id_'+item_n).value = li.title;		}	});}function del_sku_apply_image(obj,fp, sku_apply_items_id,no){	ajax_request('masterfile_sku.php',		{			method: 'get',			parameters: 'a=ajax_remove_sku_apply_photo&sku_apply_items_id='+sku_apply_items_id+'&file_path='+fp,			onComplete: function(m) {				if (m.responseText == 'OK')				{					//remove photo 1st					$$('.div_photo_'+sku_apply_items_id+"_"+no).each(function(ele,index){						ele.remove();					});					//start change classname for other photo					var data_split = fp.split("%2F");						var img_no = int(no)+1;					var trigger = true;									//loop till no more					while (trigger == true){						if ($$('.delete_img_'+sku_apply_items_id+"_"+img_no).length > 0){							//for POPUP image							$$('.popup_img_'+sku_apply_items_id+"_"+img_no).each(function(ele,index){								var file_extension= "jpg";	//default								if (ele.src.search(/.jpg/i)){									file_extension = "jpg";								}else if (ele.src.search(/.jpeg/i)){									file_extension = "jpeg";								}else if (ele.src.search(/.png/i)){									file_extension = "png";								}								var n=int(img_no);								data_split[data_split.length-1] = (n-1)+"."+file_extension;								var filepath = data_split.join("/");																//change onclick								ele.onclick = function(){									popup_div('img_full', "<img width=640 src='"+escape(filepath+'?t='+new Date())+"'>")							    };							    								//change class name								if ($(ele).hasClassName('popup_img_'+sku_apply_items_id+"_"+n)){									$(ele).removeClassName('popup_img_'+sku_apply_items_id+"_"+n);									$(ele).addClassName('popup_img_'+sku_apply_items_id+"_"+(n-1));								}																    							    //=======remain img cache src=======> 							});																//for delete image							$$('.delete_img_'+sku_apply_items_id+"_"+img_no).each(function(ele,index){								var file_extension= "jpg";	//default								if (ele.src.search(/.jpg/i)){									file_extension = "jpg";								}else if (ele.src.search(/.jpeg/i)){									file_extension = "jpeg";								}else if (ele.src.search(/.png/i)){									file_extension = "png";								}																var n=int(img_no);								var saii = sku_apply_items_id;								data_split[data_split.length-1] = (n-1)+"."+file_extension;								var filepath = data_split.join("%2F");																ele.onclick = function(){							    if (confirm("Are you sure?")) {							        del_sku_apply_image(this.parentNode, filepath, saii,(n-1));							    }};							    									//change class name								if ($(ele).hasClassName('delete_img_'+sku_apply_items_id+"_"+n)){									$(ele).removeClassName('delete_img_'+sku_apply_items_id+"_"+n);									$(ele).addClassName('delete_img_'+sku_apply_items_id+"_"+(n-1));								}						    								//lastly change div class name								if ($(ele.parentNode).hasClassName('div_photo_'+sku_apply_items_id+"_"+n)){									$(ele.parentNode).removeClassName('div_photo_'+sku_apply_items_id+"_"+n);									$(ele.parentNode).addClassName('div_photo_'+sku_apply_items_id+"_"+(n-1));								}						    							});								img_no++;						}else{							trigger = false;						}					}					}				else					alert(m.responseText);			}		}	);}function check_fm_type(){	var fm_type = document.f_a.is_fresh_market.value;	/*if(fm_type != "inherit"){		if(fm_type == "yes"){			$("scale_type_area").style.display = ""; // always show the scale type			document.f_a.scale_type.disabled = false;		}else{			$("scale_type_area").style.display = "none"; // do not need to check if it is not inherit (follow category)			document.f_a.scale_type.disabled = true;		}		return;	}	ajax_request('masterfile_sku.php',		{			method: 'get',			parameters: 'a=ajax_check_fm_type&category_id='+document.f_a.category_id.value,			onComplete: function(m) {				if (m.responseText == 'yes'){					$("scale_type_area").style.display = ""; // if found is market, then show					document.f_a.scale_type.disabled = false;				}else{					if(m.responseText == 'no') $("scale_type_area").style.display = "none"; // it is not a fresh martket					document.f_a.scale_type.disabled = true;				}			}		}	);*/}function check_all_branch(obj,id,type){	$$('#'+type+'_branches_'+id+'_id .'+type+'_branches_'+id+'_id').each(function (ele, index){		ele.checked=obj.checked;	});} function toggle_allow_selling_foc(sid){	var inp = document.f_a['allow_selling_foc['+sid+']'];	// get the element		if(!inp)	return false;	// element not found		if(inp.checked){	// allow foc		$('span_selling_foc-'+sid).show();		document.f_a['selling_foc['+sid+']'].disabled = false;		//check_selling_foc(sid);		// clear other settings		check_selling_price_settings(inp, sid);	}else{	// not allow foc		$('span_selling_foc-'+sid).hide();		document.f_a['selling_foc['+sid+']'].disabled = true;		//document.f_a['selling_price['+sid+']'].readOnly = false;        //document.f_a['selling_price_gst['+sid+']'].readOnly = false;	}}function check_selling_foc(sid){	var inp_selling_foc = document.f_a['selling_foc['+sid+']']; // FOC checkbox	var inp_selling_price = document.f_a['selling_price['+sid+']'];	// selling price box    var inp_selling_price_gst = document.f_a['selling_price_gst['+sid+']'];	// selling price gst box		var is_foc = inp_selling_foc.checked && (!inp_selling_foc.disabled);	// tick FOC and checkbox not disable		//inp_selling_price.readOnly = is_foc;    //inp_selling_price_gst.readOnly = is_foc;	/*if(is_foc){	// set selling price as FOC		inp_selling_price.old_price = inp_selling_price.value;		inp_selling_price.value = '0.00';        inp_selling_price_gst.value='0.00';	}else{	// set no use FOC		if(inp_selling_price.old_price){	// set back to use selling price before tick use FOC (if got)			inp_selling_price.value = inp_selling_price.old_price;		}	}	inp_selling_price.onchange();	// call onchange function*/}function cat_disc_inherit_changed(item_id){	var sel;	var div_disc_container;		sel = document.f_a['cat_disc_inherit['+item_id+']'];	div_disc_container = $('div_category_discount_container-member-'+item_id);			if(sel.value == 'set'){		$(div_disc_container).show();	}else{		$(div_disc_container).hide();	}}function cat_disc_value_changed(inp){	var v = inp.value.trim();		if(v=='')	inp.value='';	else{		mf(inp,2);		v = float(inp.value);		if(v>100)	inp.value = '100.00';		else if(v<=0){			inp.value = 0;		}	}}function category_discount_branch_override_changed(item_id, bid){	var c = $('inp_category_disc_override-'+item_id+"-"+bid).checked;	$('item['+item_id+']').getElementsBySelector("input.inp_category_disc-"+item_id+"-"+bid).each(function(inp){		inp.disabled = !c	});}////////// point ////////////function category_point_inherit_changed(item_id){	var sel = document.f_a['category_point_inherit['+item_id+']'];	var div_container = $('div_category_point_container-'+item_id);		if(sel.value == 'set'){		$(div_container).show();		}else{		$(div_container).hide();	}}function category_point_value_changed(inp){	var v = inp.value.trim();		if(v=='')	inp.value='';	else{		mf(inp,2);		v = float(inp.value);		if(v<=0){			inp.value = 0;		}	}}function category_point_branch_override_changed(item_id, bid){	var c = $('inp_category_point_override-'+item_id+"-"+bid).checked;	$('item['+item_id+']').getElementsBySelector("input.inp_category_point-"+item_id+"-"+bid).each(function(inp){		inp.disabled = !c	});}function toggle_prq_by_branch(obj){	if(obj.checked == true){		$('prq_by_branch').show();	}else{		$('prq_by_branch').hide();	}}function date_validate(obj){	if(validateTimestamp(obj.value)==false){		alert("Invalid date format.");		obj.value = "";	}}function correct_artno(obj){	var str1 = obj.value;	if (!str1) return;	var filtered_artno = '';	for(var i=0; i<str1.length; i++){		if ( !/[^a-zA-Z0-9-/ _]/.test(str1.charAt(i)) ) filtered_artno = filtered_artno+str1.charAt(i);	}	obj.value = filtered_artno;}function toggle_po_reorder_by_child(){	if(document.f_a['po_reorder_by_child'] == undefined) return;		if(document.f_a['po_reorder_by_child'].checked == true){		$("div_po_reorder_qty").hide();		$('new_items').getElementsByClassName("si_po_reorder_qty").each(function(inp){			inp.disabled = false;		});		$('new_items').getElementsByClassName("tr_si_po_reorder_qty").each(function(tr){			tr.show();		});	}else{		$("div_po_reorder_qty").show();		$('new_items').getElementsByClassName("si_po_reorder_qty").each(function(inp){			inp.disabled = true;		});		$('new_items').getElementsByClassName("tr_si_po_reorder_qty").each(function(tr){			tr.hide();		});	}}function load_category_GST(id) {  var cid=int(id);  ajax_request(phpself+'?a=ajax_load_category_GST&id='+cid, {    method:'get',    onSuccess: function(transport){      //try {		category_gst = JSON.parse(transport.responseText);		      //} catch(e) {      //  alert(e);      //}        //calculate_all_gst();		document.f_a['mst_input_tax'].options[0].text = "Inherit (Follow Category: "+category_gst['input_tax_code']+" ["+category_gst['input_tax_rate']+"%])";		document.f_a['mst_output_tax'].options[0].text = "Inherit (Follow Category: "+category_gst['output_tax_code']+" ["+category_gst['output_tax_rate']+"%])";		document.f_a['mst_inclusive_tax'].options[0].text = "Inherit (Follow Category: "+category_gst['inclusive_tax'].toUpperCase()+")";				calc_all_gst();     }  });}function calc_all_gst(){  $$('input[data-item_id]').each(function(i) {    var id=$(i).readAttribute('data-item_id');    if (id!=undefined) {      var item_type = document.f_a['item_type['+id+']'].value;      if (item_type=='variety'){        calc_gst(id);      }      else{        calc_matrix_gst(id);      }    }  });    mst_gst_info_changed();}function calc_gst(id,field_type){	if(is_gst_active){		//master sku		var mst_output_tax = document.f_a['mst_output_tax'].value;		var mst_inclusive_tax = document.f_a['mst_inclusive_tax'].value;		if (mst_output_tax==-1) mst_output_tax=gst_rate_list[category_gst['output_tax']]; // found it is inherit to category		else mst_output_tax=gst_rate_list[mst_output_tax];		if (mst_inclusive_tax=='inherit') mst_inclusive_tax=category_gst['inclusive_tax']; // found it is inherit to category		var item_type = document.f_a['item_type['+id+']'].value;		var output_tax = document.f_a['dtl_output_tax['+id+']'].value;		var inclusive_tax = document.f_a['dtl_inclusive_tax['+id+']'].value;		if(output_tax == -1) gst_rate= float(mst_output_tax); // found it is inherit to master sku		else gst_rate = float(gst_rate_list[output_tax]);		if (inclusive_tax=='inherit') inclusive_tax=mst_inclusive_tax; // found it is inherit to master sku		$('span_gst_rate_'+id).update(gst_rate);		$('span_gst_indicator_'+id).update((inclusive_tax=='no')?"After":"Before");		if (field_type=='gst_price') {			var selling_price_gst = float(document.f_a['selling_price_gst['+id+']'].value);			if (inclusive_tax=='no') {				var selling_price=(selling_price_gst*100)/(100+gst_rate);				var gst=float(selling_price) * gst_rate / 100;			}			else{				var gst=float(selling_price_gst) * gst_rate / 100;				var selling_price=float(selling_price_gst+gst);			}			document.f_a['selling_price['+id+']'].value=round(selling_price,2);		}		else{			var selling_price = float(document.f_a['selling_price['+id+']'].value);			if (inclusive_tax=='yes') {				var selling_price_gst=(selling_price*100)/(100+gst_rate);				var gst=float(selling_price_gst) * gst_rate / 100;			}			else{				var gst=float(selling_price) * gst_rate / 100;				var selling_price_gst=float(selling_price+gst);			}			document.f_a['selling_price_gst['+id+']'].value=round(selling_price_gst,2);		}	  		var gp_selling_price = 0;		if(inclusive_tax == 'yes'){			gp_selling_price = document.f_a["selling_price_gst["+id+"]"].value;		}else{			gp_selling_price = document.f_a["selling_price["+id+"]"].value;		}		// gross profit amt		document.f_a["gross["+id+"]"].value = round(gp_selling_price - document.f_a["cost_price["+id+"]"].value, 4);		// gross profit percent		var grossp = 0		if(gp_selling_price != 0){			grossp = float(document.f_a["gross["+id+"]"].value/gp_selling_price)*100;		}		document.f_a["grossp["+id+"]"].value = round(grossp,4);		document.f_a['gst_rate['+id+']'].value=round(gst,2);	}	// recalculate gp	if (document.f_a.sku_type.value == 'CONSIGN'){		recalculate_all_cost(id);	} else {		atom_update_gross(id);	}}function calc_matrix_gst(id,rid,field_type) {  if(is_gst_active){	  //master sku	  var mst_output_tax = document.f_a['mst_output_tax'].value;	  var mst_inclusive_tax = document.f_a['mst_inclusive_tax'].value;	  if (mst_output_tax==-1) mst_output_tax=gst_rate_list[category_gst['output_tax']]; // found it is inherit to category	  else mst_output_tax=gst_rate_list[mst_output_tax];	  if (mst_inclusive_tax=='inherit') mst_inclusive_tax=category_gst['inclusive_tax']; // found it is inherit to category	  var item_type = document.f_a['item_type['+id+']'].value;	  var output_tax = document.f_a['dtl_output_tax['+id+']'].value;	  var inclusive_tax = document.f_a['dtl_inclusive_tax['+id+']'].value;	  if(output_tax == -1) gst_rate= float(mst_output_tax); // found it is inherit to master sku	  else gst_rate = float(gst_rate_list[output_tax]);	  if (inclusive_tax=='inherit') inclusive_tax=mst_inclusive_tax; // found it is inherit to master sku	  $('span_gst_rate_'+id).update(gst_rate);	  $('span_gst_indicator_'+id).update((inclusive_tax=='no')?"After":"Before");	  if (rid!=undefined && field_type=='gst_price') {		var gst_selling_price = float(document.f_a['tbprice_gst['+id+']['+rid+']'].value);				if (inclusive_tax=='no') {			var selling_price=(gst_selling_price*100)/(100+gst_rate);			var gst_amt=float(selling_price) * gst_rate / 100;		}		else{			var gst_amt=float(gst_selling_price) * gst_rate / 100;			var selling_price=float(gst_selling_price+gst_amt);		}		document.f_a['tbgst['+id+']['+rid+']'].value=round(gst_amt,2);		document.f_a['tbprice['+id+']['+rid+']'].value=round(selling_price,2);	  }	  else{		if(document.f_a.elements["tbcost["+id+"][1]"]){		  var rid = 1;		  while (document.f_a.elements["tbprice["+id+"]["+rid+"]"] != undefined){			var selling_price = float(document.f_a['tbprice['+id+']['+rid+']'].value);						if (inclusive_tax=='yes') {				var gst_selling_price=(selling_price*100)/(100+gst_rate);				var gst_amt=float(gst_selling_price) * gst_rate / 100;			}			else{				var gst_amt=float(selling_price) * gst_rate / 100;				var gst_selling_price=float(selling_price+gst_amt);			}			document.f_a['tbgst['+id+']['+rid+']'].value=round(gst_amt,2);			document.f_a['tbprice_gst['+id+']['+rid+']'].value=round(gst_selling_price,2);			rid++;		  }		}	  }  }    if (document.f_a.sku_type.value == 'CONSIGN'){		recalculate_all_cost(id);	}}function toggle_gst_settings(){	$$('.gst_settings').each(function(ele,index){		if(is_gst_active == 0) ele.hide();		else ele.show();	});}function toggle_open_price(item_id){	var inp = document.f_a["open_price["+item_id+"]"];	if(inp.checked){		// check all other sp settings		check_selling_price_settings(inp, item_id);	}}function check_selling_price_settings(chx_selected, item_id){	$$('#ul_selling_price_settings-'+item_id+' input.chx_sp_settings').each(function(inp){		if(inp != chx_selected){			inp.checked = false;			if(inp.onchange)	inp.onchange();		}	});}function cost_changed(inp, item_id){	var inp_sp = document.f_a.elements['selling_price['+item_id+']'];	if(is_gst_active){		if($('span_gst_indicator_'+item_id).innerHTML=='Before'){			inp_sp = document.f_a.elements['selling_price_gst['+item_id+']'];		}	}				// convert percent to amount	percent_to_amount(inp_sp, inp); 		// update gross amt and %	atom_update_gross(item_id);}function matrix_cost_changed(inp, item_id, row_id){	var use_sp_gst = false;	var next_row_id = row_id+1;	if(document.f_a.elements['tbcost['+item_id+']['+next_row_id+']'] == undefined){		next_row_id = 0;	// no more next row	}	if(is_gst_active){		if($('span_gst_indicator_'+item_id).innerHTML=='Before')	use_sp_gst = true;	}	var inp_sp = use_sp_gst ? document.f_a.elements["tbprice_gst["+item_id+"]["+row_id+"]"] : document.f_a.elements["tbprice["+item_id+"]["+row_id+"]"];				// convert percent to amount	percent_to_amount(inp_sp, inp);		// clone value to next row	if (inp.value>0){		if(next_row_id>0){			document.f_a.elements['tbcost['+item_id+']['+next_row_id+']'].value=inp.value;		}			}}function matrix_changed(){	var use_matrix = document.f_a['use_matrix'].value;	if(use_matrix != "yes"){		$('div_sku_matrix').hide();	}else{		$('div_sku_matrix').show();	}}function sku_matrix_override_changed(size){	var c = $('inp_sku_matrix_override-'+size).checked;	$(document.f_a).getElementsByClassName("sku_matrix_min_qty-"+size).each(function(inp){		inp.readOnly = c;	});}function calc_weight_kg(item_id){	var parent_sid = document.f_a['parent_sid'].value;	obj = document.f_a['weight_kg['+parent_sid+']'];	if(obj == undefined) return;		var weight_ratio = obj.value;		if(weight_ratio == 0) return;		if(item_id == undefined){		$('new_items').getElementsByClassName("inp_weight_kg").each(function(inp){			if (inp != undefined){				var tmp_sid = inp.readAttribute("sid");				var opt = document.f_a["packing_uom_id["+tmp_sid+"]"];				var fraction = opt.options[opt.selectedIndex].readAttribute("uom_fraction");				var child_weight = round(weight_ratio * fraction, global_weight_decimal_points);								inp.value = child_weight;			}		});	}else{		var opt = document.f_a["packing_uom_id["+item_id+"]"];		if (opt != undefined){			var fraction = opt.options[opt.selectedIndex].readAttribute("uom_fraction");			var child_weight = round(weight_ratio * fraction, global_weight_decimal_points);						document.f_a['weight_kg['+item_id+']'].value = child_weight;		}	}}function get_sid_from_obj(obj){	var div_item = $(obj).closest("div.div_item");	if(!div_item)	return;		var sku_item_id = $(div_item).readAttribute('sku_item_id');	return sku_item_id;}function prompt_rsp_notification(){	var str = "RSP = Recommended Selling Price\n";	str += "====================================\n";	str += "- Selling Price will be calculated by using RSP - RSP Discount.\n";	str += "- After turn on Use RSP, users still able to enter different RSP Discount and Selling Price at SKU Change Selling Price module.\n";	str += "- But RSP can only have one in the Masterfile SKU.\n"	str += "- The first time you turn on RSP, system will automatically update the selling price to all the branches latest selling price if detected any branch latest selling price are different.\n";		str += "\nIMPORTANT: If the sku got change selling price in Change SKU Selling Price module in any branch after turn on RSP, you will no longer able to untick RSP and also cannot edit RSP in Masterfile SKU."	alert(str);}function item_selling_price_changed(item_id){	var inp = document.f_a['selling_price['+item_id+']'];		// round 2	inp.value = round2(inp.value);		var use_rsp = document.f_a['use_rsp['+item_id+']'].checked;	if(use_rsp){		var rsp_price = float(document.f_a['rsp_price['+item_id+']'].value);		if(inp.value > rsp_price){			alert('Your Selling Price ('+round2(inp.value)+') is more than RSP ('+round2(rsp_price)+')\nSelling Price will be auto adjust to '+round2(rsp_price));			inp.value = round2(rsp_price);		}				// Calculate RSP		calculate_rsp(item_id, 'rsp_discount');	}		// calculate gst	calc_gst(item_id);	}function use_rsp_changed(item_id){	var use_rsp = document.f_a['use_rsp['+item_id+']'].checked;	var ori_use_rsp = int(document.f_a['ori_use_rsp['+item_id+']'].value);		if(use_rsp){		// Use RSP		document.f_a['rsp_price['+item_id+']'].readOnly = false;		document.f_a['rsp_discount['+item_id+']'].readOnly = false;				// Calculate RSP		calculate_rsp(item_id, 'selling_price');				// First time turn on to use RSP		if(!ori_use_rsp){			$('span_use_rsp_first_time-'+item_id).show();		}	}else{		// No Use RSP		document.f_a['rsp_price['+item_id+']'].value = '0.00';		document.f_a['rsp_discount['+item_id+']'].value = '';				document.f_a['rsp_price['+item_id+']'].readOnly = true;		document.f_a['rsp_discount['+item_id+']'].readOnly = true;				$('span_use_rsp_first_time-'+item_id).hide();	}	}function rsp_price_changed(item_id){	var inp_rsp_price = document.f_a['rsp_price['+item_id+']'];	inp_rsp_price.value = round2(inp_rsp_price.value);		// Calculate RSP	calculate_rsp(item_id, 'selling_price');}function rsp_discount_changed(item_id){	var inp_rsp_discount = document.f_a['rsp_discount['+item_id+']'];	var discount_pattern = validate_discount_format(inp_rsp_discount.value);		if(inp_rsp_discount.value != '' && discount_pattern == ''){		alert('Invalid Discount Pattern');	}	inp_rsp_discount.value = discount_pattern;		// Calculate RSP	calculate_rsp(item_id, 'selling_price');}function calculate_rsp(item_id, target_input){	// RSP	var rsp_price = float(document.f_a['rsp_price['+item_id+']'].value);	var inp_rsp_discount = document.f_a['rsp_discount['+item_id+']'];	var inp_selling_price = document.f_a['selling_price['+item_id+']'];		if(target_input == 'selling_price'){		// Get RSP Discount		rsp_discount_amt = float(get_discount_amt(rsp_price, inp_rsp_discount.value));				// Calculate Selling Price by using RSP - RSP Discount		var selling_price = float(rsp_price - rsp_discount_amt);		inp_selling_price.value = round2(selling_price);	}else if(target_input == 'rsp_discount'){		// Get Selling Price		var selling_price = float(inp_selling_price.value);				// Calculate RSP Discount by using RSP - Selling Price		var rsp_discount = round(float(rsp_price - selling_price), 2);		inp_rsp_discount.value = rsp_discount;	}}</script>{/literal}<h1>SKU Master File</h1><!-- popup div --><div id=upload_popup style="display:none;"><form onsubmit="return upload_check()" name=upl target=_ifs enctype="multipart/form-data" method=post><h4>Select an image or PDF file to add</h4><input type=hidden name=a value="add_photo"><input type=hidden name=id value="0"> <input name=fnew type=file><br><ul>	<li>Photo must be a valid JPEG image or JPG file.</li>	<li>All photo must be saved in JPEG format{if !$config.sku_application_photo_size} and the recommended image resolution is 800x600{/if}.</li></ul><br><input type=submit value="Upload"> <input type=button value="Cancel" onclick="curtain_clicked()"></form><iframe name=_ifs width=1 height=1 style="visibility:hidden"></iframe></div><!-- popup add promotion photo div --><div id=upload_promotion_popup style="display:none;"><form onsubmit="return upload_check2()" name=upl2 target=_ifs2 enctype="multipart/form-data" method=post><h4>Select an image to add</h4><input type=hidden name=a value="add_promotion_photo"><input type=hidden name=id value="0"> <input name=fnew2 type=file><ul>	<li>Photo must be a valid JPEG image or JPG file.</li></ul><br><input type=submit value="Upload"> <input type=button value="Cancel" onclick="curtain_clicked()"></form><iframe name=_ifs2 width=1 height=1 style="visibility:hidden"></iframe></div><form action="{$smarty.server.PHP_SELF}" name="f_a" method=post ENCTYPE="multipart/form-data" onsubmit="return check_a()"><input type=hidden name=a value="save"><input type=hidden name=id value="{$form.id}"><div class="stdframe" style="background:#fff"><h4>General Information</h4>{if $errm.top}<div id=err><div class=errmsg><ul>{foreach from=$errm.top item=e}<li> {$e}{/foreach}</ul></div></div>{/if}<table  border=0 cellpadding=2 cellspacing=1><tr>	<td width=80><b>SKU</b></td>	<td class="hilite">{$form.sku_code}0000</td></tr><tr>	<td><b>Applying Branch</b></td>	<td><input name="apply_branch_id" value="{$form.apply_branch_id}" type=hidden> {$form.branch_code}</td></tr><tr>	<td width=80><b>Category</b></td>	<td>	<input name="category_id" size=1 value="{$form.category_id}" readonly>	<input id="autocomplete_category" name="category" value="{$form.category|escape}" size=50>	<div id="autocomplete_category_choices" class="autocomplete" style="width:600px !important"></div>	<img src=ui/rq.gif align=absbottom title="Required Field">	<div id="str_findcat" class="small">{$form.cat_tree|default:"Type the category name to search..."}</div>	</td></tr><tr>	<td><b>SKU Type</b></td>	<td>		<div style="{if $form.disable_edit_sku_type}display:none;{/if}">			<input type="hidden" name="disable_edit_sku_type" value="{$form.disable_edit_sku_type}" />			<select name="sku_type" onchange="check_allow_matrix();">				<option value="">-- Select --</option>				{foreach from=$sku_type_list key=st_code item=st}					<option value="{$st_code}" {if $form.sku_type eq $st_code}selected{/if}>{$st.description}</option>				{/foreach}			</select> <img src="ui/rq.gif" align="absbottom" title="Required Field" />		</div>		{if $form.disable_edit_sku_type}			{$sku_type_list[$form.sku_type].description}			<img src="ui/icons/information.png" class="clickable" onClick="alert('SKU Type Cannot be change due to it has been used in documents such as PO / DO / GRN / GRA or Sold in POS Counter');" />		{/if}	</td></tr>{if $config.enable_no_inventory_sku}<!-- No Inventory--><tr>	<td><b>SKU Without Inventory</b></td>	<td>	    <select name="no_inventory">	        {foreach from=$inherit_options key=k item=val}	            <option value="{$k}" {if $form.no_inventory eq $k}selected {/if}>{$val}</option>	        {/foreach}	    </select>	</td></tr>{else}<input type="hidden" name="no_inventory" value="inherit" />{/if}{if $config.enable_fresh_market_sku}<!-- Is Fresh Market SKU--><tr>	<td><b>Is Fresh Market SKU</b></td>	<td>	    <select name="is_fresh_market" onchange="check_fm_type();">	        {foreach from=$inherit_options key=k item=val}	            <option value="{$k}" {if $form.is_fresh_market eq $k}selected {/if}>{$val}</option>	        {/foreach}	    </select>&nbsp;&nbsp;&nbsp;&nbsp;	</td></tr>{else}	<input type="hidden" name="is_fresh_market" value="inherit" />{/if}{if !$config.consignment_modules}	<tr>		<td><b>Scale Type</b></td>		<td>			<select name="mst_scale_type">				{foreach from=$scale_type_list key=st_value item=st_name}					{if $st_value >= 0}						<option value="{$st_value}" {if $form.scale_type eq $st_value}selected {/if}>{$st_name}</option>					{/if}				{/foreach}			</select>		</td>	</tr>{/if}<tr>	<td><b>Vendor</b></td>	<td>    <input name="vendor_id" type=hidden size=1 value="{$form.vendor_id}" readonly>	<input id="autocomplete_vendor" name="vendor" value="{$form.vendor}" size=50>	<div id="autocomplete_vendor_choices" class="autocomplete"></div>	<img src=ui/rq.gif align=absbottom title="Required Field">	<input type=button value="Verify Article/M-Code" onclick="mcode_check()"></td></tr><tr>	<td style="vertical-align:top; padding-top:5px;"><b>Brand</b></td>	<td>	<input name=brand_name type=hidden value="">	<input name="brand_id" type=hidden size=1 value="{$form.brand_id}" readonly>	<input id="autocomplete_brand" name="brand" value="{$form.brand}" size=30>	<br /><font style="color:#FF0000; font-weight:bold; font-size:11;">Note: Please choose "UN-BRANDED" if want to remove brand.</b>	<div id="autocomplete_brand_choices" class="autocomplete"></div>	<!--img src=ui/rq.gif align=absbottom title="Required Field"-->	</td></tr>{if $config.sku_always_show_trade_discount}<tr id="trade_discount_table">	<td><b>Trade Discount Code</b></td>	<td>	    <select name="default_trade_discount_code" onChange="update_td_selected(this.value, this)">	    <option value="">-- Please Select --</option>	    {section name=c loop=$trade_discount_table}	        <option value="{$trade_discount_table[c].code}" {if $form.default_trade_discount_code eq $trade_discount_table[c].code}selected {/if}>{$trade_discount_table[c].code}</option>		{/section}		</select>		<table style="display:none;">		<tr>		{section name=c loop=$trade_discount_table}		{assign var=ccode value=`$trade_discount_table[c].code`}		<th><input size=3 name="trade_discount_table[{$trade_discount_table[c].code}]" value="{$form.trade_discount_table.$ccode}" readonly></th>		{/section}		</tr>	    </table>	</td></tr>{else}<tr id="trade_discount_type_table">	<td><b>Trade Discount</b></td>	<td>	    <input type=radio name=trade_discount_type value=1 {if $form.trade_discount_type == 1}checked{/if} onclick="td_sel(this.value)"> use Brand Table	    <input type=radio name=trade_discount_type value=2 {if $form.trade_discount_type == 2}checked{/if} onclick="td_sel(this.value)"> use Vendor Table    </td></tr><tr id="trade_discount_table" {if $form.trade_discount_type == 0}style="display:none"{/if}>	<td><b>Trade Discount Table</b></td>	<td>	    <table  border=0 cellpadding=2 cellspacing=1>		<tr>		{section name=c loop=$trade_discount_table}		{if !$form.default_trade_discount_code && $smarty.section.c.first}			{assign var=default_disc_code value=$trade_discount_table[c].code}		{/if}		<th><input type=radio name=default_trade_discount_code onclick="update_td_selected(this.value, this)" value="{$trade_discount_table[c].code}" {if $form.default_trade_discount_code eq $trade_discount_table[c].code || $default_disc_code eq $trade_discount_table[c].code}checked{/if}>{$trade_discount_table[c].code}</th>		{/section}		</tr>		<tr>		{section name=c loop=$trade_discount_table}		{assign var=ccode value=`$trade_discount_table[c].code`}		<th><input size=3 name="trade_discount_table[{$trade_discount_table[c].code}]" value="{$form.trade_discount_table.$ccode}" readonly></th>		{/section}		</tr>	    </table>	</td></tr>{/if}<tr>	<td valign=top><b>Note</b></td>	<td><textarea name=note rows=2 cols=40>{$form.note|escape}</textarea></td>	</tr>{if $config.sku_application_require_multics}<tr>	<td><b>{$config.link_code_name}</b></td>	<td>		<table class=body>		<tr>			<td>Department</td>			<td>			<input type="text" id="multics_dept" name="multics_dept" value="{$form.multics_dept}"/>			<div id="multics_dept_choices" class="autocomplete"></div>			</td>			<td>Section</td>			<td>			<input type="text" id="multics_section" name="multics_section" value="{$form.multics_section}"/>			<div id="multics_section_choices" class="autocomplete"></div>			</td>			<td>Category</td>			<td>			<input type="text" id="multics_category" name="multics_category" value="{$form.multics_category}"/>			<div id="multics_category_choices" class="autocomplete"></div>			</td>		</tr>		<tr>			<td>Brand</td>			<td>			<input type="text" id="multics_brand" name="multics_brand" value="{$form.multics_brand}"/>			<div id="multics_brand_choices" class="autocomplete"></div>			</td>			<td>Price Type</td>			<td>			<select name=multics_pricetype>			<option value="">Please Select</option>			<option value="N1" {if $form.multics_pricetype eq "N1"}selected {/if}>N1</option>			<option value="N2" {if $form.multics_pricetype eq "N2"}selected {/if}>N2</option>			<option value="N3" {if $form.multics_pricetype eq "N3"}selected {/if}>N3</option>			<option value="B1" {if $form.multics_pricetype eq "B1"}selected {/if}>B1</option>			<option value="B2" {if $form.multics_pricetype eq "B2"}selected {/if}>B2</option>			<option value="B3" {if $form.multics_pricetype eq "B3"}selected {/if}>B3</option>			<option value="B5" {if $form.multics_pricetype eq "B5"}selected {/if}>B5</option>			<option value="B6" {if $form.multics_pricetype eq "B6"}selected {/if}>B6</option>			<option value="B7" {if $form.multics_pricetype eq "B7"}selected {/if}>B7</option>			<option value="B8" {if $form.multics_pricetype eq "B8"}selected {/if}>B8</option>			<option value="B9" {if $form.multics_pricetype eq "B9"}selected {/if}>B9</option>			</select>			</td>		</tr>		</table>	</td></tr>{/if}{if $config.enable_sn_bn}	<tr>		<td><b>Use Serial No</b></td>		<td>			<select name="have_sn">				<option value="0" {if $form.have_sn eq '0'}selected {/if}>No</option>				<option value="1" {if $form.have_sn eq '1'}selected {/if}>Yes (Pre-list)</option>				<option value="2" {if $form.have_sn eq '2'}selected {/if}>Yes</option>			</select>		</td>	</tr>{/if}<tr valign="top">	<td style="padding-top:6;"><b>PO Reorder Qty</b></td>	<td>		<input type="checkbox" name="po_reorder_by_child" value="1" {if $form.po_reorder_by_child}checked{/if} onclick="toggle_po_reorder_by_child();" /> <b>By Child</b><br /><br />		<div id="div_po_reorder_qty">			Min: <input type="text" size="3" name="po_reorder_qty_min" value="{$form.po_reorder_qty_min}" />			&nbsp;&nbsp;&nbsp;			Max: <input type="text" size="3" name="po_reorder_qty_max" value="{$form.po_reorder_qty_max}" />			&nbsp;&nbsp;&nbsp;			MOQ <a href="javascript:void(alert('Minimum Order Quantity'))"><img src="/ui/icons/information.png" align="absmiddle" /></a> : <input type="text" size="3" name="po_reorder_moq" value="{$form.po_reorder_moq}" />			&nbsp;&nbsp;&nbsp;			Notify Person 			<select name="po_reorder_notify_user_id">				<option value="" {if !$form.po_reorder_notify_user_id}selected{/if}>--</option>				{foreach from=$po_reorder_users key=row item=r}					<option value="{$r.id}" {if $form.po_reorder_notify_user_id eq $r.id}selected{/if}>{$r.u}</option>				{/foreach}			</select>			{if !$config.consignment_modules}				<span id="qty_setup">					<input type="checkbox" name="po_reorder_qty_setup" value="1" {if $form.po_reorder_qty_by_branch.min || $form.po_reorder_qty_by_branch.max}checked{/if} onclick="toggle_prq_by_branch(this);" /> Overwrite PO Reorder qty by Branch				</span>				<br />				<br />				<div class="div_multi_select" id="prq_by_branch" {if !$form.po_reorder_qty_by_branch.min && !$form.po_reorder_qty_by_branch.max}style="display:none;"{/if}>					<table width="100%">						{foreach from=$branch_list key=bid item=b}							<tr>								<td width="5%"><b>{$b.code}</b></td>								<td width="1%">Min: </td>								<td width="3%">									<input type="text" size="3" name="po_reorder_qty_by_branch[min][{$bid}]" class="r" value="{$form.po_reorder_qty_by_branch.min.$bid}" />								</td>								<td width="1%">Max: </td>								<td width="3%">									<input type="text" size="3" name="po_reorder_qty_by_branch[max][{$bid}]" class="r" value="{$form.po_reorder_qty_by_branch.max.$bid}" />								</td>								<td width="1%">MOQ: </td>								<td width="3%">									<input type="text" size="3" name="po_reorder_qty_by_branch[moq][{$bid}]" class="r" value="{$form.po_reorder_qty_by_branch.moq.$bid}" />								</td>								<td width="2%" nowrap>Notify Person: </td>								<td width="3%">									<select name="po_reorder_qty_by_branch[notify_user_id][{$bid}]">										<option value="" {if !$form.po_reorder_qty_by_branch.notify_user_id.$bid}selected{/if}>--</option>										{foreach from=$po_reorder_users key=row item=r}											<option value="{$r.id}" {if $form.po_reorder_qty_by_branch.notify_user_id.$bid eq $r.id}selected{/if}>{$r.u}</option>										{/foreach}									</select>								</td>							</tr>						{/foreach}					</table>				</div>			{/if}		</div>	</td></tr>{if $config.sku_non_returnable}	<tr valign="top">		<td nowrap><b>Non-returnable</b> <a href="javascript:void(alert('Turn on this will not allow this group of SKU to return at GRA'))"><img src="/ui/icons/information.png" align="absmiddle" /></a></td>		<td>			<select name="group_non_returnable">				<option value="1" {if $form.group_non_returnable eq 1}selected {/if}>Yes</option>				<option value="0" {if $form.group_non_returnable eq 0}selected {/if}>No</option>			</select>		</td>	</tr>{/if}<tr class="gst_settings">	<td><b>Input Tax</b></td>	<td>		<select name="mst_input_tax">			<option value="-1" {if $form.mst_input_tax eq -1}selected{/if}>Inherit (Follow Category)</option>			{foreach from=$input_tax_list key=rid item=r}				<option value="{$r.id}" {if $form.mst_input_tax eq $r.id}selected{/if}>{$r.code} - {$r.description}</option>			{/foreach}		</select>	</td></tr><tr class="gst_settings">	<td><b>Output Tax</b></td>	<td>		<select name="mst_output_tax" onchange="calc_all_gst(); mst_gst_info_changed();">			<option value="-1" {if $form.mst_output_tax eq -1}selected{/if}>Inherit (Follow Category)</option>			{foreach from=$output_tax_list key=rid item=r}				<option data-rate="{$r.rate}" value="{$r.id}" {if $form.mst_output_tax eq $r.id}selected{/if}>{$r.code} - {$r.description}</option>			{/foreach}		</select>	</td></tr><tr style="{if !$gst_settings or ($global_gst_settings.inclusive_tax eq 'yes' and (!isset($form.mst_inclusive_tax) or $form.mst_inclusive_tax eq 'inherit'))}display:none;{/if}">	<td><b>Selling Price Inclusive Tax</b></td>	<td>		<select name="mst_inclusive_tax" onchange="calc_all_gst(); mst_gst_info_changed();">			{foreach from=$inherit_options key=k item=val}			<option value="{$k}" {if $form.mst_inclusive_tax eq $k}selected {/if}>{$val}</option>            {/foreach}		</select>	</td></tr><tr valign="top">    <td nowrap><b>Allow Parent and Child duplicate MCode</b></td>    <td>        <select name="parent_child_duplicate_mcode">            <option value="1" {if $form.parent_child_duplicate_mcode eq 1}selected {/if}>Yes</option>            <option value="0" {if $form.parent_child_duplicate_mcode eq 0}selected {/if}>No</option>        </select>    </td></tr>{if $config.enable_one_color_matrix_ibt}	<tr>		<td><b>Use Matrix Settings</b></td>		<td>			<select name="use_matrix" onchange="matrix_changed();">				{foreach from=$inherit_options key=k item=val}					<option value="{$k}" {if ($form.use_matrix eq $k) || (!$form.use_matrix and $k eq 'no')}selected {/if}>{$val}</option>				{/foreach}			</select>		</td>	</tr>	<tr>		<td>&nbsp;</td>		<td>			{include file='masterfile_sku.ibt_matrix.tpl' is_edit=1 use_matrix=$form.use_matrix sku_matrix=$form.matrix}		</td>	</tr>{/if}</table></div><br><div id=new_items>{section name=i loop=$items}{if $items[i].item_type eq 'matrix'}{include file="masterfile_sku.edit.matrix.tpl"}{else}{include file="masterfile_sku.edit.items.tpl"}{/if}{/section}</div><div><span id="add_item">	<span id="add_variety">	<a href="javascript:void(add_item())"><img src=ui/new.png title="New" align=absmiddle border=0> Add New SKU</a> &nbsp; &nbsp;	</span>	<span id="add_matrix">	{if !$config.sku_disable_add_matrix}		<a href="javascript:void(add_matrix())"><img src=ui/table_add.png title="New" align=absmiddle border=0> Add New Matrix</a>	{/if}	</span></span><span id="add_item_notify"></span></div><br><p align=center><input class="btn btn-primary" id=submitbtn name=bsubmit type=submit value="Update"><input class="btn btn-error" type=button onclick="document.location='masterfile_sku.php'" value="Close"></p></form>{include file=footer.tpl}<script type="text/javascript">{if !$config.sku_always_show_trade_discount}sel_brand();sel_vendor();{/if}{literal}check_allow_matrix();init_click_hilite(document.f_a);load_category_GST(document.f_a.category_id.value);toggle_gst_settings();var category_autocompleter = new Ajax.Autocompleter("autocomplete_category", "autocomplete_category_choices", "ajax_autocomplete.php?a=ajax_search_category", {	afterUpdateElement: function (obj,li)	{		this.defaultParams = '';		var s = li.title.split(",");		document.f_a.category_id.value = s[0];		sel_category(obj,s[1]);		if(config_enable_fresh_market_sku) check_fm_type();		if(!config_sku_always_show_trade_discount) sel_department();        load_category_GST(s[0]);	}});new Ajax.Autocompleter("autocomplete_brand", "autocomplete_brand_choices", "ajax_autocomplete.php?a=ajax_search_brand", { afterUpdateElement: function (obj, li) { document.f_a.brand_id.value = li.title; sel_brand(); }});new Ajax.Autocompleter("autocomplete_vendor", "autocomplete_vendor_choices", "ajax_autocomplete.php?a=ajax_search_vendor", { afterUpdateElement: function (obj, li) { document.f_a.vendor_id.value = li.title; sel_vendor(); }});{/literal}{if $config.sku_application_require_multics}{literal}new Ajax.Autocompleter("multics_dept", "multics_dept_choices", "multics_autocomplete.php", {paramName: "dept", afterUpdateElement: function (obj, li) { obj.value = li.title }});new Ajax.Autocompleter("multics_section", "multics_section_choices", "multics_autocomplete.php", {paramName: "sect", afterUpdateElement: function (obj, li) { obj.value = li.title }});new Ajax.Autocompleter("multics_category", "multics_category_choices", "multics_autocomplete.php", {paramName: "cat", afterUpdateElement: function (obj, li) { obj.value = li.title }});new Ajax.Autocompleter("multics_brand", "multics_brand_choices", "multics_autocomplete.php", {paramName: "brand", afterUpdateElement: function (obj, li) { obj.value = li.title }});{/literal}{/if}toggle_po_reorder_by_child();{literal}var new_open = false;</script>{/literal}